  "src/App.jsx": "import React, { useCallback, useEffect, useMemo, useRef, useState, lazy, Suspense } from './react.js';\nimport { QuestionnaireScreen } from './components/QuestionnaireScreen.jsx';\nimport { SynthesisReport } from './components/SynthesisReport.jsx';\nimport { HomeScreen } from './components/HomeScreen.jsx';\nimport { InspirationForm } from './components/InspirationForm.jsx';\nimport { InspirationDetail } from './components/InspirationDetail.jsx';\nimport { AnnotationLayer } from './components/AnnotationLayer.jsx';\nimport { CheckCircle, Link, Lock, MessageSquare, Settings, Sparkles } from './components/icons.js';\nimport { MandatoryQuestionsSummary } from './components/MandatoryQuestionsSummary.jsx';\nimport { initialQuestions } from './data/questions.js';\nimport { initialRules } from './data/rules.js';\nimport { initialRiskLevelRules } from './data/riskLevelRules.js';\nimport { initialRiskWeights } from './data/riskWeights.js';\nimport { initialTeams } from './data/teams.js';\nimport { initialShowcaseThemes } from './data/showcaseThemes.js';\nimport { initialInspirationProjects } from './data/inspirationProjects.js';\nimport { initialOnboardingTourConfig } from './data/onboardingTour.js';\nimport { loadPersistedState, persistState } from './utils/storage.js';\nimport { shouldShowQuestion } from './utils/questions.js';\nimport { analyzeAnswers } from './utils/rules.js';\nimport { extractProjectName } from './utils/projects.js';\nimport { createDemoProject, demoProjectAnswersSnapshot } from './data/demoProject.js';\nimport { exportProjectToFile } from './utils/projectExport.js';\nimport { normalizeRiskWeighting } from './utils/risk.js';\nimport { normalizeProjectEntry, normalizeProjectsCollection } from './utils/projectNormalization.js';\nimport { loadSubmittedProjectsFromDirectory } from './utils/externalProjectsLoader.js';\nimport { loadSubmittedInspirationsFromDirectory } from './utils/externalInspirationsLoader.js';\nimport {\n  createDefaultProjectFiltersConfig,\n  normalizeProjectFilterConfig\n} from './utils/projectFilters.js';\nimport { normalizeOnboardingConfig } from './utils/onboarding.js';\nimport {\n  createDefaultInspirationFiltersConfig,\n  createDefaultInspirationFormConfig,\n  normalizeInspirationFiltersConfig,\n  normalizeInspirationFormConfig\n} from './utils/inspirationConfig.js';\nimport { exportInspirationToFile } from './utils/inspirationExport.js';\n\nconst APP_VERSION = 'v1.0.238';\n\nconst resolveShowcaseDisplayMode = (value) => {\n  if (value === 'light') {\n    return 'light';\n  }\n  if (value === 'full') {\n    return 'full';\n  }\n  return null;\n};\n\nconst loadModule = (modulePath) => {\n  if (typeof window === 'undefined') {\n    throw new Error('ModuleLoader indisponible.');\n  }\n\n  if (!window.ModuleLoader || typeof window.ModuleLoader.import !== 'function') {\n    throw new Error('ModuleLoader indisponible.');\n  }\n\n  return window.ModuleLoader.import(modulePath);\n};\n\nconst LazyBackOffice = lazy(() =>\n  Promise.resolve().then(() => ({\n    default: loadModule('./src/components/BackOffice.jsx').BackOffice\n  }))\n);\n\nconst LazyProjectShowcase = lazy(() =>\n  Promise.resolve().then(() => ({\n    default: loadModule('./src/components/ProjectShowcase.jsx').ProjectShowcase\n  }))\n);\n\nconst LoadingFallback = ({ label, hint }) => (\n  <div className=\"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm hv-surface\">\n    <div className=\"flex items-center gap-3 text-sm text-gray-600\">\n      <span className=\"loading-spinner\" aria-hidden=\"true\" />\n      <span>{label}</span>\n    </div>\n    {hint && <p className=\"mt-2 text-xs text-gray-400\">{hint}</p>}\n  </div>\n);\n\nconst ANNOTATION_COLORS = [\n  '#2563eb',\n  '#ec4899',\n  '#10b981',\n  '#f59e0b',\n  '#8b5cf6',\n  '#0ea5e9',\n  '#14b8a6',\n  '#ef4444',\n  '#ea580c'\n];\n\nconst BACK_OFFICE_PASSWORD_HASH = '3c5b8c6aaa89db61910cdfe32f1bdb193d1923146dbd6a7b0634a32ab73ac1af';\nconst BACK_OFFICE_PASSWORD_FALLBACK_DIGEST = '86ceec83';\n\nconst computeBackOfficePasswordDigest = async (value) => {\n  if (typeof value !== 'string' || value.length === 0) {\n    return '';\n  }\n\n  const globalCrypto =\n    typeof globalThis !== 'undefined' && typeof globalThis.crypto !== 'undefined'\n      ? globalThis.crypto\n      : undefined;\n\n  const hasSubtleCrypto =\n    !!globalCrypto?.subtle && typeof TextEncoder !== 'undefined';\n\n  if (hasSubtleCrypto) {\n    try {\n      const encoder = new TextEncoder();\n      const data = encoder.encode(value);\n      const digest = await globalCrypto.subtle.digest('SHA-256', data);\n      return Array.from(new Uint8Array(digest))\n        .map(byte => byte.toString(16).padStart(2, '0'))\n        .join('');\n    } catch (error) {\n      // Fallback defined below\n    }\n  }\n\n  let hash = 0;\n  for (let index = 0; index < value.length; index += 1) {\n    hash = (hash * 31 + value.charCodeAt(index)) >>> 0;\n  }\n\n  return hash.toString(16).padStart(8, '0');\n};\n\nconst verifyBackOfficePassword = async (value) => {\n  const digest = await computeBackOfficePasswordDigest(value);\n\n  if (!digest) {\n    return false;\n  }\n\n  if (digest.length === BACK_OFFICE_PASSWORD_HASH.length) {\n    return digest === BACK_OFFICE_PASSWORD_HASH;\n  }\n\n  return digest === BACK_OFFICE_PASSWORD_FALLBACK_DIGEST;\n};\n\nconst cloneDeep = (value) => {\n  if (value === null || value === undefined) {\n    return value;\n  }\n\n  if (typeof structuredClone === 'function') {\n    try {\n      return structuredClone(value);\n    } catch (error) {\n      // Fallback to JSON strategy below\n    }\n  }\n\n  try {\n    return JSON.parse(JSON.stringify(value));\n  } catch (error) {\n    return value;\n  }\n};\n\nconst clamp01 = (value) => {\n  if (typeof value !== 'number' || Number.isNaN(value)) {\n    return 0;\n  }\n\n  if (value < 0) {\n    return 0;\n  }\n\n  if (value > 1) {\n    return 1;\n  }\n\n  return value;\n};\n\nconst createAnnotationId = () => {\n  if (typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function') {\n    return crypto.randomUUID();\n  }\n\n  return `note-${Date.now()}-${Math.round(Math.random() * 100000)}`;\n};\n\nconst createInspirationId = () => {\n  if (typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function') {\n    return crypto.randomUUID();\n  }\n\n  return `inspiration-${Date.now()}-${Math.round(Math.random() * 100000)}`;\n};\n\nconst buildAnnotationContextKey = ({ screen, projectId, scope }) => {\n  const base = screen === 'showcase' ? `showcase:${projectId || 'unknown'}` : screen;\n\n  if (screen === 'showcase' && scope) {\n    return `${base}:${scope}`;\n  }\n\n  return base || 'global';\n};\n\nconst restoreShowcaseQuestions = (currentQuestions, referenceQuestions = initialQuestions) => {\n  if (!Array.isArray(currentQuestions)) {\n    return referenceQuestions;\n  }\n\n  const nextQuestions = currentQuestions.slice();\n  let changed = false;\n\n  referenceQuestions.forEach((referenceQuestion, referenceIndex) => {\n    if (!referenceQuestion || !referenceQuestion.showcase) {\n      return;\n    }\n\n    const existingIndex = nextQuestions.findIndex((item) => item && item.id === referenceQuestion.id);\n\n    if (existingIndex === -1) {\n      const clonedQuestion = JSON.parse(JSON.stringify(referenceQuestion));\n      const insertionIndex = Math.min(referenceIndex, nextQuestions.length);\n      nextQuestions.splice(insertionIndex, 0, clonedQuestion);\n      changed = true;\n      return;\n    }\n\n    const existingQuestion = nextQuestions[existingIndex];\n    const existingShowcaseMeta = existingQuestion && existingQuestion.showcase;\n    const referenceShowcaseMeta = referenceQuestion.showcase;\n\n    const showcaseMetaDiffers =\n      !existingShowcaseMeta ||\n      JSON.stringify(existingShowcaseMeta) !== JSON.stringify(referenceShowcaseMeta);\n\n    if (showcaseMetaDiffers) {\n      nextQuestions[existingIndex] = {\n        ...existingQuestion,\n        showcase: JSON.parse(JSON.stringify(referenceShowcaseMeta))\n      };\n      changed = true;\n    }\n  });\n\n  return changed ? nextQuestions : currentQuestions;\n};\n\n\nconst isAnswerProvided = (value) => {\n  if (Array.isArray(value)) {\n    return value.length > 0;\n  }\n\n  if (typeof value === 'string') {\n    return value.trim().length > 0;\n  }\n\n  return value !== null && value !== undefined;\n};\n\nconst areAnswersEqual = (previousValue, nextValue) => {\n  if (previousValue === nextValue) {\n    return true;\n  }\n\n  if (Array.isArray(previousValue) && Array.isArray(nextValue)) {\n    try {\n      return JSON.stringify(previousValue) === JSON.stringify(nextValue);\n    } catch (error) {\n      if (previousValue.length !== nextValue.length) {\n        return false;\n      }\n      return previousValue.every((entry, index) => entry === nextValue[index]);\n    }\n  }\n\n  if (\n    previousValue &&\n    nextValue &&\n    typeof previousValue === 'object' &&\n    typeof nextValue === 'object'\n  ) {\n    try {\n      return JSON.stringify(previousValue) === JSON.stringify(nextValue);\n    } catch (error) {\n      return false;\n    }\n  }\n\n  return false;\n};\n\nconst findQuestionById = (questions, id) => {\n  if (!Array.isArray(questions)) {\n    return null;\n  }\n\n  return questions.find(question => question?.id === id) || null;\n};\n\nconst normalizeMilestoneListValue = (value) => {\n  if (!Array.isArray(value)) {\n    return [];\n  }\n\n  return value\n    .map(item => ({\n      date: typeof item?.date === 'string' ? item.date.trim() : '',\n      description: typeof item?.description === 'string' ? item.description.trim() : ''\n    }))\n    .filter(entry => entry.date.length > 0 || entry.description.length > 0)\n    .map(entry => ({\n      date: entry.date,\n      description: entry.description\n    }));\n};\n\nconst areMilestoneListsEqual = (previousValue, nextValue) => {\n  if (previousValue.length !== nextValue.length) {\n    return false;\n  }\n\n  return previousValue.every((entry, index) => {\n    const nextEntry = nextValue[index];\n    if (!nextEntry) {\n      return false;\n    }\n\n    return entry.date === nextEntry.date && entry.description === nextEntry.description;\n  });\n};\n\nconst applyAnswerUpdates = (\n  prevAnswers = {},\n  updates,\n  questions,\n  predicate,\n  options = {}\n) => {\n  if (!updates || typeof updates !== 'object') {\n    return { nextAnswers: prevAnswers, changed: false };\n  }\n\n  const entries = Object.entries(updates);\n  if (entries.length === 0) {\n    return { nextAnswers: prevAnswers, changed: false };\n  }\n\n  const nextAnswers = { ...prevAnswers };\n  let changed = false;\n\n  entries.forEach(([questionId, value]) => {\n    if (!questionId) {\n      return;\n    }\n\n    const question = findQuestionById(questions, questionId);\n    const questionType = question?.type;\n\n    if (questionType === 'milestone_list') {\n      const normalizedValue = normalizeMilestoneListValue(value);\n      const previousRawValue = nextAnswers[questionId];\n      const previousValue = Array.isArray(previousRawValue)\n        ? normalizeMilestoneListValue(previousRawValue)\n        : [];\n      const previousRawJson = JSON.stringify(Array.isArray(previousRawValue) ? previousRawValue : []);\n      const normalizedJson = JSON.stringify(normalizedValue);\n\n      if (normalizedValue.length > 0) {\n        if (!areMilestoneListsEqual(previousValue, normalizedValue) || previousRawJson !== normalizedJson) {\n          changed = true;\n          nextAnswers[questionId] = normalizedValue;\n        }\n      } else if (questionId in nextAnswers) {\n        changed = true;\n        delete nextAnswers[questionId];\n      }\n\n      return;\n    }\n\n    if (Array.isArray(value)) {\n      const filtered = value\n        .map(item => (typeof item === 'string' ? item.trim() : item))\n        .filter(item => {\n          if (typeof item === 'string') {\n            return item.length > 0;\n          }\n          return item !== null && item !== undefined;\n        });\n\n      const previousValue = nextAnswers[questionId];\n      const arraysAreEqual = Array.isArray(previousValue)\n        && previousValue.length === filtered.length\n        && previousValue.every((item, index) => item === filtered[index]);\n\n      if (filtered.length > 0) {\n        if (!arraysAreEqual) {\n          changed = true;\n        }\n        nextAnswers[questionId] = filtered;\n      } else if (questionId in nextAnswers) {\n        changed = true;\n        delete nextAnswers[questionId];\n      }\n\n      return;\n    }\n\n    if (value === null || value === undefined) {\n      if (questionId in nextAnswers) {\n        changed = true;\n        delete nextAnswers[questionId];\n      }\n      return;\n    }\n\n    if (typeof value === 'string') {\n      const trimmed = value.trim();\n      if (trimmed.length > 0) {\n        if (nextAnswers[questionId] !== value) {\n          changed = true;\n          nextAnswers[questionId] = value;\n        }\n      } else if (questionId in nextAnswers) {\n        changed = true;\n        delete nextAnswers[questionId];\n      }\n      return;\n    }\n\n    if (nextAnswers[questionId] !== value) {\n      changed = true;\n      nextAnswers[questionId] = value;\n    }\n  });\n\n  if (!changed) {\n    return { nextAnswers: prevAnswers, changed: false };\n  }\n\n  const canEvaluatePredicate = typeof predicate === 'function';\n  const shouldPreserveQuestion = typeof options.shouldPreserveQuestion === 'function'\n    ? options.shouldPreserveQuestion\n    : null;\n  const questionsToRemove = Array.isArray(questions) && canEvaluatePredicate\n    ? questions\n        .filter(question => {\n          if (!question || !question.id) {\n            return false;\n          }\n\n          const wasVisible = predicate(question, prevAnswers);\n          const isVisible = predicate(question, nextAnswers);\n\n          if (isVisible) {\n            return false;\n          }\n\n          if (shouldPreserveQuestion && shouldPreserveQuestion(question, {\n            prevAnswers,\n            nextAnswers\n          })) {\n            return false;\n          }\n\n          if (wasVisible) {\n            return true;\n          }\n\n          return isAnswerProvided(nextAnswers[question.id]) || isAnswerProvided(prevAnswers[question.id]);\n        })\n        .map(question => question.id)\n    : [];\n\n  if (questionsToRemove.length > 0) {\n    questionsToRemove.forEach(questionId => {\n      if (questionId in nextAnswers) {\n        changed = true;\n        delete nextAnswers[questionId];\n      }\n    });\n  }\n\n  return { nextAnswers, changed };\n};\n\nconst resolveFallbackQuestionsLength = (savedState, currentQuestionsLength = initialQuestions.length) => {\n  if (savedState && Array.isArray(savedState.questions) && savedState.questions.length > 0) {\n    return savedState.questions.length;\n  }\n\n  return currentQuestionsLength;\n};\n\nconst buildInitialProjectsState = () => {\n  const savedState = loadPersistedState();\n\n  if (!savedState) {\n    return [createDemoProject()];\n  }\n\n  const fallbackQuestions = Array.isArray(savedState.questions) ? savedState.questions : initialQuestions;\n  const fallbackRules = Array.isArray(savedState.rules) ? savedState.rules : initialRules;\n  const fallbackRiskLevelRules = Array.isArray(savedState.riskLevelRules)\n    ? savedState.riskLevelRules\n    : initialRiskLevelRules;\n  const fallbackRiskWeights = savedState && typeof savedState.riskWeights === 'object'\n    ? normalizeRiskWeighting(savedState.riskWeights)\n    : initialRiskWeights;\n  const fallbackQuestionsLength = resolveFallbackQuestionsLength(savedState, fallbackQuestions.length);\n\n  const normalizedProjects = normalizeProjectsCollection(savedState.projects, fallbackQuestionsLength)\n    || normalizeProjectsCollection(savedState.submittedProjects, fallbackQuestionsLength);\n\n  if (normalizedProjects && normalizedProjects.length > 0) {\n    return normalizedProjects;\n  }\n\n  return [createDemoProject({\n    questions: fallbackQuestions,\n    rules: fallbackRules,\n    riskLevelRules: fallbackRiskLevelRules,\n    riskWeights: fallbackRiskWeights\n  })];\n};\n\nconst buildInitialInspirationProjectsState = () => {\n  const savedState = loadPersistedState();\n  if (savedState && Array.isArray(savedState.inspirationProjects)) {\n    return cloneDeep(savedState.inspirationProjects);\n  }\n\n  return cloneDeep(initialInspirationProjects);\n};\n\nconst buildInitialOnboardingConfig = () => {\n  const savedState = loadPersistedState();\n  if (savedState && savedState.onboardingTourConfig) {\n    return normalizeOnboardingConfig(savedState.onboardingTourConfig);\n  }\n\n  return cloneDeep(initialOnboardingTourConfig);\n};\n\nconst isOnboardingProject = (project) => {\n  if (!project || typeof project !== 'object') {\n    return false;\n  }\n\n  const { id } = project;\n  if (typeof id !== 'string' || id.length === 0) {\n    return false;\n  }\n\n  return id === 'onboarding-demo' || id.startsWith('tour-');\n};\n\nconst sanitizeRestoredProjects = (projects) => {\n  if (!Array.isArray(projects)) {\n    return [];\n  }\n\n  const restored = projects.filter(project => !isOnboardingProject(project));\n\n  if (restored.length === 0) {\n    return [];\n  }\n\n  return cloneDeep(restored);\n};\n\nexport const App = () => {\n  const [mode, setMode] = useState('user');\n  const [screen, setScreen] = useState('home');\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [answers, setAnswers] = useState({});\n  const [analysis, setAnalysis] = useState(null);\n  const [projects, setProjects] = useState(buildInitialProjectsState);\n  const projectsRef = useRef(projects);\n  const [inspirationProjects, setInspirationProjects] = useState(buildInitialInspirationProjectsState);\n  const [onboardingTourConfig, setOnboardingTourConfig] = useState(buildInitialOnboardingConfig);\n  const [activeInspirationId, setActiveInspirationId] = useState(null);\n  const [activeProjectId, setActiveProjectId] = useState(null);\n  const [validationError, setValidationError] = useState(null);\n  const [saveFeedback, setSaveFeedback] = useState(null);\n  const [showcaseProjectContext, setShowcaseProjectContext] = useState(null);\n  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\n  const [returnToSynthesisAfterEdit, setReturnToSynthesisAfterEdit] = useState(false);\n  const [isOnboardingActive, setIsOnboardingActive] = useState(false);\n  const [onboardingStepId, setOnboardingStepId] = useState(null);\n  const [isTourGuideReady, setIsTourGuideReady] = useState(false);\n  const tourInstanceRef = useRef(null);\n  const onboardingStateRef = useRef(null);\n  const onboardingDemoDataRef = useRef(null);\n  const isOnboardingActiveRef = useRef(false);\n\n  const [questions, setQuestions] = useState(() => restoreShowcaseQuestions(initialQuestions));\n  const [rules, setRules] = useState(initialRules);\n  const [riskLevelRules, setRiskLevelRules] = useState(initialRiskLevelRules);\n  const [riskWeights, setRiskWeights] = useState(() => normalizeRiskWeighting(initialRiskWeights));\n  const [teams, setTeams] = useState(initialTeams);\n  const [showcaseThemes, setShowcaseThemes] = useState(initialShowcaseThemes);\n  const [projectFilters, setProjectFiltersState] = useState(() => createDefaultProjectFiltersConfig());\n  const [inspirationFilters, setInspirationFilters] = useState(() => createDefaultInspirationFiltersConfig());\n  const [inspirationFormFields, setInspirationFormFields] = useState(() => createDefaultInspirationFormConfig());\n  const [homeView, setHomeView] = useState('platform');\n  const [isHydrated, setIsHydrated] = useState(false);\n  const [isBackOfficeUnlocked, setIsBackOfficeUnlocked] = useState(false);\n  const [backOfficeAuthError, setBackOfficeAuthError] = useState(null);\n  const [isBackOfficePromptOpen, setIsBackOfficePromptOpen] = useState(false);\n  const [backOfficePromptValue, setBackOfficePromptValue] = useState('');\n  const [backOfficePromptError, setBackOfficePromptError] = useState('');\n\n  const normalizedOnboardingConfig = useMemo(\n    () => normalizeOnboardingConfig(onboardingTourConfig),\n    [onboardingTourConfig]\n  );\n  const backOfficePromptResolverRef = useRef(null);\n  const [adminView, setAdminView] = useState('home');\n  const showcaseShareInputRef = useRef(null);\n  const [showcaseDisplayMode, setShowcaseDisplayMode] = useState('full');\n  const [showcaseDisplayModeLock, setShowcaseDisplayModeLock] = useState(null);\n  const [showcaseShareMode, setShowcaseShareMode] = useState('full');\n  const [showcaseShareCommentsEnabled, setShowcaseShareCommentsEnabled] = useState(false);\n  const [isShowcaseSharedView, setIsShowcaseSharedView] = useState(false);\n  const [showcaseCommentsEnabled, setShowcaseCommentsEnabled] = useState(false);\n  const persistTimeoutRef = useRef(null);\n  const previousScreenRef = useRef(null);\n  const pendingShowcaseDisplayModeRef = useRef(null);\n  const [isAnnotationModeEnabled, setIsAnnotationModeEnabled] = useState(false);\n  const [isAnnotationPaused, setIsAnnotationPaused] = useState(false);\n  const [annotationNotes, setAnnotationNotes] = useState([]);\n  const [annotationSources, setAnnotationSources] = useState({ session: ANNOTATION_COLORS[0] });\n  const [showcaseAnnotationScope, setShowcaseAnnotationScope] = useState('display-full');\n  const [autoFocusAnnotationId, setAutoFocusAnnotationId] = useState(null);\n  const [isShowcaseEditing, setIsShowcaseEditing] = useState(false);\n  const [isShowcaseShareOpen, setIsShowcaseShareOpen] = useState(false);\n  const [showcaseShareFeedback, setShowcaseShareFeedback] = useState('');\n  const annotationNotesRef = useRef(annotationNotes);\n  const annotationFileInputRef = useRef(null);\n  const loadedStylesRef = useRef(new Set());\n  const pendingShowcaseProjectIdRef = useRef(null);\n  const pendingShowcaseSharedRef = useRef(false);\n  const pendingShowcaseCommentsRef = useRef(false);\n\n  const ensureStylesheetLoaded = useCallback((href) => {\n    if (typeof document === 'undefined' || !href) {\n      return;\n    }\n\n    if (loadedStylesRef.current.has(href)) {\n      return;\n    }\n\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.href = href;\n    link.dataset.dynamic = 'true';\n    document.head.appendChild(link);\n    loadedStylesRef.current.add(href);\n  }, []);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') {\n      return undefined;\n    }\n\n    const handleBeforeUnload = (event) => {\n      if (!hasUnsavedChanges) {\n        return undefined;\n      }\n\n      const message = 'Avez-vous bien sauvegardé votre projet avant de quitter ?';\n      event.preventDefault();\n      event.returnValue = message;\n      return message;\n    };\n\n    window.addEventListener('beforeunload', handleBeforeUnload);\n\n    return () => {\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    };\n  }, [hasUnsavedChanges]);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') {\n      return;\n    }\n\n    const { search, hash } = window.location;\n    const params = new URLSearchParams(search || '');\n    let projectId = params.get('projectId') || params.get('showcase');\n    const rawShowcaseMode = params.get('showcaseMode');\n    const resolvedShowcaseMode = resolveShowcaseDisplayMode(rawShowcaseMode);\n    const rawShowcaseShared = params.get('showcaseShared');\n    const rawShowcaseComments = params.get('showcaseComments');\n    const isSharedView = rawShowcaseShared === '1' || rawShowcaseShared === 'true';\n    const hasCommentsEnabled = rawShowcaseComments === '1' || rawShowcaseComments === 'true';\n\n    if (!projectId && typeof hash === 'string' && hash.length > 1) {\n      const normalizedHash = hash.slice(1);\n      if (normalizedHash.startsWith('showcase=')) {\n        projectId = normalizedHash.replace(/^showcase=/, '');\n      } else if (normalizedHash.startsWith('showcase:')) {\n        projectId = normalizedHash.replace(/^showcase:/, '');\n      }\n    }\n\n    if (projectId) {\n      pendingShowcaseProjectIdRef.current = projectId;\n    }\n\n    if (resolvedShowcaseMode) {\n      pendingShowcaseDisplayModeRef.current = resolvedShowcaseMode;\n    }\n\n    if (isSharedView) {\n      pendingShowcaseSharedRef.current = true;\n    }\n\n    if (hasCommentsEnabled) {\n      pendingShowcaseCommentsRef.current = true;\n    }\n  }, []);\n\n  useEffect(() => {\n    projectsRef.current = projects;\n  }, [projects]);\n\n  useEffect(() => {\n    if (!showcaseProjectContext) {\n      return;\n    }\n\n    ensureStylesheetLoaded('./src/styles/project-showcase.css');\n    ensureStylesheetLoaded('./src/styles/project-showcase-theme-aurora.css');\n    ensureStylesheetLoaded('./src/styles/project-showcase-theme-deezer.css');\n  }, [ensureStylesheetLoaded, showcaseProjectContext]);\n\n  useEffect(() => {\n    annotationNotesRef.current = annotationNotes;\n  }, [annotationNotes]);\n\n  useEffect(() => {\n    isOnboardingActiveRef.current = isOnboardingActive;\n  }, [isOnboardingActive]);\n\n  useEffect(() => {\n    if (isOnboardingActive) {\n      return;\n    }\n\n    setProjects(prevProjects => {\n      if (!Array.isArray(prevProjects) || prevProjects.length === 0) {\n        return prevProjects;\n      }\n\n      const containsOnboardingProjects = prevProjects.some(isOnboardingProject);\n      if (!containsOnboardingProjects) {\n        return prevProjects;\n      }\n\n      const sanitizedProjects = prevProjects.filter(project => !isOnboardingProject(project));\n\n      if (sanitizedProjects.length === 0) {\n        return buildInitialProjectsState();\n      }\n\n      return cloneDeep(sanitizedProjects);\n    });\n  }, [isOnboardingActive, setProjects]);\n\n  useEffect(() => {\n    if (mode !== 'admin') {\n      setAdminView('home');\n    }\n  }, [mode]);\n\nconst updateProjectFilters = useCallback((updater) => {\n  setProjectFiltersState(prevConfig => {\n    const currentConfig = normalizeProjectFilterConfig(prevConfig);\n    const nextConfig = typeof updater === 'function' ? updater(currentConfig) : updater;\n    return normalizeProjectFilterConfig(nextConfig);\n  });\n}, []);\n\n  const updateInspirationFilters = useCallback((updater) => {\n    setInspirationFilters(prevConfig => {\n      const currentConfig = normalizeInspirationFiltersConfig(prevConfig);\n      const nextConfig = typeof updater === 'function' ? updater(currentConfig) : updater;\n      return normalizeInspirationFiltersConfig(nextConfig);\n    });\n  }, []);\n\n  const updateInspirationFormFields = useCallback((updater) => {\n    setInspirationFormFields(prevConfig => {\n      const currentConfig = normalizeInspirationFormConfig(prevConfig);\n      const nextConfig = typeof updater === 'function' ? updater(currentConfig) : updater;\n      return normalizeInspirationFormConfig(nextConfig);\n    });\n  }, []);\n\n  useEffect(() => {\n    if (!Array.isArray(showcaseThemes) || showcaseThemes.length === 0) {\n      return;\n    }\n\n    setQuestions((previousQuestions) => {\n      const nextQuestions = Array.isArray(previousQuestions)\n        ? previousQuestions.slice()\n        : [];\n      const themeQuestionIndex = nextQuestions.findIndex(question => question?.id === 'showcaseTheme');\n\n      if (themeQuestionIndex === -1) {\n        return previousQuestions;\n      }\n\n      const themeOptions = showcaseThemes\n        .map(theme => (typeof theme?.label === 'string' && theme.label.trim().length > 0\n          ? theme.label.trim()\n          : typeof theme?.id === 'string'\n            ? theme.id\n            : ''))\n        .filter(option => option.length > 0);\n\n      const existingOptions = Array.isArray(nextQuestions[themeQuestionIndex]?.options)\n        ? nextQuestions[themeQuestionIndex].options\n        : [];\n\n      if (\n        themeOptions.length === existingOptions.length &&\n        themeOptions.every((option, index) => option === existingOptions[index])\n      ) {\n        return previousQuestions;\n      }\n\n      const existingThemeQuestion = nextQuestions[themeQuestionIndex] || {};\n\n      nextQuestions[themeQuestionIndex] = {\n        ...existingThemeQuestion,\n        options: themeOptions\n      };\n\n      return nextQuestions;\n    });\n  }, [setQuestions, showcaseThemes]);\n\n  const synchronizeExternalProjects = useCallback(async () => {\n    const existingProjects = Array.isArray(projectsRef.current) ? projectsRef.current : [];\n\n    const fallbackQuestionsLength = questions.length;\n\n    const externalProjects = await loadSubmittedProjectsFromDirectory({\n      questions,\n      rules,\n      riskLevelRules,\n      riskWeights,\n      fallbackQuestionsLength,\n      existingProjects\n    });\n\n    const externalSources = new Set(externalProjects.map(entry => entry.sourceId));\n\n    setProjects(prevProjects => {\n      const baseProjects = Array.isArray(prevProjects) ? prevProjects : [];\n      const preserved = baseProjects.filter(project => (\n        !project?.externalSourceId || externalSources.has(project.externalSourceId)\n      ));\n\n      const bySource = new Map();\n      preserved.forEach(project => {\n        if (project && project.externalSourceId) {\n          bySource.set(project.externalSourceId, project);\n        }\n      });\n\n      let changed = preserved.length !== baseProjects.length;\n      const nextProjects = preserved.slice();\n\n      externalProjects.forEach(entry => {\n        const { project, sourceId, checksum } = entry;\n        if (!project || !sourceId) {\n          return;\n        }\n\n        const existing = bySource.get(sourceId);\n        if (!existing) {\n          nextProjects.push(project);\n          changed = true;\n          return;\n        }\n\n        const existingChecksum = existing.externalSourceChecksum;\n        if (existingChecksum && existingChecksum === checksum) {\n          return;\n        }\n\n        const index = nextProjects.findIndex(item => item?.externalSourceId === sourceId);\n        if (index !== -1) {\n          nextProjects[index] = project;\n        } else {\n          nextProjects.push(project);\n        }\n        changed = true;\n      });\n\n      return changed ? nextProjects : baseProjects;\n    });\n  }, [questions, riskLevelRules, riskWeights, rules]);\n\n  const synchronizeExternalInspirations = useCallback(async () => {\n    const externalInspirations = await loadSubmittedInspirationsFromDirectory();\n    const externalSources = new Set(externalInspirations.map(entry => entry.sourceId));\n\n    setInspirationProjects(prevProjects => {\n      const baseProjects = Array.isArray(prevProjects) ? prevProjects : [];\n      const preserved = baseProjects.filter(project => (\n        !project?.externalSourceId || externalSources.has(project.externalSourceId)\n      ));\n\n      const bySource = new Map();\n      preserved.forEach(project => {\n        if (project?.externalSourceId) {\n          bySource.set(project.externalSourceId, project);\n        }\n      });\n\n      let changed = preserved.length !== baseProjects.length;\n      const nextProjects = preserved.slice();\n\n      externalInspirations.forEach(entry => {\n        const { project, sourceId, checksum } = entry;\n        if (!project || !sourceId) {\n          return;\n        }\n\n        const existing = bySource.get(sourceId);\n        if (!existing) {\n          nextProjects.push(project);\n          changed = true;\n          return;\n        }\n\n        const existingChecksum = existing.externalSourceChecksum;\n        if (existingChecksum && existingChecksum === checksum) {\n          return;\n        }\n\n        const index = nextProjects.findIndex(item => item?.externalSourceId === sourceId);\n        if (index !== -1) {\n          nextProjects[index] = project;\n        } else {\n          nextProjects.push(project);\n        }\n        changed = true;\n      });\n\n      return changed ? nextProjects : baseProjects;\n    });\n  }, []);\n\n  useEffect(() => {\n    const loadExternal = async () => {\n      try {\n        await synchronizeExternalProjects();\n      } catch (error) {\n        if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n          console.warn('Impossible de synchroniser les projets externes :', error);\n        }\n      }\n    };\n\n    loadExternal();\n  }, [synchronizeExternalProjects]);\n\n  useEffect(() => {\n    const loadExternalInspirations = async () => {\n      try {\n        await synchronizeExternalInspirations();\n      } catch (error) {\n        if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n          console.warn('Impossible de synchroniser les inspirations externes :', error);\n        }\n      }\n    };\n\n    loadExternalInspirations();\n  }, [synchronizeExternalInspirations]);\n\n  useEffect(() => {\n    const savedState = loadPersistedState();\n    if (!savedState) {\n      setIsHydrated(true);\n      return;\n    }\n\n    const fallbackQuestions = Array.isArray(savedState.questions) ? savedState.questions : questions;\n    const fallbackRules = Array.isArray(savedState.rules) ? savedState.rules : rules;\n    const fallbackRiskLevelRules = Array.isArray(savedState.riskLevelRules)\n      ? savedState.riskLevelRules\n      : riskLevelRules;\n    const fallbackRiskWeights = savedState && typeof savedState.riskWeights === 'object'\n      ? normalizeRiskWeighting(savedState.riskWeights)\n      : riskWeights;\n    const fallbackQuestionsLength = resolveFallbackQuestionsLength(savedState, fallbackQuestions.length);\n\n    if (savedState.mode === 'admin') {\n      setMode('user');\n    } else if (savedState.mode) {\n      setMode(savedState.mode);\n    }\n    if (savedState.screen) setScreen(savedState.screen);\n    if (typeof savedState.currentQuestionIndex === 'number' && savedState.currentQuestionIndex >= 0) {\n      setCurrentQuestionIndex(savedState.currentQuestionIndex);\n    }\n    if (savedState.answers && typeof savedState.answers === 'object') setAnswers(savedState.answers);\n    if (typeof savedState.analysis !== 'undefined') setAnalysis(savedState.analysis);\n    if (Array.isArray(savedState.projects)) {\n      const normalized = normalizeProjectsCollection(savedState.projects, fallbackQuestionsLength);\n      if (normalized && normalized.length > 0) {\n        setProjects(normalized);\n      } else {\n        setProjects([createDemoProject({\n          questions: fallbackQuestions,\n          rules: fallbackRules,\n          riskLevelRules: fallbackRiskLevelRules,\n          riskWeights: fallbackRiskWeights\n        })]);\n      }\n    } else if (Array.isArray(savedState.submittedProjects)) {\n      const normalized = normalizeProjectsCollection(savedState.submittedProjects, fallbackQuestionsLength);\n      if (normalized && normalized.length > 0) {\n        setProjects(normalized);\n      } else {\n        setProjects([createDemoProject({\n          questions: fallbackQuestions,\n          rules: fallbackRules,\n          riskLevelRules: fallbackRiskLevelRules,\n          riskWeights: fallbackRiskWeights\n        })]);\n      }\n    }\n    if (typeof savedState.activeProjectId === 'string') setActiveProjectId(savedState.activeProjectId);\n    if (typeof savedState.activeInspirationId === 'string') setActiveInspirationId(savedState.activeInspirationId);\n    if (typeof savedState.homeView === 'string') setHomeView(savedState.homeView);\n    if (Array.isArray(savedState.questions)) {\n      setQuestions(restoreShowcaseQuestions(savedState.questions));\n    }\n    if (Array.isArray(savedState.rules)) setRules(savedState.rules);\n    if (Array.isArray(savedState.riskLevelRules)) setRiskLevelRules(savedState.riskLevelRules);\n    if (savedState && typeof savedState.riskWeights === 'object') {\n      setRiskWeights(normalizeRiskWeighting(savedState.riskWeights));\n    }\n    if (Array.isArray(savedState.teams)) setTeams(savedState.teams);\n    if (Array.isArray(savedState.showcaseThemes)) setShowcaseThemes(savedState.showcaseThemes);\n    if (savedState && typeof savedState.projectFilters === 'object') {\n      setProjectFiltersState(normalizeProjectFilterConfig(savedState.projectFilters));\n    }\n    if (Array.isArray(savedState.inspirationProjects)) {\n      setInspirationProjects(cloneDeep(savedState.inspirationProjects));\n    }\n    if (savedState && typeof savedState.inspirationFilters === 'object') {\n      setInspirationFilters(normalizeInspirationFiltersConfig(savedState.inspirationFilters));\n    }\n    if (savedState && typeof savedState.inspirationFormFields === 'object') {\n      setInspirationFormFields(normalizeInspirationFormConfig(savedState.inspirationFormFields));\n    }\n    if (savedState && savedState.onboardingTourConfig) {\n      setOnboardingTourConfig(normalizeOnboardingConfig(savedState.onboardingTourConfig));\n    }\n\n    setIsHydrated(true);\n  }, []);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') {\n      return undefined;\n    }\n\n    let disposed = false;\n\n    const updateStatus = () => {\n      if (disposed) {\n        return;\n      }\n      setIsTourGuideReady(Boolean(window.TourGuideClient));\n    };\n\n    updateStatus();\n\n    if (window.TourGuideClient) {\n      return () => {\n        disposed = true;\n      };\n    }\n\n    const intervalId = window.setInterval(() => {\n      if (window.TourGuideClient) {\n        updateStatus();\n        window.clearInterval(intervalId);\n      }\n    }, 500);\n\n    return () => {\n      disposed = true;\n      window.clearInterval(intervalId);\n    };\n  }, []);\n\n  const noop = useCallback(() => {}, []);\n\n  const computeDemoData = useCallback(() => {\n    const answers = cloneDeep(demoProjectAnswersSnapshot) || {};\n    const visibleQuestions = questions.filter(question => shouldShowQuestion(question, answers));\n    const analysisResult = analyzeAnswers(answers, rules, riskLevelRules, riskWeights);\n    const relevantTeamsList = Array.isArray(teams)\n      ? teams.filter(team => (analysisResult?.teams || []).includes(team.id))\n      : [];\n    const timelineDetails = analysisResult?.timeline?.details || [];\n    const projectName = typeof answers.projectName === 'string' && answers.projectName.trim().length > 0\n      ? answers.projectName.trim()\n      : 'Projet de démonstration';\n\n    return {\n      answers,\n      analysis: analysisResult,\n      questions: visibleQuestions.length > 0 ? visibleQuestions : questions,\n      projectName,\n      relevantTeams: relevantTeamsList,\n      timelineDetails\n    };\n  }, [questions, riskLevelRules, riskWeights, rules, shouldShowQuestion, teams]);\n\n  const getDemoData = useCallback(() => {\n    if (!onboardingDemoDataRef.current) {\n      onboardingDemoDataRef.current = computeDemoData();\n    }\n\n    return onboardingDemoDataRef.current;\n  }, [computeDemoData]);\n\n  const buildOnboardingProjects = useCallback((demoData) => {\n    const baseAnswers = cloneDeep(demoData?.answers || demoProjectAnswersSnapshot || {});\n    const now = Date.now();\n\n    const createEntry = (config) => {\n      const offsetMs = typeof config.offsetMs === 'number' ? config.offsetMs : 0;\n      const timestamp = config.timestamp || new Date(now - offsetMs).toISOString();\n      const answersPatch = config.answers || {};\n      const answers = cloneDeep({ ...baseAnswers, ...answersPatch });\n      if (config.projectName) {\n        answers.projectName = config.projectName;\n      }\n\n      const projectName = typeof answers.projectName === 'string' && answers.projectName.trim().length > 0\n        ? answers.projectName.trim()\n        : 'Projet sans nom';\n\n      const analysisResult = analyzeAnswers(answers, rules, riskLevelRules, riskWeights);\n      const visibleQuestions = questions.filter(question => shouldShowQuestion(question, answers));\n      const totalQuestions = visibleQuestions.length > 0 ? visibleQuestions.length : questions.length;\n      const answeredQuestions = visibleQuestions.filter(question => isAnswerProvided(answers[question.id])).length;\n      const status = config.status || 'draft';\n\n      return {\n        id: config.id,\n        projectName,\n        answers,\n        analysis: analysisResult,\n        status,\n        lastUpdated: config.lastUpdated || timestamp,\n        generatedAt: config.generatedAt || timestamp,\n        submittedAt: status === 'submitted' ? (config.submittedAt || timestamp) : undefined,\n        totalQuestions,\n        answeredQuestions: Math.min(answeredQuestions, totalQuestions || answeredQuestions),\n        lastQuestionIndex:\n          typeof config.lastQuestionIndex === 'number'\n            ? config.lastQuestionIndex\n            : (status === 'submitted' && totalQuestions > 0\n              ? totalQuestions - 1\n              : Math.max(totalQuestions - 2, 0)),\n        isDemo: true\n      };\n    };\n\n    return [\n      createEntry({\n        id: 'tour-draft-1',\n        projectName: 'Atlas Connect',\n        status: 'draft',\n        offsetMs: 86400000,\n        answers: {\n          teamLead: 'Léa Martin',\n          teamLeadTeam: 'Digital'\n        }\n      }),\n      createEntry({\n        id: 'tour-submitted',\n        projectName: 'Pulse Live',\n        status: 'submitted',\n        offsetMs: 432000000,\n        answers: {\n          teamLead: 'Noah Carpentier',\n          teamLeadTeam: 'Marketing'\n        }\n      }),\n      createEntry({\n        id: 'tour-draft-demo',\n        projectName: demoData?.projectName || 'Plasma 360',\n        status: 'draft',\n        offsetMs: 172800000,\n        answers: {}\n      })\n    ];\n  }, [analyzeAnswers, questions, riskLevelRules, riskWeights, rules, shouldShowQuestion]);\n\n  const restoreOnboardingSnapshot = useCallback(() => {\n    const snapshot = onboardingStateRef.current;\n    onboardingStateRef.current = null;\n    onboardingDemoDataRef.current = null;\n\n    if (!snapshot) {\n      setMode('user');\n      setAdminView('home');\n      setScreen('home');\n      setAnswers({});\n      setAnalysis(null);\n      setProjects(buildInitialProjectsState());\n      setProjectFiltersState(createDefaultProjectFiltersConfig());\n      setCurrentQuestionIndex(0);\n      setValidationError(null);\n      setSaveFeedback(null);\n      setActiveProjectId(null);\n      setShowcaseProjectContext(null);\n      setHasUnsavedChanges(false);\n      setBackOfficeAuthError(null);\n      setIsBackOfficeUnlocked(false);\n      return;\n    }\n\n    setMode(snapshot.mode || 'user');\n    setAdminView(snapshot.adminView || 'home');\n    setScreen(snapshot.screen || 'home');\n    setAnswers(snapshot.answers || {});\n    setAnalysis(typeof snapshot.analysis !== 'undefined' ? snapshot.analysis : null);\n    const restoredProjects = sanitizeRestoredProjects(snapshot.projects);\n    setProjects(\n      restoredProjects.length > 0\n        ? restoredProjects\n        : buildInitialProjectsState()\n    );\n    setProjectFiltersState(\n      snapshot.projectFilters\n        ? normalizeProjectFilterConfig(snapshot.projectFilters)\n        : createDefaultProjectFiltersConfig()\n    );\n    setCurrentQuestionIndex(\n      typeof snapshot.currentQuestionIndex === 'number' && snapshot.currentQuestionIndex >= 0\n        ? snapshot.currentQuestionIndex\n        : 0\n    );\n    setValidationError(snapshot.validationError || null);\n    setSaveFeedback(snapshot.saveFeedback || null);\n    setActiveProjectId(typeof snapshot.activeProjectId === 'string' ? snapshot.activeProjectId : null);\n    setShowcaseProjectContext(snapshot.showcaseProjectContext || null);\n    setHasUnsavedChanges(Boolean(snapshot.hasUnsavedChanges));\n    setBackOfficeAuthError(snapshot.backOfficeAuthError || null);\n    setIsBackOfficeUnlocked(Boolean(snapshot.isBackOfficeUnlocked));\n  }, [\n    setActiveProjectId,\n    setAdminView,\n    setAnalysis,\n    setAnswers,\n    setBackOfficeAuthError,\n    setCurrentQuestionIndex,\n    setHasUnsavedChanges,\n    setIsBackOfficeUnlocked,\n    setMode,\n    setProjectFiltersState,\n    setProjects,\n    setSaveFeedback,\n    setScreen,\n    setShowcaseProjectContext,\n    setValidationError\n  ]);\n\n  const finishOnboarding = useCallback((options = {}) => {\n    const { shouldLoadIndex = false } = options || {};\n    const snapshotExists = Boolean(onboardingStateRef.current);\n    const wasOnboardingActive = isOnboardingActiveRef.current;\n\n    if (!wasOnboardingActive && !snapshotExists) {\n      return;\n    }\n\n    isOnboardingActiveRef.current = false;\n    setIsOnboardingActive(false);\n    setOnboardingStepId(null);\n\n    const tourInstance = tourInstanceRef.current;\n    tourInstanceRef.current = null;\n\n    if (tourInstance && typeof tourInstance.stop === 'function') {\n      try {\n        tourInstance.stop();\n      } catch (error) {\n        if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n          console.warn('[Onboarding] Impossible de stopper le guide :', error);\n        }\n      }\n    }\n\n    if (snapshotExists) {\n      restoreOnboardingSnapshot();\n    }\n\n    if (shouldLoadIndex && typeof window !== 'undefined') {\n      const redirect = () => {\n        try {\n          if (window.location) {\n            if (typeof window.location.assign === 'function') {\n              window.location.assign('./index.html');\n            } else {\n              window.location.href = './index.html';\n            }\n          }\n        } catch (error) {\n          if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n            console.warn('[Onboarding] Impossible de charger la page d\\'accueil :', error);\n          }\n        }\n      };\n\n      if (typeof window.requestAnimationFrame === 'function') {\n        window.requestAnimationFrame(() => redirect());\n      } else if (typeof window.setTimeout === 'function') {\n        window.setTimeout(() => redirect(), 0);\n      }\n    }\n  }, [restoreOnboardingSnapshot]);\n\n  const handleOnboardingStepEnter = useCallback((stepId) => {\n    if (!stepId) {\n      return;\n    }\n\n    const demoData = getDemoData();\n\n    const openDemoShowcase = () => {\n      openProjectShowcase({\n        projectId: null,\n        projectName: demoData.projectName,\n        answers: cloneDeep(demoData.answers),\n        analysis: demoData.analysis,\n        relevantTeams: demoData.relevantTeams,\n        questions: demoData.questions,\n        timelineDetails: demoData.timelineDetails,\n        status: 'draft'\n      });\n      setHasUnsavedChanges(false);\n    };\n\n    const ensureShowcaseTopVisible = () => {\n      if (typeof window === 'undefined') {\n        return;\n      }\n\n      const scrollToTop = () => {\n        try {\n          if (typeof document !== 'undefined') {\n            const topSection = document.querySelector('[data-tour-id=\"showcase-preview\"]');\n            if (topSection && typeof topSection.scrollIntoView === 'function') {\n              topSection.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'nearest' });\n              return;\n            }\n          }\n\n          if (typeof window.scrollTo === 'function') {\n            window.scrollTo({ top: 0, behavior: 'smooth' });\n          }\n        } catch (error) {\n          if (typeof window.scrollTo === 'function') {\n            window.scrollTo({ top: 0 });\n          }\n        }\n      };\n\n      if (typeof window.requestAnimationFrame === 'function') {\n        window.requestAnimationFrame(() => {\n          if (typeof window.setTimeout === 'function') {\n            window.setTimeout(scrollToTop, 0);\n          } else {\n            scrollToTop();\n          }\n        });\n        return;\n      }\n\n      if (typeof window.setTimeout === 'function') {\n        window.setTimeout(scrollToTop, 0);\n        return;\n      }\n\n      scrollToTop();\n    };\n\n    switch (stepId) {\n      case 'welcome':\n      case 'create-project': {\n        setScreen('home');\n        setShowcaseProjectContext(null);\n        setActiveProjectId(null);\n        setValidationError(null);\n        setSaveFeedback(null);\n        setHasUnsavedChanges(false);\n        break;\n      }\n      case 'question-overview':\n      case 'question-guidance':\n      case 'project-save-anytime': {\n        setShowcaseProjectContext(null);\n        setScreen('questionnaire');\n        setActiveProjectId('onboarding-demo');\n        setAnswers(cloneDeep(demoData.answers));\n        setCurrentQuestionIndex(0);\n        setAnalysis(null);\n        setValidationError(null);\n        setSaveFeedback(null);\n        setHasUnsavedChanges(false);\n        break;\n      }\n      case 'questionnaire-finish': {\n        setShowcaseProjectContext(null);\n        setScreen('questionnaire');\n        setActiveProjectId('onboarding-demo');\n        setAnswers(cloneDeep(demoData.answers));\n        setAnalysis(null);\n        setValidationError(null);\n        setSaveFeedback(null);\n        setHasUnsavedChanges(false);\n        const totalQuestionsCount = Array.isArray(demoData.questions) && demoData.questions.length > 0\n          ? demoData.questions.length\n          : questions.length;\n        const lastIndex = totalQuestionsCount > 0 ? totalQuestionsCount - 1 : 0;\n        setCurrentQuestionIndex(lastIndex);\n        break;\n      }\n      case 'compliance-report-top':\n      case 'compliance-teams':\n      case 'compliance-risks':\n      case 'compliance-submit':\n      case 'compliance-save':\n      case 'compliance-showcase-button': {\n        setAnswers(cloneDeep(demoData.answers));\n        setAnalysis(demoData.analysis);\n        setCurrentQuestionIndex(0);\n        setValidationError(null);\n        setScreen('synthesis');\n        setSaveFeedback(null);\n        setHasUnsavedChanges(false);\n        break;\n      }\n      case 'showcase-top': {\n        openDemoShowcase();\n        ensureShowcaseTopVisible();\n        break;\n      }\n      case 'showcase-bottom':\n      case 'showcase-edit-trigger':\n      case 'showcase-edit':\n      case 'showcase-save-edits':\n      case 'showcase-back-to-report': {\n        openDemoShowcase();\n        break;\n      }\n      case 'project-import':\n      case 'project-filters': {\n        setShowcaseProjectContext(null);\n        setScreen('home');\n        setActiveProjectId(null);\n        setValidationError(null);\n        setSaveFeedback(null);\n        setHasUnsavedChanges(false);\n        break;\n      }\n      default:\n        break;\n    }\n  }, [\n    getDemoData,\n    openProjectShowcase,\n    screen,\n    questions,\n    setActiveProjectId,\n    setAnalysis,\n    setAnswers,\n    setCurrentQuestionIndex,\n    setHasUnsavedChanges,\n    setSaveFeedback,\n    setScreen,\n    setShowcaseProjectContext,\n    setValidationError\n  ]);\n\n  const handleStartOnboarding = useCallback(() => {\n    if (isOnboardingActive) {\n      return;\n    }\n\n    if (typeof window === 'undefined' || typeof window.TourGuideClient !== 'function') {\n      if (typeof window !== 'undefined' && typeof window.alert === 'function') {\n        window.alert('Le guide interactif est momentanément indisponible.');\n      }\n      return;\n    }\n\n    onboardingStateRef.current = {\n      mode,\n      screen,\n      adminView,\n      answers: cloneDeep(answers),\n      analysis: cloneDeep(analysis),\n      projects: cloneDeep(projects),\n      projectFilters: cloneDeep(projectFilters),\n      currentQuestionIndex,\n      validationError: cloneDeep(validationError),\n      saveFeedback: cloneDeep(saveFeedback),\n      activeProjectId,\n      showcaseProjectContext: cloneDeep(showcaseProjectContext),\n      hasUnsavedChanges,\n      backOfficeAuthError,\n      isBackOfficeUnlocked\n    };\n\n    const demoData = getDemoData();\n    onboardingDemoDataRef.current = demoData;\n    const onboardingProjects = buildOnboardingProjects(demoData);\n\n    isOnboardingActiveRef.current = true;\n    setIsOnboardingActive(true);\n    setOnboardingStepId(null);\n    setMode('user');\n    setAdminView('home');\n    setScreen('home');\n    setShowcaseProjectContext(null);\n    setActiveProjectId(null);\n    setAnswers({});\n    setAnalysis(null);\n    setValidationError(null);\n    setSaveFeedback(null);\n    setHasUnsavedChanges(false);\n    setBackOfficeAuthError(null);\n    setIsBackOfficeUnlocked(false);\n    setProjects(onboardingProjects);\n    setProjectFiltersState(createDefaultProjectFiltersConfig());\n\n    const {\n      steps,\n      labels,\n      allowClose,\n      showStepDots\n    } = normalizedOnboardingConfig;\n\n    if (!Array.isArray(steps) || steps.length === 0) {\n      if (typeof window !== 'undefined' && typeof window.alert === 'function') {\n        window.alert('Le tour d’onboarding est vide. Veuillez vérifier la configuration.');\n      }\n      return;\n    }\n\n    const tour = new window.TourGuideClient({\n      steps,\n      labels,\n      allowClose,\n      showStepDots\n    });\n\n    tour.on('stepChange', ({ step }) => {\n      const stepId = step?.id || null;\n      handleOnboardingStepEnter(stepId);\n      setOnboardingStepId(stepId);\n    });\n\n    tour.on('close', () => {\n      finishOnboarding({ shouldLoadIndex: true });\n    });\n\n    tour.on('finish', () => {\n      finishOnboarding({ shouldLoadIndex: true });\n    });\n\n    tour.start();\n    tourInstanceRef.current = tour;\n  }, [\n    isOnboardingActive,\n    mode,\n    screen,\n    adminView,\n    answers,\n    analysis,\n    projects,\n    projectFilters,\n    currentQuestionIndex,\n    validationError,\n    saveFeedback,\n    activeProjectId,\n    showcaseProjectContext,\n    hasUnsavedChanges,\n    backOfficeAuthError,\n    isBackOfficeUnlocked,\n    getDemoData,\n    buildOnboardingProjects,\n    normalizedOnboardingConfig,\n    handleOnboardingStepEnter,\n    finishOnboarding,\n    setMode,\n    setAdminView,\n    setScreen,\n    setShowcaseProjectContext,\n    setActiveProjectId,\n    setAnswers,\n    setAnalysis,\n    setValidationError,\n    setSaveFeedback,\n    setHasUnsavedChanges,\n    setBackOfficeAuthError,\n    setIsBackOfficeUnlocked,\n    setProjects,\n    setProjectFiltersState\n  ]);\n\n  useEffect(() => () => {\n    if (tourInstanceRef.current && typeof tourInstanceRef.current.stop === 'function') {\n      try {\n        tourInstanceRef.current.stop();\n      } catch (error) {\n        if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n          console.warn('[Onboarding] Nettoyage du guide impossible :', error);\n        }\n      }\n    }\n    tourInstanceRef.current = null;\n  }, []);\n\n  useEffect(() => {\n    return () => {\n      if (persistTimeoutRef.current) {\n        clearTimeout(persistTimeoutRef.current);\n        persistTimeoutRef.current = null;\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!isHydrated || isOnboardingActive) return undefined;\n\n    if (persistTimeoutRef.current) {\n      clearTimeout(persistTimeoutRef.current);\n    }\n\n    persistTimeoutRef.current = setTimeout(() => {\n      const modeToPersist = mode === 'admin' ? 'user' : mode;\n\n      persistState({\n        mode: modeToPersist,\n        screen,\n        currentQuestionIndex,\n        answers,\n        analysis,\n        questions,\n        rules,\n        riskLevelRules,\n        riskWeights,\n        teams,\n        showcaseThemes,\n        projects,\n        activeProjectId,\n        projectFilters: normalizeProjectFilterConfig(projectFilters),\n        inspirationProjects,\n        inspirationFilters: normalizeInspirationFiltersConfig(inspirationFilters),\n        inspirationFormFields: normalizeInspirationFormConfig(inspirationFormFields),\n        onboardingTourConfig: normalizedOnboardingConfig,\n        homeView,\n        activeInspirationId\n      });\n      persistTimeoutRef.current = null;\n    }, 200);\n\n    return () => {\n      if (persistTimeoutRef.current) {\n        clearTimeout(persistTimeoutRef.current);\n        persistTimeoutRef.current = null;\n      }\n    };\n  }, [\n    mode,\n    screen,\n    currentQuestionIndex,\n    answers,\n    analysis,\n    questions,\n    rules,\n    riskLevelRules,\n    riskWeights,\n    teams,\n    showcaseThemes,\n    projects,\n    activeProjectId,\n    projectFilters,\n    inspirationProjects,\n    inspirationFilters,\n    inspirationFormFields,\n    normalizedOnboardingConfig,\n    homeView,\n    activeInspirationId,\n    isHydrated,\n    isOnboardingActive\n  ]);\n\n  const tourContext = useMemo(\n    () => (isOnboardingActive ? { isActive: true, activeStep: onboardingStepId } : null),\n    [isOnboardingActive, onboardingStepId]\n  );\n\n  const activeQuestions = useMemo(\n    () => questions.filter(q => shouldShowQuestion(q, answers)),\n    [questions, answers]\n  );\n\n  const unansweredMandatoryQuestions = useMemo(\n    () =>\n      activeQuestions.filter(question => question.required && !isAnswerProvided(answers[question.id])),\n    [activeQuestions, answers]\n  );\n\n  const pendingMandatoryQuestions = useMemo(\n    () =>\n      unansweredMandatoryQuestions.map(question => ({\n        question,\n        position: activeQuestions.findIndex(item => item.id === question.id) + 1\n      })),\n    [unansweredMandatoryQuestions, activeQuestions]\n  );\n\n  const hasIncompleteAnswers = useMemo(\n    () => activeQuestions.some(question => !isAnswerProvided(answers[question.id])),\n    [activeQuestions, answers]\n  );\n\n  const teamLeadTeamOptions = useMemo(() => {\n    const leadTeamQuestion = questions.find(question => question?.id === 'teamLeadTeam');\n    if (!leadTeamQuestion || !Array.isArray(leadTeamQuestion.options)) {\n      return [];\n    }\n\n    const sanitized = leadTeamQuestion.options\n      .map(option => (typeof option === 'string' ? option.trim() : ''))\n      .filter(option => option.length > 0);\n\n    return Array.from(new Set(sanitized));\n  }, [questions]);\n\n  useEffect(() => {\n    if (!isHydrated) return;\n    if (activeQuestions.length === 0) return;\n    if (currentQuestionIndex >= activeQuestions.length) {\n      setCurrentQuestionIndex(activeQuestions.length - 1);\n    }\n  }, [activeQuestions.length, currentQuestionIndex, isHydrated]);\n\n  useEffect(() => {\n    if (screen !== 'questionnaire' && screen !== 'synthesis') {\n      setSaveFeedback(null);\n    }\n  }, [screen]);\n\n  const activeProject = useMemo(\n    () => projects.find(project => project.id === activeProjectId) || null,\n    [projects, activeProjectId]\n  );\n  const activeInspirationProject = useMemo(\n    () => inspirationProjects.find(project => project.id === activeInspirationId) || null,\n    [inspirationProjects, activeInspirationId]\n  );\n\n  const activeProjectName = useMemo(() => {\n    if (typeof activeProject?.projectName === 'string' && activeProject.projectName.trim().length > 0) {\n      return activeProject.projectName.trim();\n    }\n\n    return extractProjectName(answers, questions);\n  }, [activeProject, answers, questions]);\n\n  const activeShowcaseProjectId = showcaseProjectContext?.projectId || null;\n\n  const activeAnnotationContextKey = useMemo(\n    () => buildAnnotationContextKey({\n      screen,\n      projectId: activeShowcaseProjectId,\n      scope: showcaseAnnotationScope\n    }),\n    [activeShowcaseProjectId, screen, showcaseAnnotationScope]\n  );\n\n  const registerAnnotationSource = useCallback((sourceId, preferredColor) => {\n    if (!sourceId) {\n      return ANNOTATION_COLORS[0];\n    }\n\n    let resolvedColor = ANNOTATION_COLORS[0];\n\n    setAnnotationSources(prevSources => {\n      if (prevSources[sourceId]) {\n        resolvedColor = prevSources[sourceId];\n        return prevSources;\n      }\n\n      const usedColors = new Set(Object.values(prevSources));\n\n      if (preferredColor && !usedColors.has(preferredColor)) {\n        resolvedColor = preferredColor;\n      } else {\n        const availableColor = ANNOTATION_COLORS.find(color => !usedColors.has(color));\n        resolvedColor = availableColor || ANNOTATION_COLORS[0];\n      }\n\n      return { ...prevSources, [sourceId]: resolvedColor };\n    });\n\n    return resolvedColor;\n  }, []);\n\n  const resolveAnnotationTarget = useCallback((clientX, clientY, targetElement = null) => {\n    if (typeof document === 'undefined') {\n      return { sectionId: null, sectionX: null, sectionY: null };\n    }\n\n    const activeTarget = targetElement instanceof Element\n      ? targetElement\n      : document.elementFromPoint(clientX, clientY);\n\n    const sectionElement = activeTarget?.closest('[data-showcase-section]');\n\n    if (!sectionElement) {\n      return { sectionId: null, sectionX: null, sectionY: null };\n    }\n\n    const rect = sectionElement.getBoundingClientRect();\n    const sectionWidth = rect?.width || 1;\n    const sectionHeight = rect?.height || 1;\n\n    return {\n      sectionId: sectionElement.getAttribute('data-showcase-section') || null,\n      sectionX: clamp01((clientX - rect.left) / sectionWidth),\n      sectionY: clamp01((clientY - rect.top) / sectionHeight)\n    };\n  }, []);\n\n  const handleAddAnnotationNote = useCallback((clientX, clientY, targetElement = null) => {\n    if (screen !== 'showcase' || !showcaseProjectContext || isAnnotationPaused) {\n      return;\n    }\n\n    const width = typeof window !== 'undefined' ? window.innerWidth || 1 : 1;\n    const height = typeof window !== 'undefined' ? window.innerHeight || 1 : 1;\n    const x = clamp01(clientX / width);\n    const y = clamp01(clientY / height);\n    const sourceId = 'session';\n    const color = registerAnnotationSource(sourceId);\n    const { sectionId, sectionX, sectionY } = resolveAnnotationTarget(clientX, clientY, targetElement);\n\n    const newNoteId = createAnnotationId();\n\n    setAnnotationNotes(prevNotes => [\n      ...prevNotes,\n      {\n        id: newNoteId,\n        x,\n        y,\n        sectionId,\n        sectionX: sectionX ?? x,\n        sectionY: sectionY ?? y,\n        text: '',\n        color,\n        contextId: activeAnnotationContextKey,\n        projectId: showcaseProjectContext.projectId || 'unknown',\n        projectName: showcaseProjectContext.projectName || '',\n        sourceId\n      }\n    ]);\n    setAutoFocusAnnotationId(newNoteId);\n  }, [\n    activeAnnotationContextKey,\n    isAnnotationPaused,\n    registerAnnotationSource,\n    resolveAnnotationTarget,\n    screen,\n    showcaseProjectContext\n  ]);\n\n  const handleAnnotationTextChange = useCallback((noteId, text) => {\n    setAnnotationNotes(prevNotes => prevNotes.map(note => (\n      note?.id === noteId\n        ? { ...note, text }\n        : note\n    )));\n  }, []);\n\n  const handleRemoveAnnotationNote = useCallback((noteId) => {\n    setAnnotationNotes(prevNotes => prevNotes.filter(note => note?.id !== noteId));\n  }, []);\n\n  const handleToggleAnnotationMode = useCallback(() => {\n    setIsAnnotationModeEnabled(prev => {\n      const next = !prev;\n\n      if (!next) {\n        setIsAnnotationPaused(false);\n      }\n\n      return next;\n    });\n  }, []);\n\n  const handleToggleAnnotationPause = useCallback(() => {\n    setIsAnnotationPaused(prev => !prev);\n  }, []);\n\n  const downloadAnnotationFile = useCallback((notesToSave, projectName) => {\n    if (!Array.isArray(notesToSave) || notesToSave.length === 0 || typeof window === 'undefined') {\n      return;\n    }\n\n    const safeName = typeof projectName === 'string' && projectName.trim().length > 0\n      ? projectName.trim()\n      : 'projet';\n\n    const payload = JSON.stringify(notesToSave, null, 2);\n    const blob = new Blob([payload], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const anchor = document.createElement('a');\n    anchor.href = url;\n    anchor.download = `Commentaire sur le projet ${safeName}.json`;\n    anchor.click();\n    URL.revokeObjectURL(url);\n  }, []);\n\n  const handleSaveAnnotationNotes = useCallback(() => {\n    if (!showcaseProjectContext) {\n      return;\n    }\n\n    const projectNotes = annotationNotes.filter(note => note?.projectId === showcaseProjectContext.projectId);\n\n    if (projectNotes.length === 0) {\n      return;\n    }\n\n    downloadAnnotationFile(projectNotes, showcaseProjectContext.projectName);\n  }, [annotationNotes, downloadAnnotationFile, showcaseProjectContext]);\n\n  const handleRequestAnnotationFile = useCallback(() => {\n    if (annotationFileInputRef.current) {\n      annotationFileInputRef.current.value = '';\n      annotationFileInputRef.current.click();\n    }\n  }, []);\n\n  const handleAnnotationFileChange = useCallback((event) => {\n    const [file] = event?.target?.files || [];\n    const fileInput = event?.target;\n\n    if (!file) {\n      return;\n    }\n\n    const reader = new FileReader();\n\n    reader.onload = () => {\n      try {\n        const parsed = JSON.parse(reader.result || '[]');\n        const rawNotes = Array.isArray(parsed)\n          ? parsed\n          : Array.isArray(parsed?.notes)\n            ? parsed.notes\n            : [];\n\n        if (!Array.isArray(rawNotes) || rawNotes.length === 0) {\n          return;\n        }\n\n        const sourceId = file.name || `import-${Date.now()}`;\n        const sourceColor = registerAnnotationSource(sourceId);\n\n        const importedNotes = rawNotes.map(rawNote => {\n          const normalizedX = clamp01(rawNote?.x ?? 0);\n          const normalizedY = clamp01(rawNote?.y ?? 0);\n\n          return {\n            id: rawNote?.id || createAnnotationId(),\n            x: normalizedX,\n            y: normalizedY,\n            sectionId: typeof rawNote?.sectionId === 'string' ? rawNote.sectionId : null,\n            sectionX: clamp01(rawNote?.sectionX ?? normalizedX),\n            sectionY: clamp01(rawNote?.sectionY ?? normalizedY),\n            text: typeof rawNote?.text === 'string' ? rawNote.text : '',\n            color: sourceColor,\n            contextId: rawNote?.contextId || activeAnnotationContextKey,\n            projectId: rawNote?.projectId || showcaseProjectContext?.projectId || 'unknown',\n            projectName: rawNote?.projectName || showcaseProjectContext?.projectName || '',\n            sourceId\n          };\n        });\n\n        setAnnotationNotes(prevNotes => [...prevNotes, ...importedNotes]);\n      } catch (error) {\n        // Malformed file, ignore silently\n      } finally {\n        if (fileInput) {\n          fileInput.value = '';\n        }\n      }\n    };\n\n    reader.readAsText(file);\n  }, [activeAnnotationContextKey, registerAnnotationSource, showcaseProjectContext]);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') {\n      return undefined;\n    }\n\n    if (!isAnnotationModeEnabled || isAnnotationPaused || screen !== 'showcase') {\n      return undefined;\n    }\n\n    const handleDocumentClick = (event) => {\n      const target = event?.target;\n\n      if (target instanceof Element && target.closest('[data-annotation-ui=\"true\"]')) {\n        return;\n      }\n\n      handleAddAnnotationNote(event.clientX, event.clientY, target);\n    };\n\n    window.addEventListener('click', handleDocumentClick, true);\n\n    return () => {\n      window.removeEventListener('click', handleDocumentClick, true);\n    };\n  }, [handleAddAnnotationNote, isAnnotationModeEnabled, isAnnotationPaused, screen]);\n\n  useEffect(() => {\n    if (!showcaseProjectContext) {\n      return undefined;\n    }\n\n    const { projectName, projectId } = showcaseProjectContext;\n\n    return () => {\n      const projectNotes = (annotationNotesRef.current || []).filter(note => note?.projectId === projectId);\n\n      if (projectNotes.length > 0) {\n        downloadAnnotationFile(projectNotes, projectName);\n      }\n    };\n  }, [downloadAnnotationFile, showcaseProjectContext]);\n\n  const isAdminMode = mode === 'admin';\n  const isAdminHomeView = isAdminMode && adminView === 'home';\n  const isAdminBackOfficeView = isAdminMode && adminView === 'back-office';\n  const isActiveProjectEditable = isAdminMode || !activeProject || activeProject.status === 'draft';\n  const annotationOffsetClass = isAnnotationModeEnabled && screen === 'showcase'\n    ? 'pt-20 lg:pt-24'\n    : '';\n\n  const handleAnswer = useCallback((questionId, answer) => {\n    let answerChanged = false;\n    let nextAnswersSnapshot = null;\n\n    setAnswers(prevAnswers => {\n      const previousValue = prevAnswers[questionId];\n      if (!areAnswersEqual(previousValue, answer)) {\n        answerChanged = true;\n      }\n\n      const nextAnswers = { ...prevAnswers, [questionId]: answer };\n\n      const questionsToRemove = questions\n        .filter(q => !shouldShowQuestion(q, nextAnswers))\n        .map(q => q.id);\n\n      if (questionsToRemove.length === 0) {\n        if (answerChanged) {\n          nextAnswersSnapshot = nextAnswers;\n        }\n        return answerChanged ? nextAnswers : prevAnswers;\n      }\n\n      const sanitizedAnswers = { ...nextAnswers };\n      let removedExistingAnswer = false;\n      questionsToRemove.forEach(qId => {\n        if (Object.prototype.hasOwnProperty.call(sanitizedAnswers, qId)) {\n          if (Object.prototype.hasOwnProperty.call(prevAnswers, qId)) {\n            removedExistingAnswer = true;\n          }\n          delete sanitizedAnswers[qId];\n        }\n      });\n\n      if (!answerChanged) {\n        if (removedExistingAnswer) {\n          answerChanged = true;\n        } else {\n          const prevKeys = Object.keys(prevAnswers);\n          const nextKeys = Object.keys(sanitizedAnswers);\n          if (prevKeys.length !== nextKeys.length) {\n            answerChanged = true;\n          } else if (nextKeys.some(key => !areAnswersEqual(prevAnswers[key], sanitizedAnswers[key]))) {\n            answerChanged = true;\n          }\n        }\n      }\n\n      if (answerChanged) {\n        nextAnswersSnapshot = sanitizedAnswers;\n      }\n\n      return answerChanged ? sanitizedAnswers : prevAnswers;\n    });\n\n    if (!answerChanged || !nextAnswersSnapshot) {\n      setValidationError(prev => {\n        if (!prev) return null;\n        return prev.questionId === questionId ? null : prev;\n      });\n      return;\n    }\n\n    setHasUnsavedChanges(true);\n\n    const updatedAnalysis = Object.keys(nextAnswersSnapshot).length > 0\n      ? analyzeAnswers(nextAnswersSnapshot, rules, riskLevelRules, riskWeights)\n      : null;\n\n    setAnalysis(updatedAnalysis);\n\n    const relevantQuestions = questions.filter(question => shouldShowQuestion(question, nextAnswersSnapshot));\n    const answeredQuestionsCount = relevantQuestions.length > 0\n      ? relevantQuestions.filter(question => isAnswerProvided(nextAnswersSnapshot[question.id])).length\n      : Object.keys(nextAnswersSnapshot).length;\n    const inferredName = extractProjectName(nextAnswersSnapshot, questions);\n    const normalizedInferredName = typeof inferredName === 'string' ? inferredName.trim() : '';\n\n    if (activeProjectId && isActiveProjectEditable) {\n      setProjects(prevProjects => {\n        const projectIndex = prevProjects.findIndex(project => project.id === activeProjectId);\n        if (projectIndex === -1) {\n          return prevProjects;\n        }\n\n        const project = prevProjects[projectIndex];\n        if (!project) {\n          return prevProjects;\n        }\n\n        const canUpdateProject = project.status === 'draft' || isAdminMode;\n        if (!canUpdateProject) {\n          return prevProjects;\n        }\n\n        const totalQuestions = relevantQuestions.length > 0\n          ? relevantQuestions.length\n          : project.totalQuestions || questions.length || 0;\n        const sanitizedName = normalizedInferredName.length > 0\n          ? normalizedInferredName\n          : project.projectName;\n        const lastQuestionIndex = totalQuestions > 0\n          ? Math.min(Math.max(project.lastQuestionIndex ?? totalQuestions - 1, 0), totalQuestions - 1)\n          : project.lastQuestionIndex ?? 0;\n\n        const updatedProject = {\n          ...project,\n          answers: nextAnswersSnapshot,\n          analysis: updatedAnalysis,\n          projectName: sanitizedName,\n          totalQuestions,\n          answeredQuestions: Math.min(answeredQuestionsCount, totalQuestions || answeredQuestionsCount),\n          lastQuestionIndex,\n          lastUpdated: new Date().toISOString()\n        };\n\n        const nextProjects = prevProjects.slice();\n        nextProjects[projectIndex] = updatedProject;\n        return nextProjects;\n      });\n    }\n\n    setValidationError(prev => {\n      if (!prev) return null;\n      return prev.questionId === questionId ? null : prev;\n    });\n  }, [\n    activeProjectId,\n    analyzeAnswers,\n    extractProjectName,\n    isActiveProjectEditable,\n    isAdminMode,\n    questions,\n    riskLevelRules,\n    riskWeights,\n    rules,\n    setHasUnsavedChanges,\n    shouldShowQuestion\n  ]);\n\n  const handleUpdateAnswers = useCallback((updates) => {\n    if (!isActiveProjectEditable) {\n      return;\n    }\n\n    let sanitizedResult = null;\n\n    setAnswers(prevAnswers => {\n      const { nextAnswers, changed } = applyAnswerUpdates(prevAnswers, updates, questions, shouldShowQuestion);\n      if (!changed) {\n        return prevAnswers;\n      }\n      sanitizedResult = nextAnswers;\n      return nextAnswers;\n    });\n\n    if (sanitizedResult) {\n      const updatedAnalysis = analyzeAnswers(sanitizedResult, rules, riskLevelRules, riskWeights);\n      setAnalysis(updatedAnalysis);\n      setValidationError(null);\n      setHasUnsavedChanges(true);\n\n      if (activeProjectId) {\n        setProjects(prevProjects => {\n          const projectIndex = prevProjects.findIndex(project => project.id === activeProjectId);\n          if (projectIndex === -1) {\n            return prevProjects;\n          }\n\n          const project = prevProjects[projectIndex];\n          if (!project) {\n            return prevProjects;\n          }\n\n          const canUpdateProject = project.status === 'draft' || isAdminMode;\n          if (!canUpdateProject) {\n            return prevProjects;\n          }\n\n          const relevantQuestions = questions.filter(question => shouldShowQuestion(question, sanitizedResult));\n          const totalQuestions = relevantQuestions.length > 0\n            ? relevantQuestions.length\n            : project.totalQuestions || questions.length || 0;\n          const answeredQuestionsCount = relevantQuestions.length > 0\n            ? relevantQuestions.filter(question => isAnswerProvided(sanitizedResult[question.id])).length\n            : Object.keys(sanitizedResult).length;\n          const inferredName = extractProjectName(sanitizedResult, questions);\n          const sanitizedName = inferredName && inferredName.trim().length > 0\n            ? inferredName.trim()\n            : project.projectName;\n          const lastQuestionIndex = totalQuestions > 0\n            ? Math.min(Math.max(project.lastQuestionIndex ?? totalQuestions - 1, 0), totalQuestions - 1)\n            : project.lastQuestionIndex ?? 0;\n\n          const updatedProject = {\n            ...project,\n            answers: sanitizedResult,\n            analysis: updatedAnalysis,\n            projectName: sanitizedName,\n            totalQuestions,\n            answeredQuestions: Math.min(answeredQuestionsCount, totalQuestions || answeredQuestionsCount),\n            lastQuestionIndex,\n            lastUpdated: new Date().toISOString()\n          };\n\n          const nextProjects = prevProjects.slice();\n          nextProjects[projectIndex] = updatedProject;\n          return nextProjects;\n        });\n      }\n    }\n  }, [\n    activeProjectId,\n    analyzeAnswers,\n    extractProjectName,\n    isActiveProjectEditable,\n    isAdminMode,\n    setHasUnsavedChanges,\n    questions,\n    riskLevelRules,\n    riskWeights,\n    rules,\n    shouldShowQuestion\n  ]);\n\n  const resetProjectState = useCallback(() => {\n    setAnswers({});\n    setCurrentQuestionIndex(0);\n    setAnalysis(null);\n    setValidationError(null);\n    setActiveProjectId(null);\n    setHasUnsavedChanges(false);\n    setReturnToSynthesisAfterEdit(false);\n  }, [setHasUnsavedChanges]);\n\n  const openBackOfficePrompt = useCallback(() => new Promise((resolve) => {\n    backOfficePromptResolverRef.current = resolve;\n    setBackOfficePromptValue('');\n    setBackOfficePromptError('');\n    setIsBackOfficePromptOpen(true);\n  }), []);\n\n  const closeBackOfficePrompt = useCallback((result = false) => {\n    setIsBackOfficePromptOpen(false);\n    setBackOfficePromptValue('');\n    setBackOfficePromptError('');\n    const resolver = backOfficePromptResolverRef.current;\n    backOfficePromptResolverRef.current = null;\n    if (typeof resolver === 'function') {\n      resolver(result);\n    }\n  }, []);\n\n  const handleBackOfficePromptSubmit = useCallback(async (event) => {\n    event.preventDefault();\n    const trimmed = backOfficePromptValue.trim();\n    if (!trimmed) {\n      setBackOfficePromptError('Veuillez saisir un mot de passe.');\n      return;\n    }\n\n    const isValid = await verifyBackOfficePassword(trimmed);\n\n    if (isValid) {\n      setIsBackOfficeUnlocked(true);\n      setBackOfficeAuthError(null);\n      closeBackOfficePrompt(true);\n      return;\n    }\n\n    setIsBackOfficeUnlocked(false);\n    setBackOfficeAuthError('Mot de passe incorrect. Veuillez réessayer.');\n    setBackOfficePromptError('Mot de passe incorrect. Veuillez réessayer.');\n  }, [backOfficePromptValue, closeBackOfficePrompt]);\n\n  const requestAdminAccess = useCallback(async () => {\n    if (isAdminMode) {\n      setIsBackOfficeUnlocked(true);\n      setBackOfficeAuthError(null);\n      return true;\n    }\n\n    if (isBackOfficeUnlocked) {\n      setBackOfficeAuthError(null);\n      return true;\n    }\n\n    setBackOfficeAuthError(null);\n    return openBackOfficePrompt();\n  }, [\n    isAdminMode,\n    isBackOfficeUnlocked,\n    openBackOfficePrompt,\n    setBackOfficeAuthError,\n    setIsBackOfficeUnlocked\n  ]);\n\n  const handleBackOfficeClick = useCallback(async () => {\n    const hasAccess = await requestAdminAccess();\n    if (!hasAccess) {\n      return;\n    }\n\n    setMode('admin');\n    setAdminView('back-office');\n  }, [requestAdminAccess, setMode]);\n\n  const handleActivateAdminOnHome = useCallback(async () => {\n    const hasAccess = await requestAdminAccess();\n    if (!hasAccess) {\n      return;\n    }\n\n    setMode('admin');\n    setAdminView('home');\n    setScreen('home');\n  }, [requestAdminAccess, setMode, setScreen]);\n\n  const handleReturnToProjectMode = useCallback(() => {\n    setMode('user');\n    setAdminView('home');\n    setBackOfficeAuthError(null);\n  }, [setBackOfficeAuthError, setMode]);\n\n  const handleCreateNewProject = useCallback(() => {\n    resetProjectState();\n    setScreen('questionnaire');\n  }, [resetProjectState]);\n\n  const handleStartInspirationProject = useCallback(() => {\n    setScreen('inspiration-form');\n  }, []);\n\n  const handleSaveInspirationProject = useCallback((payload) => {\n    const project = {\n      id: createInspirationId(),\n      ...payload\n    };\n    setInspirationProjects((prev) => [project, ...(Array.isArray(prev) ? prev : [])]);\n    setHomeView('inspiration');\n    setScreen('home');\n  }, []);\n\n  const handleOpenInspirationProject = useCallback((projectId) => {\n    if (!projectId) {\n      return;\n    }\n    setActiveInspirationId(projectId);\n    setScreen('inspiration-detail');\n  }, []);\n\n  const handleUpdateInspirationProject = useCallback((projectId, updates) => {\n    if (!projectId || !updates) {\n      return;\n    }\n\n    setInspirationProjects((prev) => (Array.isArray(prev) ? prev : []).map((project) => {\n      if (!project || project.id !== projectId) {\n        return project;\n      }\n\n      return { ...project, ...updates };\n    }));\n  }, []);\n\n  const handleExportInspirationProject = useCallback((project) => {\n    if (!project) {\n      return;\n    }\n\n    exportInspirationToFile(project);\n  }, []);\n\n  const handleImportProject = useCallback((file) => {\n    if (!file) {\n      return;\n    }\n\n    if (typeof FileReader === 'undefined') {\n      if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n        console.warn('[projectImport] FileReader API indisponible dans cet environnement.');\n      }\n      if (typeof window !== 'undefined' && typeof window.alert === 'function') {\n        window.alert('Votre navigateur ne permet pas d\\'importer un projet depuis un fichier.');\n      }\n      return;\n    }\n\n    const reader = new FileReader();\n\n    reader.onload = (event) => {\n      try {\n        const content = typeof event?.target?.result === 'string' ? event.target.result : '';\n\n        if (!content) {\n          throw new Error('EMPTY_FILE');\n        }\n\n        const parsed = JSON.parse(content);\n        const projectData = parsed?.project && typeof parsed.project === 'object' ? parsed.project : parsed;\n\n        if (!projectData || typeof projectData !== 'object') {\n          throw new Error('INVALID_PROJECT');\n        }\n\n        const importedAnswers = projectData.answers && typeof projectData.answers === 'object'\n          ? projectData.answers\n          : {};\n        const importedAnalysis = projectData.analysis && typeof projectData.analysis === 'object'\n          ? projectData.analysis\n          : null;\n        const importedName = typeof projectData.name === 'string' ? projectData.name.trim() : '';\n        const projectName = importedName.length > 0 ? importedName : 'Projet importé';\n        const importedTotalQuestions = Array.isArray(projectData?.questionnaire?.questionIds)\n          ? projectData.questionnaire.questionIds.length\n          : undefined;\n\n        const entry = handleSaveProject({\n          id: `project-${Date.now()}`,\n          projectName,\n          answers: importedAnswers,\n          analysis: importedAnalysis,\n          status: 'draft',\n          totalQuestions: importedTotalQuestions,\n          lastQuestionIndex: 0\n        });\n\n        if (!entry) {\n          throw new Error('SAVE_FAILED');\n        }\n\n        const relevantQuestions = questions.filter(question => shouldShowQuestion(question, importedAnswers));\n        const missingMandatory = relevantQuestions.filter(question => question.required && !isAnswerProvided(importedAnswers[question.id]));\n        const firstMissingId = missingMandatory[0]?.id;\n        const derivedAnalysis = entry.analysis\n          || (Object.keys(importedAnswers).length > 0 ? analyzeAnswers(importedAnswers, rules, riskLevelRules, riskWeights) : null);\n\n        const nextIndex = firstMissingId\n          ? Math.max(relevantQuestions.findIndex(question => question.id === firstMissingId), 0)\n          : relevantQuestions.length > 0\n            ? Math.min(entry.lastQuestionIndex ?? 0, relevantQuestions.length - 1)\n            : 0;\n        const hasPendingMandatory = missingMandatory.length > 0;\n\n        setAnswers(importedAnswers);\n        setAnalysis(derivedAnalysis);\n        setCurrentQuestionIndex(nextIndex);\n        setValidationError(null);\n        setActiveProjectId(entry.id);\n        setScreen('synthesis');\n        setSaveFeedback({\n          status: 'success',\n          message: hasPendingMandatory\n            ? 'Projet importé. La synthèse est disponible. Complétez les questions obligatoires avant de soumettre.'\n            : 'Projet importé. La synthèse est disponible.'\n        });\n        setHasUnsavedChanges(false);\n      } catch (error) {\n        if (typeof console !== 'undefined' && typeof console.error === 'function') {\n          console.error('[projectImport] Impossible de charger le projet :', error);\n        }\n        if (typeof window !== 'undefined' && typeof window.alert === 'function') {\n          window.alert('Le fichier sélectionné est invalide. Veuillez vérifier le JSON exporté.');\n        }\n      }\n    };\n\n    reader.onerror = () => {\n      if (typeof console !== 'undefined' && typeof console.error === 'function') {\n        console.error('[projectImport] Échec de la lecture du fichier :', reader.error);\n      }\n      if (typeof window !== 'undefined' && typeof window.alert === 'function') {\n        window.alert('Impossible de lire le fichier sélectionné. Veuillez réessayer.');\n      }\n    };\n\n    try {\n      reader.readAsText(file, 'utf-8');\n    } catch (error) {\n      if (typeof console !== 'undefined' && typeof console.error === 'function') {\n        console.error('[projectImport] Erreur inattendue lors de la lecture du fichier :', error);\n      }\n      if (typeof window !== 'undefined' && typeof window.alert === 'function') {\n        window.alert('Une erreur est survenue lors de l\\'import du projet.');\n      }\n    }\n  }, [\n    handleSaveProject,\n    setHasUnsavedChanges,\n    questions,\n    rules,\n    riskLevelRules,\n    riskWeights,\n    shouldShowQuestion,\n    analyzeAnswers\n  ]);\n\n  const navigateToSynthesis = useCallback(() => {\n    const result = analyzeAnswers(answers, rules, riskLevelRules, riskWeights);\n    setAnalysis(result);\n    setValidationError(null);\n    setReturnToSynthesisAfterEdit(false);\n    setScreen('synthesis');\n  }, [analyzeAnswers, answers, riskLevelRules, riskWeights, rules]);\n\n  const handleNext = useCallback(() => {\n    if (currentQuestionIndex < activeQuestions.length - 1) {\n      setCurrentQuestionIndex(currentQuestionIndex + 1);\n      setValidationError(null);\n      return;\n    }\n\n    navigateToSynthesis();\n  }, [activeQuestions, currentQuestionIndex, navigateToSynthesis]);\n\n  const handleBack = useCallback(() => {\n    if (currentQuestionIndex > 0) {\n      setCurrentQuestionIndex(currentQuestionIndex - 1);\n    }\n    setValidationError(null);\n  }, [currentQuestionIndex]);\n\n  const handleRestart = useCallback(() => {\n    resetProjectState();\n    setScreen('questionnaire');\n  }, [resetProjectState]);\n\n  const handleOpenProject = useCallback((projectId, options = {}) => {\n    if (!projectId) {\n      return;\n    }\n\n    const project = projects.find(item => item.id === projectId);\n    if (!project) {\n      return;\n    }\n\n    const projectAnswers = project.answers || {};\n    const derivedQuestions = questions.filter(q => shouldShowQuestion(q, projectAnswers));\n    const derivedAnalysis = Object.keys(projectAnswers).length > 0\n      ? analyzeAnswers(projectAnswers, rules, riskLevelRules, riskWeights)\n      : null;\n    const answeredQuestionsCount = derivedQuestions.length > 0\n      ? derivedQuestions.filter(question => isAnswerProvided(projectAnswers[question.id])).length\n      : Object.keys(projectAnswers).length;\n    const missingMandatory = derivedQuestions.filter(question => question.required && !isAnswerProvided(projectAnswers[question.id]));\n    const totalQuestions = derivedQuestions.length;\n    const rawIndex = typeof project.lastQuestionIndex === 'number' ? project.lastQuestionIndex : 0;\n    const sanitizedIndex = totalQuestions > 0 ? Math.min(Math.max(rawIndex, 0), totalQuestions - 1) : 0;\n    const firstMissingId = missingMandatory[0]?.id;\n    const missingIndex = firstMissingId\n      ? derivedQuestions.findIndex(question => question.id === firstMissingId)\n      : -1;\n    const startingIndex = missingIndex >= 0 ? missingIndex : project.status === 'draft' ? sanitizedIndex : 0;\n\n    setAnswers(projectAnswers);\n    setAnalysis(derivedAnalysis);\n    setCurrentQuestionIndex(startingIndex);\n    setValidationError(null);\n    setActiveProjectId(project.id);\n\n    setProjects(prevProjects => prevProjects.map(entry => {\n      if (entry.id !== project.id) {\n        return entry;\n      }\n\n      return {\n        ...entry,\n        analysis: derivedAnalysis,\n        totalQuestions,\n        answeredQuestions: Math.min(\n          answeredQuestionsCount,\n          totalQuestions || answeredQuestionsCount\n        ),\n        lastQuestionIndex: sanitizedIndex\n      };\n    }));\n\n    const forcedView = typeof options?.view === 'string' ? options.view : null;\n\n    let targetScreen = null;\n    if (forcedView === 'synthesis' || forcedView === 'questionnaire' || forcedView === 'mandatory-summary') {\n      targetScreen = forcedView;\n    }\n\n    if (!targetScreen) {\n      targetScreen = project.status === 'draft' ? 'questionnaire' : 'synthesis';\n    }\n\n    setScreen(targetScreen);\n    setHasUnsavedChanges(false);\n  }, [\n    analyzeAnswers,\n    projects,\n    questions,\n    setHasUnsavedChanges,\n    riskLevelRules,\n    riskWeights,\n    rules,\n    shouldShowQuestion\n  ]);\n\n  const handleDeleteProject = useCallback((projectId) => {\n    if (!projectId) {\n      return;\n    }\n\n    setProjects(prevProjects => prevProjects.filter(project => project.id !== projectId));\n    setActiveProjectId(prev => (prev === projectId ? null : prev));\n  }, []);\n\n  const handleDuplicateProject = useCallback((projectId) => {\n    if (!projectId) {\n      return;\n    }\n\n    setProjects(prevProjects => {\n      const sourceProject = prevProjects.find(project => project.id === projectId);\n      if (!sourceProject) {\n        return prevProjects;\n      }\n\n      const answersClone = sourceProject.answers && typeof sourceProject.answers === 'object'\n        ? JSON.parse(JSON.stringify(sourceProject.answers))\n        : {};\n\n      const relevantQuestions = questions.filter(question => shouldShowQuestion(question, answersClone));\n      const totalQuestions = relevantQuestions.length > 0\n        ? relevantQuestions.length\n        : typeof sourceProject.totalQuestions === 'number' && sourceProject.totalQuestions > 0\n          ? sourceProject.totalQuestions\n          : questions.length;\n\n      const answeredQuestionsCount = relevantQuestions.length > 0\n        ? relevantQuestions.filter(question => isAnswerProvided(answersClone[question.id])).length\n        : typeof sourceProject.answeredQuestions === 'number'\n          ? Math.min(sourceProject.answeredQuestions, totalQuestions || sourceProject.answeredQuestions)\n          : Object.keys(answersClone).length;\n\n      const computedAnalysis = Object.keys(answersClone).length > 0\n        ? analyzeAnswers(answersClone, rules, riskLevelRules, riskWeights)\n        : null;\n\n      const baseName = typeof sourceProject.projectName === 'string' && sourceProject.projectName.trim().length > 0\n        ? sourceProject.projectName.trim()\n        : 'Projet sans nom';\n      const nameWithoutCopyPrefix = baseName.replace(/^\\[Copie\\]\\s*/i, '').trim();\n      const duplicateBaseName = nameWithoutCopyPrefix.length > 0 ? nameWithoutCopyPrefix : baseName;\n\n      const duplicateEntry = {\n        id: `project-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\n        projectName: `[Copie] ${duplicateBaseName}`,\n        answers: answersClone,\n        analysis: computedAnalysis,\n        status: 'draft',\n        lastUpdated: new Date().toISOString(),\n        lastQuestionIndex: 0,\n        totalQuestions,\n        answeredQuestions: Math.min(answeredQuestionsCount, totalQuestions || answeredQuestionsCount)\n      };\n\n      return [duplicateEntry, ...prevProjects];\n    });\n  }, [analyzeAnswers, questions, riskLevelRules, riskWeights, rules, shouldShowQuestion]);\n\n  const openProjectShowcase = useCallback((context = {}) => {\n    const {\n      projectId = null,\n      projectName: providedProjectName,\n      status: providedStatus,\n      answers: providedAnswers,\n      analysis: providedAnalysis,\n      relevantTeams: providedRelevantTeams,\n      questions: providedQuestions,\n      timelineDetails: providedTimelineDetails\n    } = context || {};\n\n    const project = projectId ? projects.find(item => item.id === projectId) : null;\n    const answersSource = providedAnswers || project?.answers || {};\n    const visibleQuestions = Array.isArray(providedQuestions) && providedQuestions.length > 0\n      ? providedQuestions\n      : questions.filter(question => shouldShowQuestion(question, answersSource));\n    const computedAnalysis = providedAnalysis\n      || (Object.keys(answersSource).length > 0\n        ? analyzeAnswers(answersSource, rules, riskLevelRules, riskWeights)\n        : null);\n    const relevantTeamsList = Array.isArray(providedRelevantTeams) && providedRelevantTeams.length > 0\n      ? providedRelevantTeams\n      : teams.filter(team => (computedAnalysis?.teams || []).includes(team.id));\n    const timelineDetailsList = Array.isArray(providedTimelineDetails)\n      ? providedTimelineDetails\n      : computedAnalysis?.timeline?.details || [];\n\n    const normalizedProjectName = typeof providedProjectName === 'string' && providedProjectName.trim().length > 0\n      ? providedProjectName.trim()\n      : (typeof project?.projectName === 'string' && project.projectName.trim().length > 0\n        ? project.projectName.trim()\n        : extractProjectName(answersSource, questions));\n\n    const resolvedProjectName = normalizedProjectName && normalizedProjectName.length > 0\n      ? normalizedProjectName\n      : 'Projet sans nom';\n    const resolvedStatus = providedStatus || project?.status || 'draft';\n\n    const answeredQuestionsCount = visibleQuestions.length > 0\n      ? visibleQuestions.filter(question => isAnswerProvided(answersSource[question.id])).length\n      : Object.keys(answersSource).length;\n\n    const hasShowcaseIncompleteAnswers = visibleQuestions.length > 0\n      ? visibleQuestions.some(question => !isAnswerProvided(answersSource[question.id]))\n      : Object.keys(answersSource).length === 0;\n\n    const totalQuestions = visibleQuestions.length > 0\n      ? visibleQuestions.length\n      : project?.totalQuestions || questions.length || 0;\n\n    if (projectId) {\n      setProjects(prevProjects => prevProjects.map(entry => {\n        if (entry.id !== projectId) {\n          return entry;\n        }\n\n        return {\n          ...entry,\n          analysis: computedAnalysis,\n          totalQuestions,\n          answeredQuestions: Math.min(\n            answeredQuestionsCount,\n            totalQuestions || answeredQuestionsCount\n          )\n        };\n      }));\n    }\n\n    const pendingShowcaseMode = pendingShowcaseDisplayModeRef.current;\n    const resolvedShowcaseMode = resolveShowcaseDisplayMode(pendingShowcaseMode) || 'full';\n    const pendingSharedView = Boolean(pendingShowcaseSharedRef.current);\n    const pendingComments = Boolean(pendingShowcaseCommentsRef.current);\n    const resolvedDisplayModeLock = pendingSharedView\n      ? resolvedShowcaseMode\n      : resolvedShowcaseMode === 'light'\n        ? 'light'\n        : null;\n\n    pendingShowcaseDisplayModeRef.current = null;\n    pendingShowcaseSharedRef.current = false;\n    pendingShowcaseCommentsRef.current = false;\n    setShowcaseDisplayMode(resolvedShowcaseMode);\n    setShowcaseDisplayModeLock(resolvedDisplayModeLock);\n    setIsShowcaseSharedView(pendingSharedView);\n    setShowcaseCommentsEnabled(pendingComments);\n\n    setShowcaseProjectContext({\n      projectId: projectId || null,\n      projectName: resolvedProjectName,\n      status: resolvedStatus,\n      answers: answersSource,\n      analysis: computedAnalysis,\n      relevantTeams: relevantTeamsList,\n      questions: visibleQuestions.length > 0 ? visibleQuestions : questions,\n      timelineDetails: timelineDetailsList,\n      hasIncompleteAnswers: hasShowcaseIncompleteAnswers\n    });\n    previousScreenRef.current = screen;\n    setScreen('showcase');\n  }, [\n    analyzeAnswers,\n    projects,\n    questions,\n    riskLevelRules,\n    riskWeights,\n    rules,\n    screen,\n    shouldShowQuestion,\n    teams\n  ]);\n\n  useEffect(() => {\n    if (!isHydrated) {\n      return;\n    }\n\n    const pendingProjectId = pendingShowcaseProjectIdRef.current;\n    if (!pendingProjectId) {\n      return;\n    }\n\n    const matchingProject = projects.find(project => project?.id === pendingProjectId);\n    if (!matchingProject) {\n      return;\n    }\n\n    pendingShowcaseProjectIdRef.current = null;\n    openProjectShowcase({ projectId: pendingProjectId });\n  }, [isHydrated, openProjectShowcase, projects]);\n\n  const handleShowProjectShowcase = useCallback((projectId) => {\n    if (!projectId) {\n      return;\n    }\n\n    openProjectShowcase({ projectId });\n  }, [openProjectShowcase]);\n\n  const handleOpenActiveProjectShowcase = useCallback((payload = {}) => {\n    const projectId = payload?.projectId || activeProjectId || null;\n\n    openProjectShowcase({\n      ...payload,\n      projectId\n    });\n  }, [activeProjectId, openProjectShowcase]);\n\n  const handleCloseProjectShowcase = useCallback(() => {\n    setShowcaseProjectContext(null);\n    setShowcaseDisplayMode('full');\n    setShowcaseDisplayModeLock(null);\n    setIsShowcaseSharedView(false);\n    setShowcaseCommentsEnabled(false);\n    if (previousScreenRef.current) {\n      setScreen(previousScreenRef.current);\n    } else {\n      setScreen('home');\n    }\n    previousScreenRef.current = null;\n  }, []);\n\n  const handleReturnToComplianceReport = useCallback(() => {\n    if (showcaseProjectContext?.projectId) {\n      const { projectId } = showcaseProjectContext;\n      setShowcaseProjectContext(null);\n      setIsShowcaseSharedView(false);\n      setShowcaseCommentsEnabled(false);\n      previousScreenRef.current = null;\n      handleOpenProject(projectId, { view: 'synthesis' });\n      return;\n    }\n\n    setShowcaseProjectContext(null);\n    setIsShowcaseSharedView(false);\n    setShowcaseCommentsEnabled(false);\n\n    if (previousScreenRef.current) {\n      setScreen(previousScreenRef.current);\n    } else {\n      setScreen('synthesis');\n    }\n\n    previousScreenRef.current = null;\n  }, [handleOpenProject, showcaseProjectContext, setScreen]);\n\n  const handleUpdateProjectShowcaseAnswers = useCallback((updates) => {\n    if (\n      !showcaseProjectContext ||\n      !showcaseProjectContext.projectId ||\n      (showcaseProjectContext.status !== 'draft' && !isAdminMode)\n    ) {\n      return;\n    }\n\n    const projectId = showcaseProjectContext.projectId;\n    let contextPatch = null;\n    let hasProjectChanges = false;\n\n    setProjects(prevProjects => {\n      const project = prevProjects.find(entry => entry.id === projectId);\n      if (!project || (project.status !== 'draft' && !isAdminMode)) {\n        return prevProjects;\n      }\n\n      const { nextAnswers, changed } = applyAnswerUpdates(\n        project.answers || {},\n        updates,\n        questions,\n        shouldShowQuestion,\n        {\n          shouldPreserveQuestion: (question) => !question?.showcase\n        }\n      );\n      if (!changed) {\n        return prevProjects;\n      }\n\n      hasProjectChanges = true;\n\n      const relevantQuestions = questions.filter(question => shouldShowQuestion(question, nextAnswers));\n      const totalQuestions = relevantQuestions.length > 0\n        ? relevantQuestions.length\n        : project.totalQuestions || questions.length || 0;\n      const answeredQuestions = relevantQuestions.length > 0\n        ? relevantQuestions.filter(question => isAnswerProvided(nextAnswers[question.id])).length\n        : Object.keys(nextAnswers).length;\n\n      const updatedAnalysis = analyzeAnswers(nextAnswers, rules, riskLevelRules, riskWeights);\n      const timelineDetails = updatedAnalysis?.timeline?.details || [];\n      const relevantTeamsIds = Array.isArray(updatedAnalysis?.teams) ? updatedAnalysis.teams : [];\n      const relevantTeams = teams.filter(team => relevantTeamsIds.includes(team.id));\n      const inferredName = extractProjectName(nextAnswers, questions);\n      const sanitizedName = inferredName && inferredName.trim().length > 0\n        ? inferredName.trim()\n        : project.projectName;\n\n      const lastQuestionIndex = totalQuestions > 0\n        ? Math.min(Math.max(project.lastQuestionIndex ?? totalQuestions - 1, 0), totalQuestions - 1)\n        : project.lastQuestionIndex ?? 0;\n\n      contextPatch = {\n        projectName: sanitizedName,\n        answers: nextAnswers,\n        analysis: updatedAnalysis,\n        relevantTeams,\n        timelineDetails,\n        questions: relevantQuestions.length > 0 ? relevantQuestions : null\n      };\n\n      const now = new Date().toISOString();\n\n      const updatedProject = {\n        ...project,\n        answers: nextAnswers,\n        analysis: updatedAnalysis,\n        projectName: sanitizedName,\n        totalQuestions,\n        answeredQuestions: Math.min(answeredQuestions, totalQuestions || answeredQuestions),\n        lastQuestionIndex,\n        lastUpdated: now\n      };\n\n      return [updatedProject, ...prevProjects.filter(entry => entry.id !== projectId)];\n    });\n\n    if (contextPatch) {\n      setShowcaseProjectContext(prev => {\n        if (!prev || prev.projectId !== projectId) {\n          return prev;\n        }\n\n        return {\n          ...prev,\n          ...contextPatch,\n          questions: contextPatch.questions ? contextPatch.questions : prev.questions\n        };\n      });\n    }\n\n    if (hasProjectChanges) {\n      setHasUnsavedChanges(true);\n    }\n  }, [\n    analyzeAnswers,\n    extractProjectName,\n    isAdminMode,\n    setHasUnsavedChanges,\n    questions,\n    riskLevelRules,\n    riskWeights,\n    rules,\n    showcaseProjectContext,\n    shouldShowQuestion,\n    teams\n  ]);\n\n  const upsertProject = useCallback((entry) => {\n    return prevProjects => {\n      if (!entry || !entry.id) {\n        return prevProjects;\n      }\n\n      const filtered = prevProjects.filter(project => project.id !== entry.id);\n      return [entry, ...filtered];\n    };\n  }, []);\n\n  const handleSaveProject = useCallback((payload = {}) => {\n    const baseAnswers = payload.answers && typeof payload.answers === 'object' ? payload.answers : answers;\n    const sanitizedAnswers = baseAnswers || {};\n    const status = payload.status === 'submitted' ? 'submitted' : 'draft';\n    const projectId = activeProjectId || payload.id || `project-${Date.now()}`;\n    const relevantQuestions = questions.filter(question => shouldShowQuestion(question, sanitizedAnswers));\n    const computedTotalQuestions = payload.totalQuestions\n      || (relevantQuestions.length > 0 ? relevantQuestions.length : activeQuestions.length);\n    const totalQuestions = computedTotalQuestions > 0 ? computedTotalQuestions : activeQuestions.length;\n    const answeredQuestionsCount = relevantQuestions.length > 0\n      ? relevantQuestions.filter(question => {\n        const value = sanitizedAnswers[question.id];\n        if (Array.isArray(value)) {\n          return value.length > 0;\n        }\n        if (typeof value === 'string') {\n          return value.trim().length > 0;\n        }\n        return value !== null && value !== undefined;\n      }).length\n      : Object.keys(sanitizedAnswers).length;\n    const now = new Date().toISOString();\n\n    let computedAnalysis = null;\n    if (payload.analysis && typeof payload.analysis === 'object') {\n      computedAnalysis = payload.analysis;\n    } else if (Object.keys(sanitizedAnswers).length > 0) {\n      computedAnalysis = analyzeAnswers(sanitizedAnswers, rules, riskLevelRules, riskWeights);\n    }\n\n    if (status === 'submitted' && !computedAnalysis) {\n      return null;\n    }\n\n    const inferredName = extractProjectName(sanitizedAnswers, questions);\n    const projectNameRaw = typeof payload.projectName === 'string' ? payload.projectName : inferredName;\n    const sanitizedName =\n      projectNameRaw && projectNameRaw.trim().length > 0 ? projectNameRaw.trim() : 'Projet sans nom';\n\n    let lastQuestionIndex =\n      typeof payload.lastQuestionIndex === 'number' ? payload.lastQuestionIndex : currentQuestionIndex;\n    if (status === 'submitted' && totalQuestions > 0) {\n      lastQuestionIndex = totalQuestions - 1;\n    }\n\n    const clampedLastIndex = totalQuestions > 0\n      ? Math.min(Math.max(lastQuestionIndex, 0), totalQuestions - 1)\n      : 0;\n\n    const entry = {\n      id: projectId,\n      projectName: sanitizedName,\n      answers: sanitizedAnswers,\n      analysis: computedAnalysis,\n      status,\n      lastUpdated: now,\n      lastQuestionIndex: clampedLastIndex,\n      totalQuestions,\n      answeredQuestions: Math.min(answeredQuestionsCount, totalQuestions || answeredQuestionsCount)\n    };\n\n    if (status === 'submitted') {\n      entry.submittedAt = now;\n    }\n\n    setProjects(upsertProject(entry));\n    setActiveProjectId(projectId);\n\n    if (computedAnalysis) {\n      setAnalysis(computedAnalysis);\n    }\n\n    setHasUnsavedChanges(false);\n\n    return entry;\n  }, [\n    activeProjectId,\n    activeQuestions.length,\n    analyzeAnswers,\n    answers,\n    currentQuestionIndex,\n    extractProjectName,\n    questions,\n    riskLevelRules,\n    riskWeights,\n    rules,\n    setHasUnsavedChanges,\n    shouldShowQuestion,\n    upsertProject\n  ]);\n\n  const handleSubmitProject = useCallback((payload = {}) => {\n    if (unansweredMandatoryQuestions.length > 0) {\n      setSaveFeedback({\n        status: 'error',\n        message: 'Impossible de soumettre : complétez les questions obligatoires avant l’envoi.'\n      });\n      setScreen('synthesis');\n      return null;\n    }\n\n    const entry = handleSaveProject({ ...payload, status: 'submitted' });\n    if (entry) {\n      setValidationError(null);\n      setScreen('home');\n    }\n  }, [handleSaveProject, unansweredMandatoryQuestions]);\n\n  const handleSaveDraft = useCallback((payload = {}) => {\n    const { lastQuestionIndex: payloadLastQuestionIndex, ...otherPayload } = payload || {};\n\n    const entry = handleSaveProject({\n      ...otherPayload,\n      lastQuestionIndex:\n        typeof payloadLastQuestionIndex === 'number'\n          ? payloadLastQuestionIndex\n          : currentQuestionIndex,\n      status: 'draft'\n    });\n\n    if (entry) {\n      setValidationError(null);\n\n      const exported = exportProjectToFile({\n        projectName: entry.projectName,\n        answers: entry.answers\n      });\n\n      setSaveFeedback(\n        exported\n          ? {\n              status: 'success',\n              message: 'Votre projet a bien été enregistré dans vos téléchargements'\n            }\n          : {\n              status: 'error',\n              message: 'Projet enregistré mais le téléchargement a échoué. Veuillez réessayer.'\n            }\n      );\n    }\n  }, [currentQuestionIndex, handleSaveProject]);\n\n  const handleDismissSaveFeedback = useCallback(() => {\n    setSaveFeedback(null);\n  }, []);\n\n  const handleBackToQuestionnaire = useCallback(() => {\n    if (unansweredMandatoryQuestions.length > 0) {\n      const firstMissingId = unansweredMandatoryQuestions[0].id;\n      const targetIndex = activeQuestions.findIndex(question => question.id === firstMissingId);\n      if (targetIndex >= 0) {\n        setCurrentQuestionIndex(targetIndex);\n      }\n    } else if (activeQuestions.length > 0) {\n      const lastIndex = activeQuestions.length - 1;\n      setCurrentQuestionIndex(prevIndex => {\n        if (prevIndex > lastIndex) {\n          return lastIndex;\n        }\n        return prevIndex;\n      });\n    }\n    setValidationError(null);\n    setScreen('questionnaire');\n  }, [activeQuestions, unansweredMandatoryQuestions]);\n\n  const handleNavigateToQuestion = useCallback((questionId) => {\n    const targetIndex = activeQuestions.findIndex(question => question.id === questionId);\n    if (targetIndex >= 0) {\n      setCurrentQuestionIndex(targetIndex);\n    }\n    setValidationError(null);\n    setScreen('questionnaire');\n  }, [activeQuestions]);\n\n  const handleNavigateToQuestionFromReport = useCallback((questionId) => {\n    setReturnToSynthesisAfterEdit(true);\n    handleNavigateToQuestion(questionId);\n  }, [handleNavigateToQuestion]);\n\n  const handleReturnToSynthesisFromQuestionnaire = useCallback(() => {\n    navigateToSynthesis();\n  }, [navigateToSynthesis]);\n\n  const handleProceedToSynthesis = useCallback(() => {\n    navigateToSynthesis();\n  }, [navigateToSynthesis]);\n\n  const showcaseProjectId = showcaseProjectContext?.projectId || '';\n  const buildShowcaseShareUrl = useCallback((shareMode) => {\n    if (!showcaseProjectId || typeof window === 'undefined') {\n      return '';\n    }\n\n    const url = new URL(window.location.href);\n    url.searchParams.set('projectId', showcaseProjectId);\n    url.searchParams.set('showcaseShared', '1');\n    if (showcaseShareCommentsEnabled) {\n      url.searchParams.set('showcaseComments', '1');\n    } else {\n      url.searchParams.delete('showcaseComments');\n    }\n    if (shareMode === 'light') {\n      url.searchParams.set('showcaseMode', 'light');\n    } else {\n      url.searchParams.delete('showcaseMode');\n    }\n    url.hash = `showcase=${showcaseProjectId}`;\n    return url.toString();\n  }, [showcaseProjectId, showcaseShareCommentsEnabled]);\n\n  const showcaseShareUrl = useMemo(\n    () => buildShowcaseShareUrl(showcaseShareMode),\n    [buildShowcaseShareUrl, showcaseShareMode]\n  );\n\n  const handleOpenShowcaseShare = useCallback(() => {\n    if (!showcaseProjectId) {\n      return;\n    }\n\n    setShowcaseShareMode(showcaseDisplayMode === 'light' ? 'light' : 'full');\n    setShowcaseShareCommentsEnabled(false);\n    setIsShowcaseShareOpen(true);\n    setShowcaseShareFeedback('');\n  }, [showcaseDisplayMode, showcaseProjectId]);\n\n  const handleCloseShowcaseShare = useCallback(() => {\n    setIsShowcaseShareOpen(false);\n    setShowcaseShareFeedback('');\n  }, []);\n\n  useEffect(() => {\n    if (!isShowcaseShareOpen) {\n      return;\n    }\n\n    if (showcaseShareInputRef.current && typeof showcaseShareInputRef.current.focus === 'function') {\n      showcaseShareInputRef.current.focus();\n    }\n  }, [isShowcaseShareOpen]);\n\n  const handleCopyShowcaseLink = useCallback(async () => {\n    if (!showcaseShareUrl) {\n      return;\n    }\n\n    try {\n      if (typeof navigator !== 'undefined' && navigator.clipboard?.writeText) {\n        await navigator.clipboard.writeText(showcaseShareUrl);\n        setShowcaseShareFeedback('Lien copié dans le presse-papiers.');\n        return;\n      }\n    } catch (error) {\n      // Fallback below.\n    }\n\n    if (typeof document !== 'undefined') {\n      const input = document.getElementById('showcase-share-link');\n      if (input && typeof input.select === 'function') {\n        input.select();\n        const copied = document.execCommand && document.execCommand('copy');\n        if (copied) {\n          setShowcaseShareFeedback('Lien copié dans le presse-papiers.');\n          return;\n        }\n      }\n    }\n\n    setShowcaseShareFeedback('Impossible de copier automatiquement le lien.');\n  }, [showcaseShareUrl]);\n\n  const handleDownloadShowcaseShortcut = useCallback(() => {\n    if (!showcaseShareUrl || typeof window === 'undefined') {\n      return;\n    }\n\n    const shortcutContent = `[InternetShortcut]\\nURL=${showcaseShareUrl}\\n`;\n    const blob = new Blob([shortcutContent], { type: 'text/plain' });\n    const fileName = `raccourci-showcase-${showcaseProjectId || 'projet'}.url`;\n    const downloadUrl = URL.createObjectURL(blob);\n    const anchor = document.createElement('a');\n\n    anchor.href = downloadUrl;\n    anchor.download = fileName;\n    document.body.appendChild(anchor);\n    anchor.click();\n    anchor.remove();\n    URL.revokeObjectURL(downloadUrl);\n    setShowcaseShareFeedback('Raccourci téléchargé.');\n  }, [showcaseProjectId, showcaseShareUrl]);\n\n  return (\n    <div className={`min-h-screen ${annotationOffsetClass}`}>\n      <AnnotationLayer\n        isActive={isAnnotationModeEnabled && screen === 'showcase'}\n        isPaused={isAnnotationPaused}\n        isEditing={isShowcaseEditing}\n        notes={annotationNotes}\n        activeContextId={activeAnnotationContextKey}\n        sourceColors={annotationSources}\n        projectName={showcaseProjectContext?.projectName || ''}\n        autoFocusNoteId={autoFocusAnnotationId}\n        onAutoFocusComplete={() => setAutoFocusAnnotationId(null)}\n        onTogglePause={handleToggleAnnotationPause}\n        onRequestSave={handleSaveAnnotationNotes}\n        onRequestLoad={handleRequestAnnotationFile}\n        onExit={handleToggleAnnotationMode}\n        onNoteChange={handleAnnotationTextChange}\n        onNoteRemove={handleRemoveAnnotationNote}\n      />\n\n      <input\n        ref={annotationFileInputRef}\n        type=\"file\"\n        accept=\"application/json\"\n        className=\"sr-only\"\n        onChange={handleAnnotationFileChange}\n        data-annotation-ui=\"true\"\n      />\n\n      <div id=\"tour-onboarding-anchor\" className=\"sr-only\" aria-hidden=\"true\">\n        Guide interactif\n      </div>\n      <nav className=\"bg-white shadow-sm border-b border-gray-200 hv-surface\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-8 py-4\">\n          <div className=\"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center\">\n                <CheckCircle className=\"w-6 h-6 text-white\" />\n              </div>\n              <div>\n                <h1 className=\"text-lg font-bold text-gray-800 sm:text-xl\">Project Navigator</h1>\n                <p className=\"text-xs text-gray-500\">Outil d'aide à la décision</p>\n              </div>\n            </div>\n\n            <div\n              className=\"flex flex-col gap-2 sm:flex-row sm:flex-wrap sm:gap-3 lg:justify-end\"\n              role=\"group\"\n              aria-label=\"Sélection du mode d'utilisation\"\n            >\n              {screen === 'showcase' && (\n                <>\n                  <button\n                    type=\"button\"\n                    onClick={handleToggleAnnotationMode}\n                    className={`order-first self-start sm:order-last sm:self-center inline-flex min-h-[44px] h-11 px-4 items-center justify-center rounded-full border text-blue-700 shadow-sm transition hover:bg-blue-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 ${\n                      isAnnotationModeEnabled ? 'bg-blue-50 border-blue-200' : 'bg-white border-blue-100'\n                    }`}\n                    aria-pressed={isAnnotationModeEnabled}\n                    aria-label={isAnnotationModeEnabled ? 'Désactiver le mode annotation' : 'Activer le mode annotation'}\n                    title={isAnnotationModeEnabled ? 'Désactiver le mode annotation' : 'Activer le mode annotation'}\n                    data-annotation-ui=\"true\"\n                  >\n                    <MessageSquare className=\"h-5 w-5\" />\n                    <span className=\"sr-only\">Annotation</span>\n                  </button>\n                  <button\n                    type=\"button\"\n                    onClick={handleOpenShowcaseShare}\n                    className={`order-first self-start sm:order-last sm:self-center inline-flex min-h-[44px] h-11 px-4 items-center justify-center rounded-full border text-blue-700 shadow-sm transition hover:bg-blue-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 ${\n                      showcaseProjectId ? 'bg-white border-blue-100' : 'bg-gray-100 border-gray-200 text-gray-400 cursor-not-allowed'\n                    }`}\n                    aria-label=\"Partager la vitrine du projet\"\n                    title={showcaseProjectId ? 'Partager la vitrine du projet' : 'Aucun projet vitrine disponible'}\n                    disabled={!showcaseProjectId}\n                  >\n                    <Link className=\"h-5 w-5\" />\n                    <span className=\"sr-only\">Partager</span>\n                  </button>\n                </>\n              )}\n              {mode === 'user' && screen === 'showcase' && showcaseProjectContext && (\n                <button\n                  type=\"button\"\n                  onClick={handleReturnToComplianceReport}\n                  className=\"w-full sm:w-auto px-4 py-2 rounded-lg font-medium text-sm sm:text-base transition-all hv-button bg-blue-600 text-white hv-button-primary\"\n                  aria-label=\"Revenir à la synthèse du projet\"\n                  title=\"Revenir à la synthèse du projet\"\n                  data-tour-id=\"showcase-back-to-report\"\n                >\n                  Synthèse\n                </button>\n              )}\n              {mode === 'user' && (\n                <>\n                  <button\n                    type=\"button\"\n                    onClick={handleStartOnboarding}\n                    className={`w-full sm:w-auto px-4 py-2 rounded-lg font-medium text-sm sm:text-base transition-all hv-button flex items-center justify-center gap-2 ${\n                      isOnboardingActive\n                        ? 'bg-blue-600 text-white hv-button-primary'\n                        : isTourGuideReady\n                          ? 'bg-white text-blue-600 border border-blue-200 hover:bg-blue-50 hv-focus-ring'\n                          : 'bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed'\n                    }`}\n                    disabled={!isTourGuideReady || isOnboardingActive}\n                    data-tour-id=\"nav-onboarding-trigger\"\n                    aria-label=\"Lancer le guide interactif\"\n                  >\n                    <Sparkles className=\"text-lg sm:text-xl\" aria-hidden=\"true\" />\n                    <span>Guide interactif</span>\n                  </button>\n                  {screen !== 'home' && (\n                    <button\n                      type=\"button\"\n                      onClick={() => setScreen('home')}\n                      className={`w-full sm:w-auto px-4 py-2 rounded-lg font-medium text-sm sm:text-base transition-all hv-button bg-gray-100 text-gray-700 hover:bg-gray-200`}\n                      aria-pressed={false}\n                      aria-label=\"Retourner à l'accueil des projets\"\n                    >\n                      Accueil projets\n                    </button>\n                  )}\n                  <a\n                    href=\"https://forms.office.com/e/p6PYB1gbpM\"\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-medium text-sm sm:text-base transition-all hv-button text-white bg-gradient-to-r from-pink-500 via-red-500 to-yellow-500 hover:from-pink-600 hover:via-red-600 hover:to-yellow-600 focus-visible:ring-pink-400 hv-focus-ring\"\n                    aria-label=\"Partagez votre avis sur Project Navigator (nouvelle fenêtre)\"\n                  >\n                    <Sparkles className=\"text-lg sm:text-xl\" aria-hidden=\"true\" />\n                    <span>Partagez votre avis</span>\n                  </a>\n                </>\n              )}\n              {mode === 'admin' && (\n                <button\n                  type=\"button\"\n                  onClick={handleReturnToProjectMode}\n                  className={`w-full sm:w-auto px-4 py-2 rounded-lg font-medium text-sm sm:text-base transition-all hv-button ${\n                    mode === 'user'\n                      ? 'bg-blue-600 text-white hv-button-primary'\n                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                  }`}\n                  aria-pressed={mode === 'user'}\n                  aria-label=\"Basculer vers le mode chef de projet\"\n                >\n                  Mode Chef de Projet\n                </button>\n              )}\n              {!isAdminMode && (\n                <button\n                  type=\"button\"\n                  onClick={handleActivateAdminOnHome}\n                  className={`w-full sm:w-auto px-4 py-2 rounded-lg font-medium text-sm sm:text-base transition-all hv-button flex items-center justify-center ${\n                    isAdminHomeView\n                      ? 'bg-blue-600 text-white hv-button-primary'\n                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                  }`}\n                  aria-pressed={isAdminHomeView}\n                  aria-label=\"Activer le mode administrateur sur la page d'accueil\"\n                  title=\"Activer le mode administrateur sur l'accueil\"\n                >\n                  <Lock className=\"text-lg sm:text-xl\" />\n                  <span className=\"sr-only\">Mode Administrateur (Accueil)</span>\n                </button>\n              )}\n              {isAdminMode && (\n                <button\n                  type=\"button\"\n                  onClick={handleBackOfficeClick}\n                  className={`w-full sm:w-auto px-4 py-2 rounded-lg font-medium text-sm sm:text-base transition-all hv-button flex items-center justify-center gap-3 ${\n                    isAdminBackOfficeView\n                      ? 'bg-blue-600 text-white hv-button-primary'\n                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                  }`}\n                  aria-pressed={isAdminBackOfficeView}\n                  aria-label=\"Accéder au Back-office\"\n                  title=\"Accéder au Back-office\"\n                >\n                  <span>Accéder au Back-office</span>\n                  <Settings className=\"text-lg sm:text-xl\" aria-hidden=\"true\" />\n                </button>\n              )}\n              {backOfficeAuthError && (\n                <p className=\"w-full text-sm text-red-600 sm:w-auto\" role=\"alert\">\n                  {backOfficeAuthError}\n                </p>\n              )}\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      {isShowcaseShareOpen && (\n        <div\n          className=\"fixed inset-0 z-50 flex items-center justify-center px-4 py-6 bg-black bg-opacity-50\"\n          role=\"dialog\"\n          aria-modal=\"true\"\n          aria-labelledby=\"showcase-share-title\"\n        >\n          <div className=\"bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6 sm:p-8 space-y-4 hv-surface hv-modal-panel\">\n            <div className=\"text-center\">\n              <h2 id=\"showcase-share-title\" className=\"text-xl font-semibold text-gray-800\">\n                Partager la vitrine du projet\n              </h2>\n              <p className=\"mt-2 text-sm text-gray-600\">\n                Copiez le lien ou téléchargez un raccourci pour ouvrir directement cette vitrine.\n              </p>\n            </div>\n            <div className=\"space-y-3\">\n              <label htmlFor=\"showcase-share-link\" className=\"text-sm font-medium text-gray-700\">\n                Lien à partager\n              </label>\n              <input\n                id=\"showcase-share-link\"\n                type=\"text\"\n                value={showcaseShareUrl}\n                ref={showcaseShareInputRef}\n                readOnly\n                className=\"w-full rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-800\"\n              />\n              {showcaseShareFeedback && (\n                <p className=\"text-sm text-blue-600\">{showcaseShareFeedback}</p>\n              )}\n            </div>\n            <div className=\"space-y-2\">\n              <p className=\"text-sm font-medium text-gray-700\">Mode partagé</p>\n              <div className=\"inline-flex flex-wrap gap-2\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowcaseShareMode('full')}\n                  className={`rounded-full border px-4 py-2 text-sm font-medium transition ${\n                    showcaseShareMode === 'full'\n                      ? 'border-blue-200 bg-blue-50 text-blue-700 shadow-sm'\n                      : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300'\n                  }`}\n                  aria-pressed={showcaseShareMode === 'full'}\n                >\n                  Mode complet\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={() => setShowcaseShareMode('light')}\n                  className={`rounded-full border px-4 py-2 text-sm font-medium transition ${\n                    showcaseShareMode === 'light'\n                      ? 'border-blue-200 bg-blue-50 text-blue-700 shadow-sm'\n                      : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300'\n                  }`}\n                  aria-pressed={showcaseShareMode === 'light'}\n                >\n                  Mode Light\n                </button>\n              </div>\n              <p className=\"text-xs text-gray-500\">\n                En mode Light, seules les sections pré-sélectionnées sont visibles.\n              </p>\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"inline-flex items-center gap-2 text-sm text-gray-700\">\n                <input\n                  type=\"checkbox\"\n                  className=\"h-4 w-4 rounded border-gray-300 text-blue-600\"\n                  checked={showcaseShareCommentsEnabled}\n                  onChange={(event) => setShowcaseShareCommentsEnabled(event.target.checked)}\n                />\n                Commentaires possibles\n              </label>\n              <p className=\"text-xs text-gray-500\">\n                Active un bouton de commentaires flottant pour lancer le module de post-it.\n              </p>\n            </div>\n            <div className=\"flex flex-col gap-3 sm:flex-row sm:justify-center\">\n              <button\n                type=\"button\"\n                onClick={handleCopyShowcaseLink}\n                className=\"px-5 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 hv-button hv-button-primary\"\n              >\n                Copier le lien\n              </button>\n              <button\n                type=\"button\"\n                onClick={handleDownloadShowcaseShortcut}\n                className=\"px-5 py-2 bg-white text-blue-700 font-medium rounded-lg border border-blue-200 hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 hv-button\"\n              >\n                Télécharger le raccourci\n              </button>\n            </div>\n            <div className=\"flex justify-center\">\n              <button\n                type=\"button\"\n                onClick={handleCloseShowcaseShare}\n                className=\"text-sm text-gray-500 hover:text-gray-700\"\n              >\n                Fermer\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {isBackOfficePromptOpen && (\n        <div\n          className=\"fixed inset-0 z-50 flex items-center justify-center px-4 py-6\"\n          role=\"dialog\"\n          aria-modal=\"true\"\n          aria-labelledby=\"backoffice-auth-title\"\n        >\n          <div className=\"absolute inset-0 bg-gray-900/50\" onClick={() => closeBackOfficePrompt(false)} aria-hidden=\"true\" />\n          <form\n            onSubmit={handleBackOfficePromptSubmit}\n            className=\"relative w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl hv-surface\"\n          >\n            <div className=\"text-center\">\n              <h2 id=\"backoffice-auth-title\" className=\"text-xl font-semibold text-gray-800\">\n                Accès back-office\n              </h2>\n              <p className=\"mt-2 text-sm text-gray-600\">\n                Saisissez le mot de passe administrateur pour continuer.\n              </p>\n            </div>\n            <div className=\"mt-5 space-y-3\">\n              <label htmlFor=\"backoffice-password\" className=\"text-sm font-medium text-gray-700\">\n                Mot de passe\n              </label>\n              <input\n                id=\"backoffice-password\"\n                type=\"password\"\n                value={backOfficePromptValue}\n                onChange={(event) => setBackOfficePromptValue(event.target.value)}\n                className=\"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200\"\n                placeholder=\"Mot de passe\"\n              />\n              {backOfficePromptError && (\n                <p className=\"text-sm text-red-600\" role=\"alert\">\n                  {backOfficePromptError}\n                </p>\n              )}\n            </div>\n            <div className=\"mt-6 flex flex-col gap-3 sm:flex-row sm:justify-center\">\n              <button\n                type=\"button\"\n                onClick={() => closeBackOfficePrompt(false)}\n                className=\"px-5 py-2 bg-white text-gray-700 font-medium rounded-lg border border-gray-200 hover:bg-gray-50\"\n              >\n                Annuler\n              </button>\n              <button\n                type=\"submit\"\n                className=\"px-5 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700\"\n              >\n                Déverrouiller\n              </button>\n            </div>\n          </form>\n        </div>\n      )}\n\n      <main id=\"main-content\" tabIndex=\"-1\" className=\"focus:outline-none hv-background\">\n        {!isHydrated ? (\n          <div className=\"flex min-h-[60vh] items-center justify-center\">\n            <LoadingFallback\n              label=\"Chargement de l’accueil…\"\n              hint=\"Préparation de votre espace.\"\n            />\n          </div>\n        ) : isAdminBackOfficeView ? (\n          <Suspense\n            fallback={(\n              <LoadingFallback\n                label=\"Chargement du back-office…\"\n                hint=\"Préparation des données administratives en cours.\"\n              />\n            )}\n          >\n            <LazyBackOffice\n              projects={projects}\n              questions={questions}\n              setQuestions={setQuestions}\n              rules={rules}\n              setRules={setRules}\n              riskLevelRules={riskLevelRules}\n              setRiskLevelRules={setRiskLevelRules}\n              riskWeights={riskWeights}\n              setRiskWeights={setRiskWeights}\n              teams={teams}\n              setTeams={setTeams}\n              showcaseThemes={showcaseThemes}\n              setShowcaseThemes={setShowcaseThemes}\n              projectFilters={projectFilters}\n              setProjectFilters={updateProjectFilters}\n              inspirationFilters={inspirationFilters}\n              setInspirationFilters={updateInspirationFilters}\n              inspirationFormFields={inspirationFormFields}\n              setInspirationFormFields={updateInspirationFormFields}\n              onboardingTourConfig={onboardingTourConfig}\n              setOnboardingTourConfig={setOnboardingTourConfig}\n            />\n          </Suspense>\n        ) : screen === 'home' ? (\n          <HomeScreen\n            projects={projects}\n            projectFilters={projectFilters}\n            teamLeadOptions={teamLeadTeamOptions}\n            inspirationProjects={inspirationProjects}\n            inspirationFilters={inspirationFilters}\n            homeView={homeView}\n            onHomeViewChange={setHomeView}\n            onStartInspirationProject={handleStartInspirationProject}\n            onOpenInspirationProject={handleOpenInspirationProject}\n            onStartNewProject={handleCreateNewProject}\n            onOpenProject={handleOpenProject}\n            onDeleteProject={handleDeleteProject}\n            onShowProjectShowcase={handleShowProjectShowcase}\n            onImportProject={handleImportProject}\n            onDuplicateProject={handleDuplicateProject}\n            isAdminMode={isAdminMode}\n            tourContext={tourContext}\n          />\n        ) : screen === 'inspiration-form' ? (\n          <InspirationForm\n            formConfig={inspirationFormFields}\n            existingProjects={inspirationProjects}\n            onSubmit={handleSaveInspirationProject}\n            onCancel={() => {\n              setScreen('home');\n              setHomeView('inspiration');\n            }}\n          />\n        ) : screen === 'inspiration-detail' ? (\n          <InspirationDetail\n            project={activeInspirationProject}\n            formConfig={inspirationFormFields}\n            onBack={() => {\n              setScreen('home');\n              setHomeView('inspiration');\n            }}\n            onUpdate={handleUpdateInspirationProject}\n            onExport={handleExportInspirationProject}\n          />\n        ) : screen === 'questionnaire' ? (\n          <QuestionnaireScreen\n            questions={activeQuestions}\n            currentIndex={currentQuestionIndex}\n            answers={answers}\n            onAnswer={handleAnswer}\n            onNext={handleNext}\n            onBack={handleBack}\n            allQuestions={questions}\n            onNavigateToQuestion={handleNavigateToQuestion}\n            onSaveDraft={isOnboardingActive ? noop : handleSaveDraft}\n            saveFeedback={saveFeedback}\n            onDismissSaveFeedback={handleDismissSaveFeedback}\n            validationError={validationError}\n            onReturnToSynthesis={\n              returnToSynthesisAfterEdit ? handleReturnToSynthesisFromQuestionnaire : undefined\n            }\n            isReturnToSynthesisRequested={returnToSynthesisAfterEdit}\n            tourContext={tourContext}\n            onFinish={navigateToSynthesis}\n          />\n        ) : screen === 'mandatory-summary' ? (\n          <MandatoryQuestionsSummary\n            pendingQuestions={pendingMandatoryQuestions}\n            totalQuestions={activeQuestions.length}\n            onBackToQuestionnaire={handleBackToQuestionnaire}\n            onNavigateToQuestion={handleNavigateToQuestion}\n            onProceedToSynthesis={handleProceedToSynthesis}\n          />\n        ) : screen === 'synthesis' ? (\n          <SynthesisReport\n            answers={answers}\n            analysis={analysis}\n            teams={teams}\n            questions={activeQuestions}\n            projectStatus={activeProject?.status || null}\n            projectId={activeProjectId}\n            projectName={activeProjectName}\n            onOpenProjectShowcase={handleOpenActiveProjectShowcase}\n            isProjectEditable={isActiveProjectEditable}\n            onRestart={handleRestart}\n            onBack={isActiveProjectEditable ? handleBackToQuestionnaire : undefined}\n            onUpdateAnswers={isActiveProjectEditable ? handleUpdateAnswers : undefined}\n            onSubmitProject={handleSubmitProject}\n            onNavigateToQuestion={handleNavigateToQuestionFromReport}\n            isExistingProject={Boolean(activeProjectId)}\n            onSaveDraft={\n              isOnboardingActive\n                ? noop\n                : isActiveProjectEditable\n                  ? handleSaveDraft\n                  : undefined\n            }\n            saveFeedback={saveFeedback}\n            onDismissSaveFeedback={handleDismissSaveFeedback}\n            isAdminMode={isAdminMode}\n            hasIncompleteAnswers={hasIncompleteAnswers}\n            tourContext={tourContext}\n          />\n        ) : screen === 'showcase' ? (\n          showcaseProjectContext ? (\n            <div className=\"space-y-4\">\n              {showcaseProjectContext.status !== 'draft' && (\n                <div className=\"rounded-xl border border-yellow-200 bg-yellow-50 px-4 py-3 text-sm text-yellow-800 hv-surface\">\n                  {isAdminMode\n                    ? 'Ce projet a été soumis. Vous pouvez le modifier car vous êtes en mode administrateur.'\n                    : 'Ce projet a été soumis. La vitrine est consultable en lecture seule.'}\n                </div>\n              )}\n              <Suspense\n                fallback={(\n                  <LoadingFallback\n                    label=\"Chargement de la vitrine du projet…\"\n                    hint=\"Nous construisons la synthèse visuelle du projet.\"\n                  />\n                )}\n              >\n                <LazyProjectShowcase\n                  projectName={showcaseProjectContext.projectName}\n                  onClose={handleCloseProjectShowcase}\n                  analysis={showcaseProjectContext.analysis}\n                  relevantTeams={showcaseProjectContext.relevantTeams}\n                  questions={showcaseProjectContext.questions}\n                  answers={showcaseProjectContext.answers}\n                  timelineDetails={showcaseProjectContext.timelineDetails}\n                  showcaseThemes={showcaseThemes}\n                  hasIncompleteAnswers={Boolean(showcaseProjectContext.hasIncompleteAnswers)}\n                  initialDisplayMode={showcaseDisplayMode}\n                  displayModeLock={showcaseDisplayModeLock}\n                  hideEditBar={isShowcaseSharedView}\n                  hideNotice={isShowcaseSharedView}\n                  onUpdateAnswers={\n                    isShowcaseSharedView\n                      ? undefined\n                      : isOnboardingActive\n                        ? noop\n                        : showcaseProjectContext.status === 'draft' || isAdminMode\n                          ? handleUpdateProjectShowcaseAnswers\n                          : undefined\n                  }\n                  tourContext={tourContext}\n                  onDisplayModeChange={setShowcaseDisplayMode}\n                  onAnnotationScopeChange={setShowcaseAnnotationScope}\n                  onEditingStateChange={setIsShowcaseEditing}\n                />\n              </Suspense>\n            </div>\n          ) : null\n      ) : null}\n    </main>\n\n    {screen === 'showcase' && isShowcaseSharedView && showcaseCommentsEnabled && (\n      <button\n        type=\"button\"\n        onClick={handleToggleAnnotationMode}\n        className={`fixed bottom-6 right-6 z-40 inline-flex items-center gap-2 rounded-full border px-4 py-3 text-sm font-semibold shadow-lg transition hover:shadow-xl ${\n          isAnnotationModeEnabled\n            ? 'border-blue-200 bg-blue-600 text-white'\n            : 'border-blue-100 bg-white text-blue-700'\n        }`}\n        aria-pressed={isAnnotationModeEnabled}\n        aria-label={isAnnotationModeEnabled ? 'Fermer les commentaires' : 'Ouvrir les commentaires'}\n        title={isAnnotationModeEnabled ? 'Fermer les commentaires' : 'Ouvrir les commentaires'}\n        data-annotation-ui=\"true\"\n      >\n        <MessageSquare className=\"h-4 w-4\" />\n        <span>Commentaires</span>\n      </button>\n    )}\n\n    <footer className=\"bg-white border-t border-gray-200 mt-10\" aria-label=\"Pied de page\">\n      <p className=\"text-xs text-gray-400 text-center py-4\">\n        Project Navigator · Version {APP_VERSION} ·{' '}\n        <a\n          href=\"./mentions-legales.html\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"underline hover:text-gray-500\"\n        >\n          Mentions légales\n        </a>\n      </p>\n    </footer>\n    </div>\n  );\n};\n",
  "src/components/ProjectShowcase.jsx": "import React, { useCallback, useEffect, useMemo, useRef, useState } from '../react.js';\nimport {\n  CheckCircle,\n  Edit,\n  Plus,\n  Trash2\n} from './icons.js';\nimport { formatAnswer } from '../utils/questions.js';\nimport { renderTextWithLinks } from '../utils/linkify.js';\nimport { initialShowcaseThemes } from '../data/showcaseThemes.js';\nimport { RichTextEditor } from './RichTextEditor.jsx';\n\nconst SHOWCASE_SECTION_OPTIONS = [\n  { id: 'notice', label: 'Message de complétude' },\n  { id: 'hero', label: 'Hero du projet' },\n  { id: 'problem', label: 'Le problème' },\n  { id: 'solution', label: 'La réponse' },\n  { id: 'innovation', label: 'Différenciation & impact' },\n  { id: 'team', label: 'Équipe & alliances' },\n  { id: 'timeline', label: 'Feuille de route' }\n];\n\nconst MAX_CUSTOM_SECTION_COLUMNS = 4;\n\nconst SECTION_TEMPLATES = [\n  {\n    id: 'highlight',\n    name: 'Bloc mise en avant',\n    description: 'Un bandeau court pour mettre un chiffre ou une promesse clé en lumière.',\n    placeholder: {\n      title: 'Impact attendu',\n      description: 'Un message synthétique pour convaincre immédiatement.',\n      accent: 'Nouveau'\n    }\n  },\n  {\n    id: 'columns',\n    name: 'Bloc multi-colonnes',\n    description: 'Un contenu réparti sur plusieurs colonnes pour comparer ou structurer l’information.',\n    placeholder: {\n      title: 'Points clés par axe',\n      subtitle: 'Une synthèse rapide à plusieurs voix',\n      columns: [\n        'Colonne 1 : rappels stratégiques et contexte.',\n        'Colonne 2 : bénéfices à retenir pour les équipes.',\n        'Colonne 3 : prochaines étapes prioritaires.'\n      ],\n      columnCount: 3\n    }\n  },\n  {\n    id: 'document-viewer',\n    name: 'Visionneuse documentaire',\n    description: 'Un titre, un sous-titre et une visionneuse intégrée pour un document SharePoint.',\n    placeholder: {\n      title: 'Document de référence',\n      subtitle: 'Accès rapide aux supports projet',\n      description: 'Ajoutez un lien SharePoint (PDF, image ou présentation) pour l’afficher directement.',\n      documentUrl: 'https://votre-tenant.sharepoint.com/sites/projet/Shared%20Documents/brief.pdf',\n      documentType: 'pdf',\n      accent: 'SharePoint'\n    }\n  },\n  {\n    id: 'story',\n    name: 'Bloc narratif',\n    description: 'Un encart avec un titre et un texte riche pour raconter une étape clé.',\n    placeholder: {\n      title: 'Une histoire qui marque',\n      description: 'Ajoutez un paragraphe clair, des liens et des éléments de contexte.'\n    }\n  },\n  {\n    id: 'checklist',\n    name: 'Points d’attention',\n    description: 'Une liste courte pour détailler des livrables, risques ou actions à suivre.',\n    placeholder: {\n      title: 'Nos priorités',\n      description: 'Listez 3 à 5 éléments concrets à surveiller.',\n      items: ['Point clé #1', 'Point clé #2', 'Point clé #3']\n    }\n  }\n];\n\nconst SECTION_TEMPLATE_CONFIG = {\n  highlight: {\n    showSubtitle: false,\n    showAccent: true,\n    showDescription: true,\n    showColumns: false,\n    showDocument: false,\n    showItems: false\n  },\n  columns: {\n    showSubtitle: true,\n    showAccent: false,\n    showDescription: false,\n    showColumns: true,\n    showDocument: false,\n    showItems: false\n  },\n  'document-viewer': {\n    showSubtitle: true,\n    showAccent: true,\n    showDescription: true,\n    showColumns: false,\n    showDocument: true,\n    showItems: false\n  },\n  story: {\n    showSubtitle: false,\n    showAccent: false,\n    showDescription: true,\n    showColumns: false,\n    showDocument: false,\n    showItems: false\n  },\n  checklist: {\n    showSubtitle: false,\n    showAccent: false,\n    showDescription: true,\n    showColumns: false,\n    showDocument: false,\n    showItems: true\n  }\n};\n\nconst buildDefaultLightSectionSelection = (sectionIds = SHOWCASE_SECTION_OPTIONS.map(section => section.id)) =>\n  sectionIds.reduce((acc, sectionId) => {\n    acc[sectionId] = true;\n    return acc;\n  }, {});\n\nconst DOCUMENT_VIEWER_TYPES = [\n  { id: 'pdf', label: 'PDF' },\n  { id: 'jpg', label: 'JPG' },\n  { id: 'png', label: 'PNG' },\n  { id: 'pptx', label: 'PPTX' }\n];\n\nconst resolveCustomSectionColumnCount = (value, columns = []) => {\n  const parsed = Number.parseInt(value, 10);\n  if (Number.isFinite(parsed) && parsed > 0) {\n    return Math.min(MAX_CUSTOM_SECTION_COLUMNS, parsed);\n  }\n  if (Array.isArray(columns) && columns.length > 0) {\n    return Math.min(MAX_CUSTOM_SECTION_COLUMNS, columns.length);\n  }\n  return 1;\n};\n\nconst normalizeCustomSectionColumns = (columns, columnCount) => {\n  const normalized = Array.isArray(columns)\n    ? columns.map(column => (typeof column === 'string' ? column.trim() : ''))\n    : [];\n  const boundedColumns = normalized.slice(0, columnCount);\n  while (boundedColumns.length < columnCount) {\n    boundedColumns.push('');\n  }\n  return boundedColumns;\n};\n\nconst isSharePointUrl = (value) => {\n  if (typeof value !== 'string') {\n    return false;\n  }\n\n  return value.toLowerCase().includes('sharepoint');\n};\n\nconst resolveDocumentEmbedSrc = (documentUrl, documentType) => {\n  if (!documentUrl) {\n    return '';\n  }\n\n  if (['jpg', 'png'].includes(documentType)) {\n    return documentUrl;\n  }\n\n  if (documentUrl.includes('officeapps.live.com')) {\n    return documentUrl;\n  }\n\n  return `https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(documentUrl)}`;\n};\n\nconst resolveTemplateConfig = (templateId) =>\n  SECTION_TEMPLATE_CONFIG[templateId] || SECTION_TEMPLATE_CONFIG.highlight;\n\nconst sanitizeCustomSections = (rawSections) => {\n  if (!Array.isArray(rawSections)) {\n    return [];\n  }\n\n  return rawSections\n    .map((section, index) => {\n      if (!section || typeof section !== 'object') {\n        return null;\n      }\n\n      const id = typeof section.id === 'string' && section.id.trim().length > 0\n        ? section.id.trim()\n        : `custom-section-${index}`;\n\n      const title = typeof section.title === 'string' ? section.title.trim() : '';\n      const subtitle = typeof section.subtitle === 'string' ? section.subtitle.trim() : '';\n      const description = typeof section.description === 'string' ? section.description.trim() : '';\n      const accent = typeof section.accent === 'string' ? section.accent.trim() : '';\n      const documentUrl = typeof section.documentUrl === 'string' ? section.documentUrl.trim() : '';\n      const documentType = typeof section.documentType === 'string' ? section.documentType.trim() : '';\n      const items = Array.isArray(section.items)\n        ? section.items.map(item => (typeof item === 'string' ? item.trim() : '')).filter(Boolean)\n        : [];\n      const type = typeof section.type === 'string' ? section.type : SECTION_TEMPLATES[0].id;\n      const columnCount = resolveCustomSectionColumnCount(section.columnCount, section.columns);\n      const columns = normalizeCustomSectionColumns(section.columns, columnCount);\n      const hasColumnContent = columns.some(column => column.length > 0);\n\n      if (!title && !subtitle && !description && !documentUrl && items.length === 0 && !hasColumnContent) {\n        return null;\n      }\n\n      return {\n        id,\n        type,\n        title,\n        subtitle,\n        description,\n        accent,\n        documentUrl,\n        documentType,\n        items,\n        columnCount,\n        columns\n      };\n    })\n    .filter(Boolean);\n};\n\nconst normalizeSectionOrder = (rawOrder, customSections) => {\n  const baseOrder = SHOWCASE_SECTION_OPTIONS.map(section => section.id);\n  const customIds = Array.isArray(customSections) ? customSections.map(section => section.id) : [];\n  const fallbackOrder = [...baseOrder, ...customIds];\n\n  if (!Array.isArray(rawOrder)) {\n    return fallbackOrder;\n  }\n\n  const knownIds = new Set(fallbackOrder);\n  const seen = new Set();\n  const normalized = [];\n\n  rawOrder.forEach(entry => {\n    if (typeof entry !== 'string' || !knownIds.has(entry) || seen.has(entry)) {\n      return;\n    }\n    normalized.push(entry);\n    seen.add(entry);\n  });\n\n  fallbackOrder.forEach(entry => {\n    if (!seen.has(entry)) {\n      normalized.push(entry);\n    }\n  });\n\n  return normalized;\n};\n\nconst areCustomSectionsEqual = (previous, next) => {\n  if (!Array.isArray(previous) && !Array.isArray(next)) {\n    return true;\n  }\n\n  if (!Array.isArray(previous) || !Array.isArray(next) || previous.length !== next.length) {\n    return false;\n  }\n\n  return previous.every((entry, index) => {\n    const candidate = next[index];\n    if (!candidate) {\n      return false;\n    }\n\n    return entry.id === candidate.id\n      && entry.title === candidate.title\n      && entry.subtitle === candidate.subtitle\n      && entry.description === candidate.description\n      && entry.accent === candidate.accent\n      && entry.documentUrl === candidate.documentUrl\n      && entry.documentType === candidate.documentType\n      && JSON.stringify(entry.items || []) === JSON.stringify(candidate.items || [])\n      && entry.columnCount === candidate.columnCount\n      && JSON.stringify(entry.columns || []) === JSON.stringify(candidate.columns || [])\n      && entry.type === candidate.type;\n  });\n};\n\nconst findQuestionById = (questions, id) => {\n  if (!Array.isArray(questions)) {\n    return null;\n  }\n\n  return questions.find(question => question?.id === id) || null;\n};\n\nconst getFormattedAnswer = (questions, answers, id) => {\n  const question = findQuestionById(questions, id);\n  if (!question) {\n    return '';\n  }\n\n  const formatted = formatAnswer(question, answers?.[id]);\n\n  if (typeof formatted === 'string') {\n    const trimmed = formatted.trim();\n    if (trimmed.length > 0) {\n      return trimmed;\n    }\n  } else if (formatted) {\n    return formatted;\n  }\n\n  return question.required ? 'Information à compléter' : '';\n};\n\nconst getRawAnswer = (answers, id) => {\n  if (!answers) {\n    return undefined;\n  }\n\n  return answers[id];\n};\n\nconst hasText = (value) => typeof value === 'string' && value.trim().length > 0;\n\nconst formatNumberFR = (value, options = {}) => {\n  const numericValue = Number(value);\n  if (!Number.isFinite(numericValue)) {\n    return '';\n  }\n\n  return numericValue.toLocaleString('fr-FR', options);\n};\n\nconst formatWeeksValue = (weeks) => {\n  if (weeks === undefined || weeks === null) {\n    return '';\n  }\n\n  const rounded = Math.round(weeks * 10) / 10;\n  const hasDecimal = Math.abs(rounded - Math.round(rounded)) > 0.0001;\n\n  return `${formatNumberFR(rounded, {\n    minimumFractionDigits: hasDecimal ? 1 : 0,\n    maximumFractionDigits: hasDecimal ? 1 : 0\n  })} sem.`;\n};\n\nconst formatDaysValue = (days) => {\n  if (days === undefined || days === null) {\n    return '';\n  }\n\n  return `${formatNumberFR(Math.round(days))} j.`;\n};\n\nconst resolveQuestionTitle = (questions, id) => {\n  if (!id) {\n    return '';\n  }\n\n  const question = findQuestionById(questions, id);\n  return question?.question || id;\n};\n\nconst formatTimingRequirementSummary = (questions, constraint) => {\n  if (!constraint || typeof constraint !== 'object') {\n    return '';\n  }\n\n  const startLabel = resolveQuestionTitle(questions, constraint.startQuestion);\n  const endLabel = resolveQuestionTitle(questions, constraint.endQuestion);\n\n  const requirementParts = [];\n  if (typeof constraint.minimumWeeks === 'number') {\n    requirementParts.push(`${formatNumberFR(constraint.minimumWeeks)} sem.`);\n  }\n  if (typeof constraint.minimumDays === 'number') {\n    requirementParts.push(`${formatNumberFR(constraint.minimumDays)} j.`);\n  }\n\n  const hasRequirement = requirementParts.length > 0;\n  const hasStart = Boolean(startLabel);\n  const hasEnd = Boolean(endLabel);\n\n  if (!hasRequirement && !hasStart && !hasEnd) {\n    return '';\n  }\n\n  if (hasRequirement && hasStart && hasEnd) {\n    return `Respecter un délai minimal de ${requirementParts.join(' / ')} entre « ${startLabel} » et « ${endLabel} ».`;\n  }\n\n  if (hasRequirement && hasStart && !hasEnd) {\n    return `Respecter un délai minimal de ${requirementParts.join(' / ')} après « ${startLabel} ».`;\n  }\n\n  if (hasRequirement && !hasStart && hasEnd) {\n    return `Respecter un délai minimal de ${requirementParts.join(' / ')} avant « ${endLabel} ».`;\n  }\n\n  if (hasRequirement) {\n    return `Respecter un délai minimal de ${requirementParts.join(' / ')} avant la prochaine étape.`;\n  }\n\n  if (hasStart && hasEnd) {\n    return `Surveiller le délai entre « ${startLabel} » et « ${endLabel} ».`;\n  }\n\n  const singleLabel = startLabel || endLabel;\n  if (singleLabel) {\n    return `Surveiller la date « ${singleLabel} ».`;\n  }\n\n  return '';\n};\n\nconst formatVigilanceStatusMessage = (alert) => {\n  if (!alert || typeof alert !== 'object') {\n    return '';\n  }\n\n  if (alert.status === 'unknown') {\n    return \"Dates manquantes : complétez les informations pour confirmer ce délai.\";\n  }\n\n  if (alert.status === 'breach') {\n    const diffWeeks = alert.diff && typeof alert.diff.diffInWeeks === 'number'\n      ? alert.diff.diffInWeeks\n      : null;\n    const diffDays = alert.diff && typeof alert.diff.diffInDays === 'number'\n      ? alert.diff.diffInDays\n      : null;\n\n    const requiredWeeks = typeof alert.requiredWeeks === 'number' ? alert.requiredWeeks : null;\n    const requiredDays = typeof alert.requiredDays === 'number' ? alert.requiredDays : null;\n\n    const requiredParts = [];\n    if (requiredWeeks !== null) {\n      requiredParts.push(`${formatNumberFR(requiredWeeks)} sem.`);\n    }\n    if (requiredDays !== null) {\n      requiredParts.push(`${formatNumberFR(requiredDays)} j.`);\n    }\n\n    const missingParts = [];\n    if (requiredWeeks !== null && diffWeeks !== null) {\n      const missingWeeks = requiredWeeks - diffWeeks;\n      if (missingWeeks > 0.0001) {\n        missingParts.push(formatWeeksValue(missingWeeks));\n      }\n    }\n    if (requiredDays !== null && diffDays !== null) {\n      const missingDays = requiredDays - diffDays;\n      if (missingDays > 0.0001) {\n        missingParts.push(formatDaysValue(missingDays));\n      }\n    }\n\n    if (missingParts.length > 0 && requiredParts.length > 0) {\n      return `Écart à combler : ${missingParts.join(' / ')} pour atteindre le minimum requis de ${requiredParts.join(' / ')}. Ajuster le planning en conséquence.`;\n    }\n\n    if (missingParts.length > 0) {\n      return `Écart à combler : ${missingParts.join(' / ')}. Ajuster le planning en conséquence.`;\n    }\n\n    const diffParts = [];\n    if (diffWeeks !== null) {\n      diffParts.push(formatWeeksValue(diffWeeks));\n    }\n    if (diffDays !== null) {\n      diffParts.push(formatDaysValue(diffDays));\n    }\n\n    if (diffParts.length === 0 && requiredParts.length === 0) {\n      return 'Délai insuffisant : ajuster les jalons pour respecter l’exigence.';\n    }\n\n    if (diffParts.length === 0) {\n      return `Délai insuffisant – minimum requis : ${requiredParts.join(' / ')}.`;\n    }\n\n    const diffLabel = diffParts.join(' / ');\n    if (requiredParts.length === 0) {\n      return `Délai constaté : ${diffLabel}. Ajuster le planning pour sécuriser le lancement.`;\n    }\n\n    return `Délai constaté : ${diffLabel} – minimum requis : ${requiredParts.join(' / ')}. Ajuster le planning en conséquence.`;\n  }\n\n  if (alert.status === 'satisfied' && alert.diff) {\n    const parts = [];\n    if (typeof alert.diff.diffInWeeks === 'number') {\n      parts.push(formatWeeksValue(alert.diff.diffInWeeks));\n    }\n    if (typeof alert.diff.diffInDays === 'number') {\n      parts.push(formatDaysValue(alert.diff.diffInDays));\n    }\n\n    const diffLabel = parts.length > 0 ? parts.join(' / ') : '';\n    if (diffLabel) {\n      return `Délai actuel : ${diffLabel}. Maintenir cette marge pour éviter l’alerte.`;\n    }\n\n    return 'Délai actuel conforme. Maintenir cette marge pour éviter l’alerte.';\n  }\n\n  return '';\n};\n\nconst buildVigilanceAlerts = (analysis, questions, resolveTeamLabel) => {\n  const rawAlerts = Array.isArray(analysis?.timeline?.vigilance)\n    ? analysis.timeline.vigilance\n    : [];\n\n  return rawAlerts\n    .filter(alert => alert && typeof alert === 'object')\n    .map((alert, index) => {\n      const title = alert.riskDescription && alert.riskDescription.trim().length > 0\n        ? alert.riskDescription.trim()\n        : alert.ruleName;\n\n      const normalizedRuleId = alert?.ruleId != null\n        ? (() => {\n            const value = String(alert.ruleId).trim();\n            return value.length > 0 ? value : null;\n          })()\n        : null;\n      const normalizedRiskId = alert?.riskId != null\n        ? (() => {\n            const value = String(alert.riskId).trim();\n            return value.length > 0 ? value : null;\n          })()\n        : null;\n      const normalizedRiskDescription = typeof alert?.riskDescription === 'string'\n        ? alert.riskDescription.trim()\n        : '';\n\n      return {\n        id: alert.id || `${alert.ruleId || 'rule'}-${alert.riskId || index}`,\n        ruleId: normalizedRuleId,\n        ruleName: alert.ruleName,\n        riskId: normalizedRiskId,\n        riskDescription: normalizedRiskDescription,\n        title,\n        priority: alert.priority || '',\n        requirementSummary: formatTimingRequirementSummary(questions, alert.timingConstraint),\n        statusMessage: formatVigilanceStatusMessage(alert),\n        status: alert.status || 'unknown',\n        teamId: alert.teamId || '',\n        teamLabel: typeof resolveTeamLabel === 'function'\n          ? resolveTeamLabel(alert.teamId)\n          : (alert.teamId || '')\n      };\n    })\n    .filter(entry => entry.title || entry.requirementSummary || entry.statusMessage);\n};\n\nconst mergeTimelineSummariesWithAlerts = (summaries, alerts) => {\n  const safeSummaries = Array.isArray(summaries) ? summaries : [];\n  const safeAlerts = Array.isArray(alerts) ? alerts : [];\n\n  if (safeSummaries.length === 0) {\n    return { summaries: safeSummaries, unmatchedAlerts: safeAlerts };\n  }\n\n  const alertKeyMap = new Map();\n\n  const registerKey = (map, key, entry) => {\n    if (key === null || key === undefined) {\n      return;\n    }\n\n    const stringKey = typeof key === 'string' ? key : String(key);\n    if (stringKey.length === 0) {\n      return;\n    }\n\n    if (!map.has(stringKey)) {\n      map.set(stringKey, entry);\n    }\n\n    const normalized = stringKey.trim().toLowerCase();\n    if (normalized.length > 0 && !map.has(normalized)) {\n      map.set(normalized, entry);\n    }\n  };\n\n  const registerTextKey = (map, text, entry) => {\n    if (typeof text !== 'string') {\n      return;\n    }\n\n    const trimmed = text.trim();\n    if (trimmed.length === 0) {\n      return;\n    }\n\n    registerKey(map, trimmed, entry);\n  };\n\n  const registerCompositeKey = (map, parts, entry) => {\n    if (!Array.isArray(parts)) {\n      return;\n    }\n\n    const normalizedParts = parts\n      .map(part => {\n        if (part === null || part === undefined) {\n          return null;\n        }\n\n        if (typeof part === 'string') {\n          const trimmed = part.trim();\n          return trimmed.length > 0 ? trimmed : null;\n        }\n\n        const stringified = String(part);\n        return stringified.length > 0 ? stringified : null;\n      })\n      .filter(Boolean);\n\n    if (normalizedParts.length === 0) {\n      return;\n    }\n\n    registerKey(map, normalizedParts.join('::'), entry);\n  };\n\n  safeAlerts.forEach((alert, index) => {\n    if (!alert || typeof alert !== 'object') {\n      return;\n    }\n\n    const entry = { alert, index };\n\n    registerTextKey(alertKeyMap, alert.id, entry);\n    registerTextKey(alertKeyMap, alert.ruleId, entry);\n    registerTextKey(alertKeyMap, alert.ruleName, entry);\n    registerTextKey(alertKeyMap, alert.title, entry);\n    registerTextKey(alertKeyMap, alert.riskDescription, entry);\n\n    if (alert.ruleId) {\n      if (alert.riskId != null) {\n        const riskId = String(alert.riskId);\n        registerKey(alertKeyMap, `${alert.ruleId}-${riskId}`, entry);\n        registerKey(alertKeyMap, `${alert.ruleId}__${riskId}`, entry);\n        registerCompositeKey(alertKeyMap, [alert.ruleId, riskId], entry);\n      } else {\n        registerKey(alertKeyMap, `${alert.ruleId}-risk`, entry);\n      }\n\n      if (typeof alert.title === 'string' && alert.title.trim().length > 0) {\n        registerCompositeKey(alertKeyMap, [alert.ruleId, alert.title], entry);\n      }\n\n      if (typeof alert.riskDescription === 'string' && alert.riskDescription.trim().length > 0) {\n        registerCompositeKey(alertKeyMap, [alert.ruleId, alert.riskDescription], entry);\n      }\n\n      if (typeof alert.ruleName === 'string' && alert.ruleName.trim().length > 0) {\n        registerCompositeKey(alertKeyMap, [alert.ruleId, alert.ruleName], entry);\n      }\n    }\n  });\n\n  const matchedAlertIndexes = new Set();\n\n  const mergedSummaries = safeSummaries.map(summary => {\n    if (!summary || typeof summary !== 'object') {\n      return summary;\n    }\n\n    const candidateKeys = [];\n\n    if (summary.id) {\n      candidateKeys.push(summary.id);\n    }\n\n    if (summary.source) {\n      candidateKeys.push(summary.source);\n    }\n\n    if (summary.ruleId) {\n      candidateKeys.push(summary.ruleId);\n\n      if (summary.ruleLabel) {\n        candidateKeys.push(`${summary.ruleId}::${summary.ruleLabel}`);\n      }\n\n      if (summary.ruleName && typeof summary.ruleName === 'string') {\n        candidateKeys.push(`${summary.ruleId}::${summary.ruleName}`);\n      }\n\n      if (summary.riskDescription) {\n        candidateKeys.push(`${summary.ruleId}::${summary.riskDescription}`);\n      }\n\n      if (!summary.riskId && summary.source) {\n        candidateKeys.push(`${summary.ruleId}-${summary.source}`);\n        candidateKeys.push(`${summary.ruleId}::${summary.source}`);\n      }\n    }\n\n    if (summary.ruleLabel) {\n      candidateKeys.push(summary.ruleLabel);\n    }\n\n    if (summary.ruleName && typeof summary.ruleName === 'string') {\n      candidateKeys.push(summary.ruleName);\n    }\n\n    if (summary.riskDescription) {\n      candidateKeys.push(summary.riskDescription);\n    }\n\n    if (summary.riskId != null) {\n      candidateKeys.push(summary.riskId);\n\n      if (summary.ruleId) {\n        candidateKeys.push(`${summary.ruleId}-${summary.riskId}`);\n        candidateKeys.push(`${summary.ruleId}__${summary.riskId}`);\n        candidateKeys.push(`${summary.ruleId}::${summary.riskId}`);\n      }\n    }\n\n    let matchedEntry = null;\n\n    for (const key of candidateKeys) {\n      if (!key) {\n        continue;\n      }\n\n      if (alertKeyMap.has(key)) {\n        matchedEntry = alertKeyMap.get(key);\n        break;\n      }\n\n      if (typeof key === 'string') {\n        const normalizedKey = key.trim().toLowerCase();\n        if (alertKeyMap.has(normalizedKey)) {\n          matchedEntry = alertKeyMap.get(normalizedKey);\n          break;\n        }\n      }\n    }\n\n    if (matchedEntry) {\n      matchedAlertIndexes.add(matchedEntry.index);\n      return {\n        ...summary,\n        alert: matchedEntry.alert\n      };\n    }\n\n    return summary;\n  });\n\n  const unmatchedAlerts = safeAlerts.filter((_, index) => !matchedAlertIndexes.has(index));\n\n  return {\n    summaries: mergedSummaries,\n    unmatchedAlerts\n  };\n};\n\nconst FALLBACK_SHOWCASE_THEME = initialShowcaseThemes[0] || {\n  id: 'aurora',\n  label: 'Aurora néon',\n  description: 'Jeux de lumières et ambiance futuriste pour un rendu premium.',\n  palette: {}\n};\n\nconst normalizeColorValue = (value, fallback) => {\n  if (typeof value === 'string' && value.trim().length > 0) {\n    return value.trim();\n  }\n\n  return fallback;\n};\n\nconst toRgba = (value, alpha = 1, fallback = 'rgba(0, 0, 0, 1)') => {\n  if (typeof value !== 'string' || value.trim().length === 0) {\n    return fallback;\n  }\n\n  const normalized = value.trim();\n\n  if (/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(normalized)) {\n    let hex = normalized.slice(1);\n    if (hex.length === 3) {\n      hex = hex.split('').map(char => char + char).join('');\n    }\n\n    const numeric = parseInt(hex, 16);\n    const r = (numeric >> 16) & 255;\n    const g = (numeric >> 8) & 255;\n    const b = numeric & 255;\n    const safeAlpha = Math.min(1, Math.max(0, typeof alpha === 'number' ? alpha : 1));\n\n    return `rgba(${r}, ${g}, ${b}, ${safeAlpha})`;\n  }\n\n  if (/^rgba?\\(/i.test(normalized)) {\n    if (normalized.startsWith('rgb(') && typeof alpha === 'number') {\n      return normalized.replace(/^rgb\\((.*)\\)$/i, `rgba($1, ${Math.min(1, Math.max(0, alpha))})`);\n    }\n\n    return normalized;\n  }\n\n  return fallback;\n};\n\nconst buildThemeVariables = (theme) => {\n  const palette = (theme && typeof theme === 'object' ? theme.palette : null) || {};\n  const accentPrimary = normalizeColorValue(palette.accentPrimary, '#2563eb');\n  const accentSecondary = normalizeColorValue(palette.accentSecondary, '#06b6d4');\n  const borderBase = normalizeColorValue(palette.border, '#94a3b8');\n  const highlightBase = normalizeColorValue(palette.highlight, accentSecondary);\n  const inkStrong = normalizeColorValue(palette.inkStrong, '#0f172a');\n  const inkSoft = normalizeColorValue(palette.inkSoft, '#1e293b');\n  const inkMuted = normalizeColorValue(palette.inkMuted, '#475569');\n  const inkSubtle = normalizeColorValue(palette.inkSubtle, '#94a3b8');\n  const surfaceLight = normalizeColorValue(palette.surfaceLight, '#f8fafc');\n  const surfaceLightAlt = normalizeColorValue(palette.surfaceLightAlt, '#e2e8f0');\n  const titleGradientStart = normalizeColorValue(palette.titleGradientStart, accentPrimary);\n  const titleGradientMid = normalizeColorValue(palette.titleGradientMid, highlightBase);\n  const titleGradientEnd = normalizeColorValue(palette.titleGradientEnd, accentSecondary);\n  const ctaStart = normalizeColorValue(palette.ctaStart, accentPrimary);\n  const ctaEnd = normalizeColorValue(palette.ctaEnd, accentSecondary);\n  const heroStart = normalizeColorValue(palette.heroBackgroundStart, '#000000');\n  const heroMid = normalizeColorValue(palette.heroBackgroundMid, '#090d15');\n  const heroEnd = normalizeColorValue(palette.heroBackgroundEnd, '#0b1f2c');\n  const panelSoftStart = normalizeColorValue(palette.panelSoftStart, '#101728');\n  const panelSoftEnd = normalizeColorValue(palette.panelSoftEnd, '#1b2230');\n  const panelStrongStart = normalizeColorValue(palette.panelStrongStart, '#0b2f41');\n  const panelStrongEnd = normalizeColorValue(palette.panelStrongEnd, '#0e5560');\n  const statusOkStart = normalizeColorValue(palette.statusOkStart, '#d1fae5');\n  const statusOkEnd = normalizeColorValue(palette.statusOkEnd, '#a7f3d0');\n  const statusWarnStart = normalizeColorValue(palette.statusWarnStart, '#ecfdf5');\n  const statusWarnEnd = normalizeColorValue(palette.statusWarnEnd, '#d1fae5');\n  const statusAlertStart = normalizeColorValue(palette.statusAlertStart, '#fee2e2');\n  const statusAlertEnd = normalizeColorValue(palette.statusAlertEnd, '#fecaca');\n  const statusAlertStrongStart = normalizeColorValue(palette.statusAlertStrongStart, '#f05959');\n  const statusAlertStrongEnd = normalizeColorValue(palette.statusAlertStrongEnd, '#be1717');\n  const statusOkText = normalizeColorValue(palette.statusOkText, '#064e3b');\n  const statusWarnText = normalizeColorValue(palette.statusWarnText, '#064e3b');\n  const statusAlertText = normalizeColorValue(palette.statusAlertText, '#7f1d1d');\n\n  return {\n    '--showcase-bg-start': normalizeColorValue(palette.backgroundStart, '#020309'),\n    '--showcase-bg-mid': normalizeColorValue(palette.backgroundMid, '#050b18'),\n    '--showcase-bg-end': normalizeColorValue(palette.backgroundEnd, '#020309'),\n    '--showcase-glow-primary': toRgba(palette.glowPrimary || accentPrimary, 0.18, 'rgba(59, 130, 246, 0.18)'),\n    '--showcase-glow-secondary': toRgba(palette.glowSecondary || accentSecondary, 0.16, 'rgba(14, 165, 233, 0.16)'),\n    '--showcase-text-strong': normalizeColorValue(palette.textPrimary, '#f8fafc'),\n    '--showcase-text-soft': normalizeColorValue(palette.textSecondary, '#e2e8f0'),\n    '--showcase-accent-primary': accentPrimary,\n    '--showcase-accent-secondary': accentSecondary,\n    '--showcase-surface': toRgba(palette.surface, 0.78, 'rgba(8, 13, 22, 0.78)'),\n    '--showcase-border-strong': toRgba(borderBase, 0.25, 'rgba(148, 163, 184, 0.25)'),\n    '--showcase-border-soft': toRgba(borderBase, 0.28, 'rgba(148, 163, 184, 0.28)'),\n    '--showcase-highlight-strong': toRgba(highlightBase, 0.85, 'rgba(148, 197, 255, 0.85)'),\n    '--showcase-highlight-soft': toRgba(highlightBase, 0.7, 'rgba(148, 197, 255, 0.7)'),\n    '--showcase-shadow-soft': toRgba(accentSecondary, 0.32, 'rgba(14, 165, 233, 0.32)'),\n    '--showcase-shadow-strong': toRgba(accentSecondary, 0.4, 'rgba(14, 165, 233, 0.4)'),\n    '--showcase-ink-strong': inkStrong,\n    '--showcase-ink-soft': inkSoft,\n    '--showcase-ink-muted': inkMuted,\n    '--showcase-ink-subtle': inkSubtle,\n    '--showcase-surface-light': surfaceLight,\n    '--showcase-surface-light-alt': surfaceLightAlt,\n    '--showcase-surface-card': toRgba(surfaceLight, 0.82, 'rgba(255, 255, 255, 0.82)'),\n    '--showcase-surface-card-soft': toRgba(surfaceLight, 0.72, 'rgba(255, 255, 255, 0.72)'),\n    '--showcase-surface-panel': toRgba(surfaceLight, 0.78, 'rgba(255, 255, 255, 0.78)'),\n    '--showcase-surface-panel-soft': toRgba(surfaceLight, 0.95, 'rgba(248, 250, 252, 0.95)'),\n    '--showcase-border-light': toRgba(borderBase, 0.4, 'rgba(148, 197, 255, 0.4)'),\n    '--showcase-title-gradient': `linear-gradient(120deg, ${titleGradientStart}, ${titleGradientMid}, ${titleGradientEnd})`,\n    '--showcase-title-shadow': toRgba(accentSecondary, 0.35, 'rgba(14, 116, 144, 0.35)'),\n    '--showcase-title-sheen': toRgba(surfaceLight, 0.65, 'rgba(255, 255, 255, 0.65)'),\n    '--showcase-cta-gradient': `linear-gradient(120deg, ${ctaStart}, ${ctaEnd})`,\n    '--showcase-cta-text': normalizeColorValue(palette.ctaText, '#ecfeff'),\n    '--showcase-hero-gradient': `linear-gradient(135deg, ${heroStart} 0%, ${heroMid} 45%, ${heroEnd} 100%)`,\n    '--showcase-hero-glow-primary': toRgba(highlightBase, 0.15, 'rgba(148, 197, 255, 0.15)'),\n    '--showcase-hero-glow-secondary': toRgba(accentSecondary, 0.18, 'rgba(14, 165, 233, 0.18)'),\n    '--showcase-highlight-panel': `linear-gradient(145deg, ${toRgba(highlightBase, 0.18, 'rgba(148, 197, 255, 0.18)')}, ${toRgba(palette.backgroundMid || '#0c1220', 0.38, 'rgba(15, 23, 42, 0.38)')})`,\n    '--showcase-panel-soft-gradient': `linear-gradient(135deg, ${panelSoftStart} 0%, ${panelSoftEnd} 100%)`,\n    '--showcase-panel-strong-gradient': `linear-gradient(135deg, ${panelStrongStart} 0%, ${panelStrongEnd} 100%)`,\n    '--showcase-panel-light-gradient': `linear-gradient(135deg, ${surfaceLightAlt} 0%, ${surfaceLight} 100%)`,\n    '--showcase-panel-soft-surface': `linear-gradient(140deg, ${toRgba(highlightBase, 0.16, 'rgba(148, 197, 255, 0.16)')}, ${toRgba(palette.backgroundMid || '#0c1220', 0.42, 'rgba(12, 18, 32, 0.42)')})`,\n    '--showcase-panel-card-gradient': `linear-gradient(150deg, ${toRgba(highlightBase, 0.16, 'rgba(148, 197, 255, 0.16)')}, ${toRgba(palette.backgroundMid || '#0c1220', 0.4, 'rgba(15, 23, 42, 0.4)')})`,\n    '--showcase-impact-gradient': `linear-gradient(140deg, ${toRgba(accentSecondary, 0.12, 'rgba(56, 189, 248, 0.12)')}, ${toRgba(accentPrimary, 0.32, 'rgba(30, 64, 175, 0.32)')}, ${toRgba(palette.backgroundEnd || '#020309', 0.8, 'rgba(2, 6, 23, 0.8)')})`,\n    '--showcase-impact-card-gradient': `radial-gradient(circle at 12% 18%, ${toRgba(highlightBase, 0.26, 'rgba(191, 219, 254, 0.26)')}, transparent 55%), radial-gradient(circle at 88% 82%, ${toRgba(highlightBase, 0.24, 'rgba(147, 197, 253, 0.24)')}, transparent 52%), linear-gradient(155deg, ${toRgba(accentPrimary, 0.65, 'rgba(30, 64, 175, 0.65)')}, ${toRgba(accentSecondary, 0.55, 'rgba(15, 118, 110, 0.55)')})`,\n    '--showcase-impact-vision-gradient': `radial-gradient(circle at 16% 22%, ${toRgba(highlightBase, 0.25, 'rgba(191, 219, 254, 0.25)')}, transparent 50%), linear-gradient(150deg, ${toRgba(accentSecondary, 0.24, 'rgba(56, 189, 248, 0.24)')}, ${toRgba(accentPrimary, 0.55, 'rgba(30, 58, 138, 0.55)')})`,\n    '--showcase-risk-halo-gradient': `radial-gradient(circle at 30% 30%, ${toRgba(accentPrimary, 0.55, 'rgba(92, 50, 0, 0.55)')}, ${toRgba(accentSecondary, 0.55, 'rgba(59, 37, 0, 0.55)')})`,\n    '--showcase-risk-note': toRgba(surfaceLight, 0.9, 'rgba(255, 228, 196, 0.9)'),\n    '--showcase-partner-bg': toRgba(accentPrimary, 0.12, 'rgba(78, 131, 255, 0.12)'),\n    '--showcase-status-ok-gradient': `linear-gradient(135deg, ${statusOkStart} 0%, ${statusOkEnd} 100%)`,\n    '--showcase-status-warn-gradient': `linear-gradient(135deg, ${statusWarnStart} 0%, ${statusWarnEnd} 100%)`,\n    '--showcase-status-alert-gradient': `linear-gradient(135deg, ${statusAlertStart} 0%, ${statusAlertEnd} 100%)`,\n    '--showcase-status-alert-strong-gradient': `linear-gradient(135deg, ${statusAlertStrongStart} 0%, ${statusAlertStrongEnd} 100%)`,\n    '--showcase-status-ok-text': statusOkText,\n    '--showcase-status-warn-text': statusWarnText,\n    '--showcase-status-alert-text': statusAlertText,\n    '--showcase-accent-soft': toRgba(highlightBase, 0.85, 'rgba(147, 197, 253, 0.85)'),\n    '--showcase-accent-strong': toRgba(accentPrimary, 0.9, 'rgba(59, 130, 246, 0.9)'),\n    '--showcase-accent-muted': toRgba(accentPrimary, 0.75, 'rgba(79, 70, 229, 0.75)')\n  };\n};\n\nconst normalizeThemeKey = (value) => (typeof value === 'string' ? value.trim().toLowerCase() : '');\n\nconst resolveShowcaseTheme = (themes, answer) => {\n  const availableThemes = Array.isArray(themes) && themes.length > 0 ? themes : initialShowcaseThemes;\n  const normalizedAnswer = normalizeThemeKey(answer);\n\n  if (normalizedAnswer.length > 0) {\n    const matched = availableThemes.find(theme => {\n      if (!theme) {\n        return false;\n      }\n\n      const candidates = [theme.id, theme.label, ...(Array.isArray(theme.aliases) ? theme.aliases : [])]\n        .filter(Boolean)\n        .map(normalizeThemeKey);\n\n      return candidates.includes(normalizedAnswer);\n    });\n\n    if (matched) {\n      return matched;\n    }\n  }\n\n  return availableThemes[0] || FALLBACK_SHOWCASE_THEME;\n};\n\nconst SHOWCASE_FIELD_CONFIG = [\n  { id: 'projectName', fallbackLabel: 'Nom du projet', fallbackType: 'text' },\n  { id: 'projectSlogan', fallbackLabel: 'Slogan du projet', fallbackType: 'text' },\n  { id: 'showcaseTheme', fallbackLabel: 'Thème de la vitrine', fallbackType: 'choice' },\n  { id: 'targetAudience', fallbackLabel: 'Audience cible', fallbackType: 'multi_choice' },\n  { id: 'problemPainPoints', fallbackLabel: 'Besoins utilisateurs', fallbackType: 'long_text' },\n  { id: 'solutionDescription', fallbackLabel: 'Description de la solution', fallbackType: 'long_text' },\n  { id: 'solutionBenefits', fallbackLabel: 'Bénéfices clés', fallbackType: 'long_text' },\n  { id: 'solutionComparison', fallbackLabel: 'Différenciation', fallbackType: 'long_text' },\n  { id: 'innovationProcess', fallbackLabel: 'Processus innovation', fallbackType: 'long_text' },\n  { id: 'visionStatement', fallbackLabel: \"Indicateurs d'impact\", fallbackType: 'long_text' },\n  { id: 'BUDGET', fallbackLabel: 'Budget estimé (K€)', fallbackType: 'number' },\n  { id: 'teamLead', fallbackLabel: 'Lead du projet', fallbackType: 'text' },\n  { id: 'teamLeadTeam', fallbackLabel: 'Équipe du lead', fallbackType: 'text' },\n  { id: 'teamCoreMembers', fallbackLabel: 'Membres clés', fallbackType: 'long_text' },\n  { id: 'campaignKickoffDate', fallbackLabel: 'Date de soumission compliance', fallbackType: 'date' },\n  { id: 'launchDate', fallbackLabel: 'Date de lancement', fallbackType: 'date' },\n  { id: 'roadmapMilestones', fallbackLabel: 'Jalons du projet', fallbackType: 'milestone_list' }\n];\n\nconst FIELD_SECTION_MAP = {\n  projectName: 'hero',\n  projectSlogan: 'hero',\n  showcaseTheme: 'hero',\n  targetAudience: 'hero',\n  problemPainPoints: 'problem',\n  solutionDescription: 'solution',\n  solutionBenefits: 'solution',\n  solutionComparison: 'solution',\n  innovationProcess: 'innovation',\n  visionStatement: 'innovation',\n  BUDGET: 'innovation',\n  teamLead: 'team',\n  teamLeadTeam: 'team',\n  teamCoreMembers: 'team',\n  campaignKickoffDate: 'timeline',\n  launchDate: 'timeline',\n  roadmapMilestones: 'timeline'\n};\n\nconst createEmptyMilestoneDragState = () => ({\n  fieldId: null,\n  sourceIndex: null,\n  targetIndex: null\n});\n\nconst ensureStringArrayUniqueness = (values) => {\n  const seen = new Set();\n  return values.filter(value => {\n    if (seen.has(value)) {\n      return false;\n    }\n    seen.add(value);\n    return true;\n  });\n};\n\nconst normalizeMultiChoiceValue = (rawValue) => {\n  const normalizeEntry = (entry) => {\n    if (entry === null || entry === undefined) {\n      return '';\n    }\n\n    if (typeof entry === 'string') {\n      return entry.trim();\n    }\n\n    return String(entry).trim();\n  };\n\n  if (Array.isArray(rawValue)) {\n    const normalized = rawValue\n      .map(normalizeEntry)\n      .filter(entry => entry.length > 0);\n\n    return ensureStringArrayUniqueness(normalized);\n  }\n\n  if (typeof rawValue === 'string') {\n    const splitValues = rawValue\n      .split(/\\r?\\n|·|•|;|,/)\n      .map(entry => entry.replace(/^[-•\\s]+/, '').trim())\n      .filter(entry => entry.length > 0);\n\n    return ensureStringArrayUniqueness(splitValues);\n  }\n\n  return [];\n};\n\nconst sanitizeMilestoneEntries = (entries) => {\n  if (!Array.isArray(entries)) {\n    return [];\n  }\n\n  return entries\n    .map(item => ({\n      date: typeof item?.date === 'string' ? item.date.trim() : '',\n      description: typeof item?.description === 'string' ? item.description.trim() : ''\n    }))\n    .filter(entry => entry.date.length > 0 || entry.description.length > 0)\n    .map(entry => ({ date: entry.date, description: entry.description }));\n};\n\nconst formatMilestoneDraftState = (entries) => {\n  if (!Array.isArray(entries)) {\n    return [];\n  }\n\n  return entries\n    .map(item => ({\n      date: typeof item?.date === 'string' ? item.date : '',\n      description: typeof item?.description === 'string' ? item.description : ''\n    }))\n    .filter(entry => entry.date.trim().length > 0 || entry.description.trim().length > 0);\n};\n\nconst formatValueForDraft = (type, rawValue) => {\n  if (rawValue === null || rawValue === undefined) {\n    return type === 'multi_choice' || type === 'milestone_list' ? [] : '';\n  }\n\n  if (type === 'multi_choice') {\n    return normalizeMultiChoiceValue(rawValue);\n  }\n\n  if (type === 'date') {\n    const parsed = rawValue instanceof Date ? rawValue : new Date(rawValue);\n    if (Number.isNaN(parsed.getTime())) {\n      return String(rawValue);\n    }\n    return parsed.toISOString().slice(0, 10);\n  }\n\n  if (type === 'milestone_list') {\n    return formatMilestoneDraftState(rawValue);\n  }\n\n  return String(rawValue);\n};\n\nconst formatValueForUpdate = (type, draftValue) => {\n  if (type === 'multi_choice') {\n    return normalizeMultiChoiceValue(draftValue);\n  }\n\n  if (type === 'date') {\n    if (typeof draftValue !== 'string') {\n      return null;\n    }\n    const trimmed = draftValue.trim();\n    return trimmed.length > 0 ? trimmed : null;\n  }\n\n  if (type === 'milestone_list') {\n    return sanitizeMilestoneEntries(draftValue);\n  }\n\n  if (typeof draftValue !== 'string') {\n    return '';\n  }\n\n  return draftValue;\n};\n\nconst areFieldValuesEqual = (type, previousValue, nextValue) => {\n  if (type === 'multi_choice') {\n    const previousArray = Array.isArray(previousValue)\n      ? previousValue\n      : normalizeMultiChoiceValue(previousValue);\n    const nextArray = Array.isArray(nextValue)\n      ? nextValue\n      : normalizeMultiChoiceValue(nextValue);\n\n    if (previousArray.length !== nextArray.length) {\n      return false;\n    }\n\n    return previousArray.every((entry, index) => entry === nextArray[index]);\n  }\n\n  if (type === 'milestone_list') {\n    const previousEntries = sanitizeMilestoneEntries(previousValue);\n    const nextEntries = sanitizeMilestoneEntries(nextValue);\n\n    if (previousEntries.length !== nextEntries.length) {\n      return false;\n    }\n\n    return previousEntries.every((entry, index) => {\n      const nextEntry = nextEntries[index];\n      if (!nextEntry) {\n        return false;\n      }\n\n      return entry.date === nextEntry.date && entry.description === nextEntry.description;\n    });\n  }\n\n  return previousValue === nextValue;\n};\n\nconst buildDraftValues = (fields, answers, fallbackProjectName) => {\n  const draft = {};\n\n  fields.forEach(field => {\n    const question = field.question;\n    const fieldType = question?.type || field.fallbackType || 'text';\n    const rawValue = getRawAnswer(answers, field.id);\n    if (rawValue === undefined || rawValue === null) {\n      draft[field.id] = fieldType === 'multi_choice' || fieldType === 'milestone_list' ? [] : '';\n    } else {\n      draft[field.id] = formatValueForDraft(fieldType, rawValue);\n    }\n  });\n\n  if (typeof fallbackProjectName === 'string' && fallbackProjectName.trim().length > 0) {\n    if (!hasText(draft.projectName)) {\n      draft.projectName = fallbackProjectName.trim();\n    }\n  }\n\n  return draft;\n};\n\nconst parseListAnswer = (value) => {\n  if (!value) {\n    return [];\n  }\n\n  if (Array.isArray(value)) {\n    return value.filter(item => hasText(String(item)));\n  }\n\n  const normalized = String(value)\n    .split(/\\r?\\n|·|•|;|,/)\n    .map(entry => entry.replace(/^[-•\\s]+/, '').trim())\n    .filter(entry => entry.length > 0);\n\n  return normalized;\n};\n\nconst formatDate = (value) => {\n  if (!value) {\n    return '';\n  }\n\n  const parsed = value instanceof Date ? value : new Date(value);\n  if (Number.isNaN(parsed.getTime())) {\n    return '';\n  }\n\n  return new Intl.DateTimeFormat('fr-FR', {\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric'\n  }).format(parsed);\n};\n\nconst formatMilestoneDisplayDate = (value) => {\n  if (typeof value !== 'string' || value.trim().length === 0) {\n    return '';\n  }\n\n  const formatted = formatDate(value);\n  if (formatted && formatted.length > 0) {\n    return formatted;\n  }\n\n  return value.trim();\n};\n\nconst buildManualMilestones = (entries) => {\n  const sanitized = sanitizeMilestoneEntries(entries);\n\n  return sanitized.map((entry, index) => {\n    const formattedDate = formatMilestoneDisplayDate(entry.date);\n\n    return {\n      id: `manual-milestone-${index}`,\n      date: entry.date,\n      formattedDate,\n      description: entry.description\n    };\n  });\n};\n\nconst MS_IN_DAY = 24 * 60 * 60 * 1000;\n\nconst computeRunway = (answers) => {\n  const launchRaw = answers?.launchDate;\n\n  if (!launchRaw) {\n    return null;\n  }\n\n  const launchDate = new Date(launchRaw);\n\n  if (Number.isNaN(launchDate.getTime())) {\n    return null;\n  }\n\n  const today = new Date();\n  const todayNormalized = new Date(today.getFullYear(), today.getMonth(), today.getDate());\n  const launchNormalized = new Date(\n    launchDate.getFullYear(),\n    launchDate.getMonth(),\n    launchDate.getDate()\n  );\n\n  const diffMs = launchNormalized.getTime() - todayNormalized.getTime();\n  const diffInDays = Math.max(0, Math.round(diffMs / MS_IN_DAY));\n  const diffInWeeks = diffInDays / 7;\n\n  return {\n    launchDate: launchNormalized,\n    diffDays: diffInDays,\n    diffWeeks: diffInWeeks,\n    weeks: diffInWeeks,\n    days: diffInDays,\n    isToday: diffMs === 0,\n    isOverdue: diffMs < 0,\n    launchLabel: formatDate(launchNormalized),\n    weeksLabel: `${Math.round(diffInWeeks)} sem.`,\n    daysLabel: `${diffInDays} j.`\n  };\n};\n\nconst formatCountdownUnit = (value, unit) => {\n  if (typeof value !== 'number' || Number.isNaN(value)) {\n    return `0 ${unit}`;\n  }\n\n  const rounded = Math.max(0, Math.round(value));\n  return `${rounded} ${unit}`;\n};\n\nconst useAnimatedCounter = (targetValue, options = {}) => {\n  const { duration = 1000 } = options;\n  const [displayValue, setDisplayValue] = useState(0);\n  const frameRef = useRef(null);\n  const previousTargetRef = useRef(null);\n\n  useEffect(() => {\n    if (frameRef.current) {\n      cancelAnimationFrame(frameRef.current);\n      frameRef.current = null;\n    }\n\n    if (typeof targetValue !== 'number' || Number.isNaN(targetValue)) {\n      previousTargetRef.current = null;\n      setDisplayValue(0);\n      return undefined;\n    }\n\n    const clampedTarget = Math.max(0, targetValue);\n\n    if (duration <= 0) {\n      setDisplayValue(clampedTarget);\n      previousTargetRef.current = clampedTarget;\n      return undefined;\n    }\n\n    if (previousTargetRef.current === clampedTarget) {\n      setDisplayValue(clampedTarget);\n      return undefined;\n    }\n\n    previousTargetRef.current = clampedTarget;\n    let start = null;\n\n    const step = (timestamp) => {\n      if (start === null) {\n        start = timestamp;\n      }\n\n      const progress = Math.min((timestamp - start) / duration, 1);\n      const easedProgress = 1 - Math.pow(1 - progress, 3);\n      const nextValue = clampedTarget * easedProgress;\n      setDisplayValue(nextValue);\n\n      if (progress < 1) {\n        frameRef.current = requestAnimationFrame(step);\n      }\n    };\n\n    frameRef.current = requestAnimationFrame(step);\n\n    return () => {\n      if (frameRef.current) {\n        cancelAnimationFrame(frameRef.current);\n        frameRef.current = null;\n      }\n    };\n  }, [targetValue, duration]);\n\n  return displayValue;\n};\n\nconst computeTimelineSummaries = (timelineDetails) => {\n  if (!Array.isArray(timelineDetails)) {\n    return [];\n  }\n\n  return timelineDetails\n    .filter(detail => Boolean(detail?.diff) && detail?.satisfied === false)\n    .map((detail, index) => {\n      const diff = detail.diff;\n      const weeks = Number.isFinite(diff?.diffInWeeks)\n        ? Math.round(diff.diffInWeeks)\n        : 0;\n      const days = Number.isFinite(diff?.diffInDays)\n        ? Math.round(diff.diffInDays)\n        : 0;\n      const riskLabel = typeof detail?.riskDescription === 'string'\n        ? detail.riskDescription.trim()\n        : '';\n      const summaryLabel = riskLabel.length > 0 ? riskLabel : detail?.ruleName;\n      const hasProfiles = Array.isArray(detail?.profiles) && detail.profiles.length > 0;\n      const source = typeof detail?.source === 'string' ? detail.source : null;\n      const ruleId = detail?.ruleId != null\n        ? (() => {\n            const value = String(detail.ruleId).trim();\n            return value.length > 0 ? value : null;\n          })()\n        : null;\n      const riskId = detail?.riskId != null\n        ? (() => {\n            const value = String(detail.riskId).trim();\n            return value.length > 0 ? value : null;\n          })()\n        : null;\n      const ruleLabel = typeof detail?.ruleName === 'string'\n        ? detail.ruleName.trim()\n        : '';\n      const identifier = detail?.id\n        || `${ruleId || ruleLabel || 'rule'}-${riskId || source || index}`;\n\n      return {\n        id: identifier,\n        ruleId,\n        ruleName: summaryLabel,\n        ruleLabel,\n        riskId,\n        riskDescription: riskLabel,\n        satisfied: detail?.satisfied ?? false,\n        weeks,\n        days,\n        hasProfiles,\n        source\n      };\n    });\n};\n\nconst extractTimelineProfiles = (timelineDetails) => {\n  if (!Array.isArray(timelineDetails)) {\n    return [];\n  }\n\n  const detailWithProfiles = timelineDetails.find(\n    (detail) => Array.isArray(detail?.profiles) && detail.profiles.length > 0\n  );\n\n  if (!detailWithProfiles) {\n    return [];\n  }\n\n  return detailWithProfiles.profiles\n    .map((profile) => ({\n      id: profile?.id ?? null,\n      label: typeof profile?.label === 'string' ? profile.label : '',\n      description: typeof profile?.description === 'string' ? profile.description : ''\n    }))\n    .filter(profile => profile.label.length > 0 || profile.description.length > 0);\n};\n\nconst REQUIRED_SHOWCASE_QUESTION_IDS = [\n  'projectName',\n  'projectSlogan',\n  'targetAudience',\n  'problemPainPoints',\n  'solutionDescription',\n  'solutionBenefits',\n  'solutionComparison',\n  'innovationProcess',\n  'visionStatement',\n  'BUDGET',\n  'teamLead',\n  'teamLeadTeam',\n  'teamCoreMembers',\n  'campaignKickoffDate',\n  'launchDate',\n  'roadmapMilestones'\n];\n\nconst buildHeroHighlights = ({ targetAudience, runway }) => {\n  const highlights = [];\n\n  if (hasText(targetAudience)) {\n    highlights.push({\n      id: 'audience',\n      label: 'Audience cible',\n      value: targetAudience,\n      caption: ''\n    });\n  }\n\n  if (runway) {\n    highlights.push({\n      id: 'runway',\n      label: 'Compte à rebours avant lancement',\n      value: `${runway.weeksLabel} (${runway.daysLabel})`,\n      caption: runway.isOverdue\n        ? `Lancement prévu le ${runway.launchLabel} (échéance atteinte).`\n        : runway.isToday\n          ? `Lancement prévu aujourd'hui (${runway.launchLabel}).`\n          : `Lancement prévu le ${runway.launchLabel}.`\n    });\n  }\n\n  return highlights;\n};\n\nexport const ProjectShowcase = ({\n  projectName,\n  onClose,\n  analysis,\n  relevantTeams,\n  questions,\n  answers,\n  timelineDetails,\n  renderInStandalone = false,\n  onUpdateAnswers,\n  tourContext = null,\n  showcaseThemes = initialShowcaseThemes,\n  hasIncompleteAnswers = false,\n  onAnnotationScopeChange = null,\n  onEditingStateChange = null,\n  initialDisplayMode = 'full',\n  displayModeLock = null,\n  onDisplayModeChange = null,\n  hideEditBar = false,\n  hideNotice = false\n}) => {\n  const rawProjectName = typeof projectName === 'string' ? projectName.trim() : '';\n  const safeProjectName = rawProjectName.length > 0 ? rawProjectName : 'Information à compléter';\n  const normalizedTeams = Array.isArray(relevantTeams) ? relevantTeams : [];\n  const availableThemes = useMemo(\n    () => (Array.isArray(showcaseThemes) && showcaseThemes.length > 0\n      ? showcaseThemes\n      : initialShowcaseThemes),\n    [showcaseThemes]\n  );\n  const selectedTheme = useMemo(\n    () => resolveShowcaseTheme(availableThemes, answers?.showcaseTheme),\n    [answers?.showcaseTheme, availableThemes]\n  );\n  const showcaseThemeId = selectedTheme?.id || FALLBACK_SHOWCASE_THEME.id;\n  const isDeezerTheme = showcaseThemeId === 'deezer';\n  const showcaseThemeVariables = useMemo(\n    () => buildThemeVariables(selectedTheme || FALLBACK_SHOWCASE_THEME),\n    [selectedTheme]\n  );\n  const teamNameById = useMemo(() => {\n    const map = new Map();\n    normalizedTeams.forEach(team => {\n      if (team && team.id) {\n        map.set(team.id, team.name || team.id);\n      }\n    });\n    return map;\n  }, [normalizedTeams]);\n\n  const editableFields = useMemo(\n    () =>\n      SHOWCASE_FIELD_CONFIG.map(config => ({\n        ...config,\n        question: findQuestionById(questions, config.id)\n      })),\n    [questions]\n  );\n\n  const [isEditing, setIsEditing] = useState(false);\n  const [draftValues, setDraftValues] = useState(() =>\n    buildDraftValues(editableFields, answers, rawProjectName)\n  );\n  const [customSections, setCustomSections] = useState(() =>\n    sanitizeCustomSections(answers?.customShowcaseSections)\n  );\n  const [sectionOrder, setSectionOrder] = useState(() =>\n    normalizeSectionOrder(answers?.showcaseSectionOrder, sanitizeCustomSections(answers?.customShowcaseSections))\n  );\n  const [milestoneDragState, setMilestoneDragState] = useState(createEmptyMilestoneDragState);\n  const resolvedDisplayModeLock =\n    displayModeLock === 'light' || displayModeLock === 'full' ? displayModeLock : null;\n  const resolvedInitialDisplayMode = initialDisplayMode === 'light' ? 'light' : 'full';\n  const [displayMode, setDisplayMode] = useState(resolvedDisplayModeLock || resolvedInitialDisplayMode);\n  const [lightSections, setLightSections] = useState(() =>\n    buildDefaultLightSectionSelection(sectionOrder)\n  );\n  const [pendingLightSections, setPendingLightSections] = useState(lightSections);\n  const [isLightConfigOpen, setIsLightConfigOpen] = useState(false);\n  const [sectionDragState, setSectionDragState] = useState({ sourceIndex: null, targetIndex: null });\n  const [isSectionModalOpen, setIsSectionModalOpen] = useState(false);\n  const [sectionModalStep, setSectionModalStep] = useState('templates');\n  const [selectedTemplateIndex, setSelectedTemplateIndex] = useState(0);\n  const [pendingInsertionIndex, setPendingInsertionIndex] = useState(null);\n  const [isSharePointWarningOpen, setIsSharePointWarningOpen] = useState(false);\n  const [sharePointWarningUrl, setSharePointWarningUrl] = useState('');\n  const [sectionDraft, setSectionDraft] = useState({\n    title: '',\n    subtitle: '',\n    description: '',\n    accent: '',\n    documentUrl: '',\n    documentType: 'pdf',\n    items: [],\n    columnCount: 1,\n    columns: ['']\n  });\n  const [sectionDraftItemsText, setSectionDraftItemsText] = useState('');\n\n  const resetMilestoneDragState = useCallback(() => {\n    setMilestoneDragState(createEmptyMilestoneDragState());\n  }, []);\n\n  const handleSharePointWarning = useCallback((nextValue) => {\n    if (!isSharePointUrl(nextValue)) {\n      return;\n    }\n\n    if (nextValue === sharePointWarningUrl) {\n      return;\n    }\n\n    setSharePointWarningUrl(nextValue);\n    setIsSharePointWarningOpen(true);\n  }, [sharePointWarningUrl]);\n\n  const handleCloseSharePointWarning = useCallback(() => {\n    setIsSharePointWarningOpen(false);\n  }, []);\n\n  useEffect(() => {\n    if (isEditing) {\n      return;\n    }\n    setDraftValues(buildDraftValues(editableFields, answers, rawProjectName));\n    const sanitizedSections = sanitizeCustomSections(answers?.customShowcaseSections);\n    setCustomSections(sanitizedSections);\n    setSectionOrder(normalizeSectionOrder(answers?.showcaseSectionOrder, sanitizedSections));\n  }, [answers, editableFields, rawProjectName]);\n\n  useEffect(() => {\n    if (!isEditing) {\n      resetMilestoneDragState();\n    }\n  }, [isEditing, resetMilestoneDragState]);\n\n  useEffect(() => {\n    setLightSections(previous => {\n      const nextState = { ...previous };\n      let changed = false;\n\n      sectionOrder.forEach(id => {\n        if (nextState[id] === undefined) {\n          nextState[id] = true;\n          changed = true;\n        }\n      });\n\n      Object.keys(nextState).forEach(id => {\n        if (!sectionOrder.includes(id)) {\n          delete nextState[id];\n          changed = true;\n        }\n      });\n\n      return changed ? nextState : previous;\n    });\n  }, [sectionOrder]);\n\n  useEffect(() => {\n    if (typeof onAnnotationScopeChange !== 'function') {\n      return undefined;\n    }\n\n    const scope = isSectionModalOpen\n      ? `section-modal-${sectionModalStep}`\n      : isLightConfigOpen\n        ? 'light-config'\n        : `display-${displayMode}`;\n\n    onAnnotationScopeChange(scope);\n\n    return () => {\n      onAnnotationScopeChange('');\n    };\n  }, [displayMode, isLightConfigOpen, isSectionModalOpen, onAnnotationScopeChange, sectionModalStep]);\n\n  const handleDisplayModeChange = useCallback((mode) => {\n    if (resolvedDisplayModeLock) {\n      return;\n    }\n\n    if (mode === 'full' || mode === 'light') {\n      setDisplayMode(mode);\n    }\n  }, [resolvedDisplayModeLock]);\n\n  useEffect(() => {\n    if (resolvedDisplayModeLock) {\n      setDisplayMode(resolvedDisplayModeLock);\n      setIsLightConfigOpen(false);\n      return;\n    }\n\n    if (initialDisplayMode === 'light' || initialDisplayMode === 'full') {\n      setDisplayMode(initialDisplayMode);\n    }\n  }, [initialDisplayMode, resolvedDisplayModeLock]);\n\n  useEffect(() => {\n    if (typeof onDisplayModeChange === 'function') {\n      onDisplayModeChange(displayMode);\n    }\n  }, [displayMode, onDisplayModeChange]);\n\n  const handleOpenLightConfig = useCallback(() => {\n    setPendingLightSections(lightSections);\n    setIsLightConfigOpen(true);\n  }, [lightSections]);\n\n  const handleCancelLightConfig = useCallback(() => {\n    setPendingLightSections(lightSections);\n    setIsLightConfigOpen(false);\n  }, [lightSections]);\n\n  const handleTogglePendingSection = useCallback((sectionId) => {\n    setPendingLightSections(prev => ({\n      ...prev,\n      [sectionId]: !prev[sectionId]\n    }));\n  }, []);\n\n  const handleSelectAllSections = useCallback(() => {\n    setPendingLightSections(buildDefaultLightSectionSelection());\n  }, []);\n\n  const handleValidateLightConfig = useCallback(() => {\n    setLightSections(pendingLightSections);\n    setIsLightConfigOpen(false);\n  }, [pendingLightSections]);\n\n  const sanitizedCustomSections = useMemo(\n    () => sanitizeCustomSections(customSections),\n    [customSections]\n  );\n\n  const customSectionMap = useMemo(() => {\n    const map = new Map();\n    sanitizedCustomSections.forEach(section => {\n      map.set(section.id, section);\n    });\n    return map;\n  }, [sanitizedCustomSections]);\n\n  const customSectionFormMap = useMemo(() => {\n    const map = new Map();\n    customSections.forEach(section => {\n      if (section?.id) {\n        map.set(section.id, section);\n      }\n    });\n    return map;\n  }, [customSections]);\n\n  const sectionFieldsById = useMemo(() => {\n    return editableFields.reduce((acc, field) => {\n      const sectionId = FIELD_SECTION_MAP[field.id];\n      if (!sectionId) {\n        return acc;\n      }\n\n      if (!acc[sectionId]) {\n        acc[sectionId] = [];\n      }\n\n      acc[sectionId].push(field);\n      return acc;\n    }, {});\n  }, [editableFields]);\n\n  const editFormBlocks = useMemo(() => {\n    const blocks = [];\n\n    sectionOrder.forEach(sectionId => {\n      const customSection = customSectionFormMap.get(sectionId);\n      if (customSection) {\n        blocks.push({ type: 'custom', section: customSection });\n        return;\n      }\n\n      const sectionFields = sectionFieldsById[sectionId] || [];\n      sectionFields.forEach(field => blocks.push({ type: 'field', field }));\n    });\n\n    return blocks;\n  }, [customSectionFormMap, sectionFieldsById, sectionOrder]);\n\n  const handleOpenSectionModal = useCallback((insertionIndex = null) => {\n    setPendingInsertionIndex(insertionIndex);\n    setSectionModalStep('templates');\n    setSectionDraft({\n      title: '',\n      subtitle: '',\n      description: '',\n      accent: '',\n      documentUrl: '',\n      documentType: 'pdf',\n      items: [],\n      columnCount: 1,\n      columns: ['']\n    });\n    setSectionDraftItemsText('');\n    setIsSectionModalOpen(true);\n  }, []);\n\n  const handleCloseSectionModal = useCallback(() => {\n    setIsSectionModalOpen(false);\n    setSectionModalStep('templates');\n    setPendingInsertionIndex(null);\n    setSectionDraft({\n      title: '',\n      subtitle: '',\n      description: '',\n      accent: '',\n      documentUrl: '',\n      documentType: 'pdf',\n      items: [],\n      columnCount: 1,\n      columns: ['']\n    });\n    setSectionDraftItemsText('');\n  }, []);\n\n  useEffect(() => {\n    if (typeof onEditingStateChange === 'function') {\n      onEditingStateChange(isEditing);\n    }\n\n    return () => {\n      if (typeof onEditingStateChange === 'function') {\n        onEditingStateChange(false);\n      }\n    };\n  }, [isEditing, onEditingStateChange]);\n\n  const handleTemplateNavigation = useCallback((direction) => {\n    setSelectedTemplateIndex(previous => {\n      const nextIndex = (previous + direction + SECTION_TEMPLATES.length) % SECTION_TEMPLATES.length;\n      return nextIndex;\n    });\n  }, []);\n\n  const handleConfirmTemplateChoice = useCallback(() => {\n    const template = SECTION_TEMPLATES[selectedTemplateIndex];\n    const placeholder = template?.placeholder || {};\n    const columnCount = resolveCustomSectionColumnCount(placeholder.columnCount, placeholder.columns);\n    const columns = normalizeCustomSectionColumns(placeholder.columns, columnCount);\n    setSectionDraft({\n      title: placeholder.title || '',\n      subtitle: placeholder.subtitle || '',\n      description: placeholder.description || '',\n      accent: placeholder.accent || '',\n      documentUrl: placeholder.documentUrl || '',\n      documentType: placeholder.documentType || 'pdf',\n      items: Array.isArray(placeholder.items) ? placeholder.items : [],\n      columnCount,\n      columns\n    });\n    setSectionDraftItemsText(Array.isArray(placeholder.items) ? placeholder.items.join('\\n') : '');\n    setSectionModalStep('form');\n  }, [selectedTemplateIndex]);\n\n  const handleSectionDraftChange = useCallback((field, value) => {\n    setSectionDraft(previous => ({\n      ...previous,\n      [field]: value\n    }));\n  }, []);\n\n  const handleSectionDraftColumnCountChange = useCallback((value) => {\n    const nextCount = resolveCustomSectionColumnCount(value);\n    setSectionDraft(previous => ({\n      ...previous,\n      columnCount: nextCount,\n      columns: normalizeCustomSectionColumns(previous.columns, nextCount)\n    }));\n  }, []);\n\n  const handleSectionDraftColumnChange = useCallback((index, value) => {\n    setSectionDraft(previous => {\n      const currentCount = resolveCustomSectionColumnCount(previous.columnCount, previous.columns);\n      const columns = normalizeCustomSectionColumns(previous.columns, currentCount);\n      columns[index] = value;\n      return {\n        ...previous,\n        columns\n      };\n    });\n  }, []);\n\n  const handleSectionDraftItemsChange = useCallback((value) => {\n    setSectionDraftItemsText(value);\n    const items = value\n      .split(/\\r?\\n/)\n      .map(entry => entry.trim())\n      .filter(Boolean);\n    setSectionDraft(previous => ({\n      ...previous,\n      items\n    }));\n  }, []);\n\n  const handleSubmitNewSection = useCallback((event) => {\n    event.preventDefault();\n    const template = SECTION_TEMPLATES[selectedTemplateIndex];\n    const safeTemplateId = template?.id || SECTION_TEMPLATES[0].id;\n    const newSectionId = `custom-section-${Date.now()}`;\n\n    const newSection = {\n      id: newSectionId,\n      type: safeTemplateId,\n      title: sectionDraft.title?.trim() || template?.name || 'Nouvelle section',\n      subtitle: sectionDraft.subtitle?.trim() || '',\n      description: sectionDraft.description?.trim() || '',\n      accent: sectionDraft.accent?.trim() || '',\n      documentUrl: sectionDraft.documentUrl?.trim() || '',\n      documentType: sectionDraft.documentType?.trim() || '',\n      items: Array.isArray(sectionDraft.items) ? sectionDraft.items : [],\n      columnCount: resolveCustomSectionColumnCount(sectionDraft.columnCount, sectionDraft.columns),\n      columns: normalizeCustomSectionColumns(\n        sectionDraft.columns,\n        resolveCustomSectionColumnCount(sectionDraft.columnCount, sectionDraft.columns)\n      )\n    };\n\n    setCustomSections(previous => [...sanitizeCustomSections(previous), newSection]);\n    setSectionOrder(previousOrder => {\n      const base = Array.isArray(previousOrder) ? [...previousOrder] : [];\n      const insertionIndex = typeof pendingInsertionIndex === 'number'\n        ? Math.max(0, Math.min(base.length, pendingInsertionIndex))\n        : base.length;\n      base.splice(insertionIndex, 0, newSectionId);\n      return normalizeSectionOrder(base, [...sanitizeCustomSections(customSections), newSection]);\n    });\n    handleCloseSectionModal();\n  }, [customSections, handleCloseSectionModal, pendingInsertionIndex, sectionDraft, selectedTemplateIndex]);\n\n  const handleBackToTemplates = useCallback(() => {\n    setSectionModalStep('templates');\n  }, []);\n\n  useEffect(() => {\n    if (!tourContext?.isActive) {\n      return;\n    }\n\n    const { activeStep } = tourContext;\n    const shouldForceEditing = activeStep === 'showcase-edit' || activeStep === 'showcase-save-edits';\n\n    if (shouldForceEditing) {\n      setDraftValues(buildDraftValues(editableFields, answers, rawProjectName));\n      resetMilestoneDragState();\n      setIsEditing(true);\n    } else if (isEditing && activeStep !== 'showcase-edit' && activeStep !== 'showcase-save-edits') {\n      setIsEditing(false);\n    }\n\n    if (typeof document === 'undefined') {\n      return;\n    }\n\n    let selector = null;\n    let scrollOptions = { behavior: 'smooth', block: 'center' };\n\n    if (activeStep === 'showcase-top') {\n      selector = '[data-tour-id=\"showcase-preview\"]';\n      scrollOptions = { behavior: 'smooth', block: 'start' };\n    } else if (activeStep === 'showcase-bottom') {\n      selector = '[data-tour-id=\"showcase-preview-bottom\"]';\n      scrollOptions = { behavior: 'smooth', block: 'end' };\n    } else if (activeStep === 'showcase-edit-trigger') {\n      selector = '[data-tour-id=\"showcase-edit-trigger\"]';\n    } else if (activeStep === 'showcase-edit' || activeStep === 'showcase-save-edits') {\n      selector = '[data-tour-id=\"showcase-edit-panel\"]';\n    }\n\n    if (selector) {\n      let element = document.querySelector(selector);\n      if (!element && activeStep === 'showcase-bottom') {\n        element = document.querySelector('[data-tour-id=\"showcase-preview\"]');\n        scrollOptions = { behavior: 'smooth', block: 'end' };\n      }\n      if (element && typeof element.scrollIntoView === 'function') {\n        element.scrollIntoView(scrollOptions);\n      }\n    }\n  }, [\n    tourContext,\n    editableFields,\n    buildDraftValues,\n    answers,\n    rawProjectName,\n    resetMilestoneDragState,\n    isEditing,\n    setDraftValues\n  ]);\n\n  const isLightMode = displayMode === 'light';\n\n  const shouldDisplaySection = useCallback(\n    (sectionId) => displayMode === 'full' || lightSections[sectionId] !== false,\n    [displayMode, lightSections]\n  );\n\n  const selectedLightSectionsCount = useMemo(\n    () => Object.values(lightSections).filter(Boolean).length,\n    [lightSections]\n  );\n\n  const canEdit = typeof onUpdateAnswers === 'function' && !hideEditBar;\n  const shouldShowPreview = !isEditing || !canEdit;\n  const formId = 'project-showcase-edit-form';\n\n  const handleStartEditing = useCallback(() => {\n    setDraftValues(buildDraftValues(editableFields, answers, rawProjectName));\n    resetMilestoneDragState();\n    setIsEditing(true);\n  }, [answers, editableFields, rawProjectName, resetMilestoneDragState]);\n\n  const handleCancelEditing = useCallback(() => {\n    setDraftValues(buildDraftValues(editableFields, answers, rawProjectName));\n    setIsEditing(false);\n    const sanitizedSections = sanitizeCustomSections(answers?.customShowcaseSections);\n    setCustomSections(sanitizedSections);\n    setSectionOrder(normalizeSectionOrder(answers?.showcaseSectionOrder, sanitizedSections));\n  }, [answers, editableFields, rawProjectName]);\n\n  const handleFieldChange = useCallback((fieldId, valueOrUpdater) => {\n    setDraftValues(prev => {\n      const nextValue =\n        typeof valueOrUpdater === 'function'\n          ? valueOrUpdater(prev[fieldId], prev)\n          : valueOrUpdater;\n\n      if (prev[fieldId] === nextValue) {\n        return prev;\n      }\n\n      return {\n        ...prev,\n        [fieldId]: nextValue\n      };\n    });\n  }, []);\n\n  const handleCustomSectionFieldChange = useCallback((sectionId, field, value) => {\n    setCustomSections(prev =>\n      prev.map(section => {\n        if (!section || section.id !== sectionId) {\n          return section;\n        }\n\n        return {\n          ...section,\n          [field]: value\n        };\n      })\n    );\n  }, []);\n\n  const handleCustomSectionColumnCountChange = useCallback((sectionId, value) => {\n    const nextCount = resolveCustomSectionColumnCount(value);\n    setCustomSections(prev =>\n      prev.map(section => {\n        if (!section || section.id !== sectionId) {\n          return section;\n        }\n\n        const columns = normalizeCustomSectionColumns(section.columns, nextCount);\n\n        return {\n          ...section,\n          columnCount: nextCount,\n          columns\n        };\n      })\n    );\n  }, []);\n\n  const handleCustomSectionColumnChange = useCallback((sectionId, index, value) => {\n    setCustomSections(prev =>\n      prev.map(section => {\n        if (!section || section.id !== sectionId) {\n          return section;\n        }\n\n        const columnCount = resolveCustomSectionColumnCount(section.columnCount, section.columns);\n        const columns = normalizeCustomSectionColumns(section.columns, columnCount);\n        columns[index] = value;\n\n        return {\n          ...section,\n          columns\n        };\n      })\n    );\n  }, []);\n\n  const handleCustomSectionItemsChange = useCallback((sectionId, value) => {\n    const items = value\n      .split(/\\r?\\n/)\n      .map(entry => entry.trim())\n      .filter(Boolean);\n\n    setCustomSections(prev =>\n      prev.map(section => {\n        if (!section || section.id !== sectionId) {\n          return section;\n        }\n\n        return {\n          ...section,\n          items\n        };\n      })\n    );\n  }, []);\n\n  const handleRemoveCustomSection = useCallback((sectionId) => {\n    setCustomSections(previous => previous.filter(section => section.id !== sectionId));\n    setSectionOrder(previous => previous.filter(entry => entry !== sectionId));\n  }, []);\n\n  const handleSectionDragStart = useCallback((index, event) => {\n    if (event?.dataTransfer) {\n      event.dataTransfer.effectAllowed = 'move';\n      try {\n        event.dataTransfer.setData('text/plain', String(index));\n      } catch (_error) {\n        // Certains navigateurs bloquent l'écriture : on ignore.\n      }\n    }\n    setSectionDragState({ sourceIndex: index, targetIndex: index });\n  }, []);\n\n  const handleSectionDragEnter = useCallback((index) => {\n    setSectionDragState(previous => {\n      if (previous.sourceIndex === null || previous.targetIndex === index) {\n        return previous;\n      }\n      return { ...previous, targetIndex: index };\n    });\n  }, []);\n\n  const handleSectionDragLeave = useCallback((index, event) => {\n    if (event?.currentTarget?.contains(event?.relatedTarget)) {\n      return;\n    }\n    setSectionDragState(previous => {\n      if (previous.targetIndex !== index) {\n        return previous;\n      }\n      return { ...previous, targetIndex: previous.sourceIndex };\n    });\n  }, []);\n\n  const handleSectionDragOver = useCallback((event) => {\n    if (sectionDragState.sourceIndex !== null) {\n      event.preventDefault();\n      if (event?.dataTransfer) {\n        event.dataTransfer.dropEffect = 'move';\n      }\n    }\n  }, [sectionDragState.sourceIndex]);\n\n  const handleSectionDrop = useCallback((index, event) => {\n    if (sectionDragState.sourceIndex === null) {\n      return;\n    }\n    event.preventDefault();\n    const sourceIndex = Math.max(0, Math.min(sectionOrder.length - 1, sectionDragState.sourceIndex));\n    const targetIndex = Math.max(0, Math.min(sectionOrder.length - 1, index));\n\n    if (sourceIndex === targetIndex) {\n      setSectionDragState({ sourceIndex: null, targetIndex: null });\n      return;\n    }\n\n    setSectionOrder(previous => {\n      const next = [...previous];\n      const [removed] = next.splice(sourceIndex, 1);\n      next.splice(targetIndex, 0, removed);\n      return next;\n    });\n    setSectionDragState({ sourceIndex: null, targetIndex: null });\n  }, [sectionDragState.sourceIndex, sectionOrder.length]);\n\n  const handleSubmitEdit = useCallback(\n    (event) => {\n      event.preventDefault();\n      if (!canEdit) {\n        setIsEditing(false);\n        return;\n      }\n\n      const updates = {};\n\n      editableFields.forEach(field => {\n        const { id } = field;\n        if (!id) {\n          return;\n        }\n\n        const type = field.question?.type || field.fallbackType || 'text';\n        const rawPreviousValue = getRawAnswer(answers, id);\n        const previousValue =\n          rawPreviousValue === undefined || rawPreviousValue === null\n            ? (type === 'multi_choice' || type === 'milestone_list' ? [] : '')\n            : formatValueForDraft(type, rawPreviousValue);\n        const nextValue =\n          draftValues[id] !== undefined\n            ? draftValues[id]\n            : (type === 'multi_choice' || type === 'milestone_list' ? [] : '');\n\n        if (areFieldValuesEqual(type, previousValue, nextValue)) {\n          return;\n        }\n\n        updates[id] = formatValueForUpdate(type, nextValue);\n      });\n\n      const previousCustomSections = sanitizeCustomSections(answers?.customShowcaseSections);\n      const nextCustomSections = sanitizeCustomSections(customSections);\n      const previousSectionOrder = normalizeSectionOrder(answers?.showcaseSectionOrder, previousCustomSections);\n      const nextSectionOrder = normalizeSectionOrder(sectionOrder, nextCustomSections);\n\n      if (!areCustomSectionsEqual(previousCustomSections, nextCustomSections)) {\n        updates.customShowcaseSections = nextCustomSections;\n      }\n\n      if (!areCustomSectionsEqual(\n        previousSectionOrder.map(id => ({ id })),\n        nextSectionOrder.map(id => ({ id }))\n      )) {\n        updates.showcaseSectionOrder = nextSectionOrder;\n      }\n\n      if (Object.keys(updates).length > 0) {\n        onUpdateAnswers(updates);\n      }\n\n      setIsEditing(false);\n    },\n    [answers, canEdit, customSections, draftValues, editableFields, onUpdateAnswers, sectionOrder]\n  );\n\n  const missingShowcaseQuestions = useMemo(() => {\n    const available = new Set(Array.isArray(questions) ? questions.map(question => question?.id).filter(Boolean) : []);\n    return REQUIRED_SHOWCASE_QUESTION_IDS.filter(id => !available.has(id));\n  }, [questions]);\n\n  const slogan = getFormattedAnswer(questions, answers, 'projectSlogan');\n  const targetAudience = getFormattedAnswer(questions, answers, 'targetAudience');\n  const problemPainPoints = parseListAnswer(getRawAnswer(answers, 'problemPainPoints'));\n\n  const solutionDescription = getFormattedAnswer(questions, answers, 'solutionDescription');\n  const solutionBenefits = parseListAnswer(getRawAnswer(answers, 'solutionBenefits'));\n  const solutionComparison = getFormattedAnswer(questions, answers, 'solutionComparison');\n\n  const innovationProcess = getFormattedAnswer(questions, answers, 'innovationProcess');\n  const visionStatement = getFormattedAnswer(questions, answers, 'visionStatement');\n  const visionStatementEntries = useMemo(\n    () => parseListAnswer(getRawAnswer(answers, 'visionStatement')),\n    [answers]\n  );\n  const budgetEstimate = getFormattedAnswer(questions, answers, 'BUDGET');\n  const normalizedTimelineDetails = useMemo(() => {\n    if (Array.isArray(timelineDetails)) {\n      return timelineDetails;\n    }\n\n    const analysisDetails = analysis?.timeline?.details;\n    return Array.isArray(analysisDetails) ? analysisDetails : [];\n  }, [analysis, timelineDetails]);\n\n  const formattedBudgetEstimate = useMemo(() => {\n    if (!hasText(budgetEstimate)) {\n      return '';\n    }\n\n    const trimmed = budgetEstimate.trim();\n    if (/[€]/i.test(trimmed)) {\n      return trimmed;\n    }\n\n    return `${trimmed} K€`;\n  }, [budgetEstimate]);\n\n  const teamLead = getFormattedAnswer(questions, answers, 'teamLead');\n  const teamLeadTeam = getFormattedAnswer(questions, answers, 'teamLeadTeam');\n  const teamCoreMembers = parseListAnswer(getRawAnswer(answers, 'teamCoreMembers'));\n\n  const rawRunway = useMemo(() => computeRunway(answers), [answers]);\n  const animatedWeeks = useAnimatedCounter(rawRunway?.weeks ?? null, { duration: 1200 });\n  const animatedDays = useAnimatedCounter(rawRunway?.days ?? null, { duration: 1200 });\n  const runway = useMemo(() => {\n    if (!rawRunway) {\n      return null;\n    }\n\n    return {\n      ...rawRunway,\n      weeksLabel: formatCountdownUnit(animatedWeeks, 'sem.'),\n      daysLabel: formatCountdownUnit(animatedDays, 'j.')\n    };\n  }, [rawRunway, animatedWeeks, animatedDays]);\n  const timelineSummaries = useMemo(\n    () => computeTimelineSummaries(normalizedTimelineDetails),\n    [normalizedTimelineDetails]\n  );\n  const timelineProfiles = useMemo(\n    () => extractTimelineProfiles(normalizedTimelineDetails),\n    [normalizedTimelineDetails]\n  );\n  const vigilanceAlerts = useMemo(\n    () =>\n      buildVigilanceAlerts(\n        analysis,\n        questions,\n        (teamId) => (teamNameById.has(teamId) ? teamNameById.get(teamId) : teamId || '')\n      ),\n    [analysis, questions, teamNameById]\n  );\n  const { summaries: timelineSummariesWithAlerts, unmatchedAlerts: unmatchedVigilanceAlerts } = useMemo(\n    () => mergeTimelineSummariesWithAlerts(timelineSummaries, vigilanceAlerts),\n    [timelineSummaries, vigilanceAlerts]\n  );\n  const manualMilestones = useMemo(\n    () => buildManualMilestones(getRawAnswer(answers, 'roadmapMilestones')),\n    [answers]\n  );\n  const heroHighlights = useMemo(\n    () =>\n      buildHeroHighlights({\n        targetAudience,\n        runway\n      }),\n    [targetAudience, runway]\n  );\n\n  const teamMemberCards = useMemo(\n    () =>\n      teamCoreMembers.map((entry, index) => {\n        const raw = typeof entry === 'string' ? entry : String(entry ?? '');\n        const normalized = raw.trim();\n\n        if (normalized.length === 0) {\n          return {\n            id: `team-member-${index}`,\n            name: 'Membre clé',\n            details: null,\n            initials: '•',\n            fullText: raw\n          };\n        }\n\n        const separatorIndex = normalized.search(/[-–—:•]/);\n        const name = separatorIndex > -1 ? normalized.slice(0, separatorIndex).trim() : normalized;\n        const details = separatorIndex > -1 ? normalized.slice(separatorIndex + 1).trim() : '';\n        const initials = name\n          .split(/\\s+/)\n          .filter(Boolean)\n          .slice(0, 2)\n          .map(part => part[0]?.toUpperCase() || '')\n          .join('');\n\n        return {\n          id: `team-member-${index}`,\n          name: name || normalized,\n          details: details.length > 0 ? details : null,\n          initials: initials.length > 0 ? initials : (normalized[0]?.toUpperCase() ?? '•'),\n          fullText: normalized\n        };\n      }),\n    [teamCoreMembers]\n  );\n\n  useEffect(() => {\n    if (missingShowcaseQuestions.length === 0) {\n      return;\n    }\n\n    if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n      console.warn(\n        '[ProjectShowcase] Les questions suivantes sont absentes alors que la vitrine les attend :',\n        missingShowcaseQuestions.join(', ')\n      );\n    }\n  }, [missingShowcaseQuestions]);\n\n  useEffect(() => {\n    if (renderInStandalone || typeof document === 'undefined') {\n      return undefined;\n    }\n\n    const handleKeyDown = (event) => {\n      if (event.key === 'Escape') {\n        onClose?.();\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [onClose, renderInStandalone]);\n\n  useEffect(() => {\n    if (renderInStandalone) {\n      return;\n    }\n\n    if (typeof window !== 'undefined' && typeof window.scrollTo === 'function') {\n      window.scrollTo({ top: 0, behavior: 'smooth' });\n    }\n  }, [renderInStandalone]);\n\n\n  const hasTimelineProfiles = Array.isArray(timelineProfiles) && timelineProfiles.length > 0;\n  const hasManualMilestones = manualMilestones.length > 0;\n  const timelineProfileEntries = useMemo(() => {\n    if (!hasTimelineProfiles) {\n      return [];\n    }\n\n    return timelineProfiles.map((profile, index) => ({\n      id: profile.id || `profile-${index}`,\n      label: profile.label,\n      description: profile.description || ''\n    }));\n  }, [hasTimelineProfiles, timelineProfiles]);\n\n  const manualTimelineEntries = useMemo(\n    () =>\n      manualMilestones.map((milestone, index) => {\n        const hasDate = typeof milestone.formattedDate === 'string' && milestone.formattedDate.length > 0;\n        const hasDescription = typeof milestone.description === 'string' && milestone.description.length > 0;\n        const label = hasDate\n          ? milestone.formattedDate\n          : hasDescription\n            ? milestone.description\n            : 'Jalon à venir';\n        const description = hasDate && hasDescription ? milestone.description : '';\n\n        return {\n          id: milestone.id || `manual-milestone-${index}`,\n          label,\n          description\n        };\n      }),\n    [manualMilestones]\n  );\n\n  const timelineEntries = useMemo(\n    () => [...timelineProfileEntries, ...manualTimelineEntries],\n    [timelineProfileEntries, manualTimelineEntries]\n  );\n  const hasTimelineEntries = timelineEntries.length > 0;\n  const timelineSummariesToDisplay = useMemo(() => {\n    if (!hasTimelineProfiles) {\n      return timelineSummariesWithAlerts;\n    }\n\n    return timelineSummariesWithAlerts.filter(summary => !summary.hasProfiles);\n  }, [hasTimelineProfiles, timelineSummariesWithAlerts]);\n  const hasTimelineSummaries = timelineSummariesToDisplay.length > 0;\n  const hasVigilanceAlerts = unmatchedVigilanceAlerts.length > 0;\n  const hasTimelineSection = Boolean(\n    runway || hasTimelineSummaries || hasManualMilestones || hasTimelineProfiles || hasVigilanceAlerts\n  );\n\n  const renderDeezerSection = useCallback((sectionId, index) => {\n    if (!shouldDisplaySection(sectionId)) {\n      return null;\n    }\n\n    switch (sectionId) {\n      case 'notice':\n        if (hideNotice || !hasIncompleteAnswers) {\n          return null;\n        }\n        return (\n          <section key={`${sectionId}-${index}`} className=\"deezer-section deezer-section--notice\" data-showcase-section=\"notice\">\n            <p className=\"deezer-subtitle\">\n              En attente de l’ensemble des informations sur le projet pour une évaluation complète.\n            </p>\n          </section>\n        );\n      case 'hero':\n        return (\n          <section\n            key={`${sectionId}-${index}`}\n            className=\"deezer-section deezer-section--hero\"\n            data-showcase-section=\"hero\"\n            data-tour-id=\"showcase-hero\"\n          >\n            <div className=\"deezer-parallax\" aria-hidden=\"true\" />\n            <p className=\"deezer-eyebrow\">Now playing</p>\n            <h1 className=\"deezer-title\">{safeProjectName}</h1>\n            {hasText(slogan) && (\n              <p className=\"deezer-subtitle\">{renderTextWithLinks(slogan)}</p>\n            )}\n            <button type=\"button\" className=\"deezer-cta\">Découvrir le projet</button>\n            {heroHighlights.length > 0 && (\n              <div className=\"deezer-highlight-grid\">\n                {heroHighlights.map((highlight) => (\n                  <div key={highlight.id} className=\"deezer-highlight-card\">\n                    <p className=\"deezer-eyebrow\">{highlight.label}</p>\n                    <p className=\"deezer-title\" style={{ fontSize: '1.5rem' }}>{highlight.value}</p>\n                    <p className=\"deezer-subtitle\">{highlight.caption}</p>\n                  </div>\n                ))}\n              </div>\n            )}\n          </section>\n        );\n      case 'problem':\n        return (\n          <section key={`${sectionId}-${index}`} className=\"deezer-section\" data-showcase-section=\"problem\">\n            <p className=\"deezer-eyebrow\">Le problème</p>\n            <h2 className=\"deezer-title\" style={{ fontSize: '2rem' }}>Pourquoi ce projet doit exister</h2>\n            {problemPainPoints.length > 0 && (\n              <div className=\"deezer-grid\">\n                {problemPainPoints.map((point, pointIndex) => (\n                  <div key={`${point}-${pointIndex}`} className=\"deezer-card\">\n                    <p className=\"deezer-subtitle\">{renderTextWithLinks(point)}</p>\n                  </div>\n                ))}\n              </div>\n            )}\n          </section>\n        );\n      case 'solution':\n        return (\n          <section key={`${sectionId}-${index}`} className=\"deezer-section\" data-showcase-section=\"solution\">\n            <p className=\"deezer-eyebrow\">Notre solution</p>\n            <h2 className=\"deezer-title\" style={{ fontSize: '2rem' }}>Comment nous changeons la donne</h2>\n            <div className=\"deezer-grid\">\n              {hasText(solutionDescription) && (\n                <div className=\"deezer-card\">\n                  <h3>En clair</h3>\n                  <p className=\"deezer-subtitle\">{renderTextWithLinks(solutionDescription)}</p>\n                </div>\n              )}\n              {solutionBenefits.length > 0 && (\n                <div className=\"deezer-card\">\n                  <h3>Bénéfices clefs</h3>\n                  <ul className=\"deezer-list\">\n                    {solutionBenefits.map((benefit, benefitIndex) => (\n                      <li key={`${benefit}-${benefitIndex}`}>{renderTextWithLinks(benefit)}</li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n              {hasText(solutionComparison) && (\n                <div className=\"deezer-card\">\n                  <h3>Différenciation</h3>\n                  <p className=\"deezer-subtitle\">{renderTextWithLinks(solutionComparison)}</p>\n                </div>\n              )}\n            </div>\n          </section>\n        );\n      case 'innovation':\n        if (!hasText(innovationProcess) && !hasText(visionStatement)) {\n          return null;\n        }\n        return (\n          <section key={`${sectionId}-${index}`} className=\"deezer-section\" data-showcase-section=\"innovation\">\n            <p className=\"deezer-eyebrow\">Notre impact</p>\n            <h2 className=\"deezer-title\" style={{ fontSize: '2rem' }}>Délivrer le maximum de valeur</h2>\n            <div className=\"deezer-grid\">\n              {hasText(innovationProcess) && (\n                <div className=\"deezer-card\">\n                  <h3>Processus & expérimentation</h3>\n                  <p className=\"deezer-subtitle\">{renderTextWithLinks(innovationProcess)}</p>\n                </div>\n              )}\n              {visionStatementEntries.length > 0 && (\n                <div className=\"deezer-card\">\n                  <h3>Indicateurs de valeur</h3>\n                  <ul className=\"deezer-list\">\n                    {visionStatementEntries.map((entry, entryIndex) => (\n                      <li key={`${entry}-${entryIndex}`}>{renderTextWithLinks(entry)}</li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n              {hasText(budgetEstimate) && (\n                <div className=\"deezer-card\">\n                  <h3>Budget estimé</h3>\n                  <p className=\"deezer-title\" style={{ fontSize: '1.8rem' }}>{formattedBudgetEstimate} K€</p>\n                  <p className=\"deezer-subtitle\">Prévision globale sur 12 mois.</p>\n                </div>\n              )}\n            </div>\n          </section>\n        );\n      case 'team':\n        if (!hasText(teamLead) && !hasText(teamLeadTeam) && teamCoreMembers.length === 0) {\n          return null;\n        }\n        return (\n          <section key={`${sectionId}-${index}`} className=\"deezer-section\" data-showcase-section=\"team\">\n            <p className=\"deezer-eyebrow\">Équipe & alliances</p>\n            <h2 className=\"deezer-title\" style={{ fontSize: '2rem' }}>Qui porte et sécurise le projet</h2>\n            <div className=\"deezer-grid\">\n              {hasText(teamLead) && (\n                <div className=\"deezer-card\">\n                  <h3>Pilotage</h3>\n                  <p className=\"deezer-subtitle\">{teamLead}</p>\n                  {hasText(teamLeadTeam) && (\n                    <p className=\"deezer-subtitle\">{teamLeadTeam}</p>\n                  )}\n                </div>\n              )}\n              {teamMemberCards.map((member) => (\n                <div key={member.id} className=\"deezer-card\">\n                  <h3>{member.name}</h3>\n                  {member.details && <p className=\"deezer-subtitle\">{member.details}</p>}\n                </div>\n              ))}\n            </div>\n          </section>\n        );\n      case 'timeline':\n        if (!hasTimelineSection) {\n          return null;\n        }\n        return (\n          <section key={`${sectionId}-${index}`} className=\"deezer-section\" data-showcase-section=\"timeline\" data-tour-id=\"showcase-roadmap\">\n            <p className=\"deezer-eyebrow\">Feuille de route</p>\n            <h2 className=\"deezer-title\" style={{ fontSize: '2rem' }}>Les étapes clés pour livrer</h2>\n            {runway && (\n              <p className=\"deezer-subtitle\">\n                {runway.isOverdue ? (\n                  <>Le lancement prévu le {runway.launchLabel} a déjà eu lieu.</>\n                ) : runway.isToday ? (\n                  <>Dernière ligne droite : lancement aujourd'hui ({runway.launchLabel}).</>\n                ) : (\n                  <>Compte à rebours : {runway.weeksLabel} ({runway.daysLabel}) avant le lancement prévu le {runway.launchLabel}.</>\n                )}\n              </p>\n            )}\n            {hasTimelineSummaries && (\n              <div className=\"deezer-grid\">\n                {timelineSummariesToDisplay.map((summary, summaryIndex) => (\n                  <div key={summary.id || `timeline-summary-${summaryIndex}`} className={`deezer-card ${summary.satisfied ? '' : 'deezer-alert'}`}>\n                    {summary?.alert?.ruleName && (\n                      <p className=\"deezer-eyebrow\">{renderTextWithLinks(summary.alert.ruleName)}</p>\n                    )}\n                    {summary?.alert?.title && (\n                      <p className=\"deezer-subtitle\">{renderTextWithLinks(summary.alert.title)}</p>\n                    )}\n                    {summary.satisfied && (\n                      <p className=\"deezer-title\" style={{ fontSize: '1.4rem' }}>{summary.weeks} semaines ({summary.days} jours)</p>\n                    )}\n                    {summary.alert?.requirementSummary && (\n                      <p className=\"deezer-subtitle\">{renderTextWithLinks(summary.alert.requirementSummary)}</p>\n                    )}\n                    {summary.alert?.statusMessage && (\n                      <p className=\"deezer-subtitle\">{renderTextWithLinks(summary.alert.statusMessage)}</p>\n                    )}\n                    {summary.alert?.teamLabel && (\n                      <p className=\"deezer-subtitle\">Équipe référente : {summary.alert.teamLabel}</p>\n                    )}\n                  </div>\n                ))}\n              </div>\n            )}\n            {hasVigilanceAlerts && (\n              <div className=\"deezer-grid\">\n                {unmatchedVigilanceAlerts.map((alert) => (\n                  <div key={alert.id} className=\"deezer-card deezer-alert\">\n                    <p className=\"deezer-eyebrow\">{alert.ruleName}</p>\n                    <p className=\"deezer-subtitle\">{renderTextWithLinks(alert.title)}</p>\n                    {alert.requirementSummary && (\n                      <p className=\"deezer-subtitle\">{alert.requirementSummary}</p>\n                    )}\n                    {alert.statusMessage && (\n                      <p className=\"deezer-subtitle\">{alert.statusMessage}</p>\n                    )}\n                    {alert.teamLabel && (\n                      <p className=\"deezer-subtitle\">Équipe référente : {alert.teamLabel}</p>\n                    )}\n                  </div>\n                ))}\n              </div>\n            )}\n            {hasTimelineEntries && (\n              <div className=\"deezer-timeline\">\n                {timelineEntries.map((entry, entryIndex) => (\n                  <div key={entry.id || `timeline-entry-${entryIndex}`} className=\"deezer-timeline-item\">\n                    <span className=\"deezer-timeline-dot\" />\n                    <div>\n                      <p className=\"deezer-subtitle\">{entry.label}</p>\n                      {entry.description && (\n                        <p className=\"deezer-subtitle\">{renderTextWithLinks(entry.description)}</p>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </section>\n        );\n      default:\n        return null;\n    }\n  }, [\n    budgetEstimate,\n    formattedBudgetEstimate,\n    hasIncompleteAnswers,\n    hasText,\n    hasTimelineEntries,\n    hasTimelineSection,\n    hasTimelineSummaries,\n    heroHighlights,\n    innovationProcess,\n    problemPainPoints,\n    runway,\n    shouldDisplaySection,\n    solutionBenefits,\n    solutionComparison,\n    solutionDescription,\n    teamCoreMembers,\n    teamLead,\n    teamLeadTeam,\n    teamMemberCards,\n    timelineEntries,\n    timelineSummariesToDisplay,\n    unmatchedVigilanceAlerts,\n    visionStatement,\n    visionStatementEntries,\n    slogan,\n    safeProjectName\n  ]);\n\n  const renderBaseSection = useCallback((sectionId, index) => {\n    if (!shouldDisplaySection(sectionId)) {\n      return null;\n    }\n\n    switch (sectionId) {\n      case 'notice':\n        if (hideNotice || !hasIncompleteAnswers) {\n          return null;\n        }\n        return (\n          <section key={`${sectionId}-${index}`} className=\"aurora-section\" data-showcase-section=\"notice\">\n            <div className=\"aurora-section__inner aurora-section__inner--narrow\">\n              <div className=\"rounded-xl border border-yellow-200 bg-yellow-50 px-4 py-3 text-sm text-yellow-800\">\n                En attente de l’ensemble des informations sur le projet pour une évaluation complète.\n              </div>\n            </div>\n          </section>\n        );\n      case 'hero':\n        return (\n          <section\n            key={`${sectionId}-${index}`}\n            className=\"aurora-section aurora-hero\"\n            data-showcase-section=\"hero\"\n            data-tour-id=\"showcase-hero\"\n          >\n            <div className=\"aurora-section__inner\">\n              <div className=\"aurora-hero__copy\">\n                <h1 className=\"aurora-hero__title\">{safeProjectName}</h1>\n                {hasText(slogan) && (\n                  <p className=\"aurora-hero__subtitle\">{renderTextWithLinks(slogan)}</p>\n                )}\n                <div className=\"aurora-cta-group\">\n                  <button type=\"button\" className=\"aurora-cta\">Découvrir le projet</button>\n                </div>\n              </div>\n              {heroHighlights.length > 0 && (\n                <div className=\"aurora-hero__highlights\">\n                  {heroHighlights.map((highlight, highlightIndex) => (\n                    <div\n                      key={highlight.id}\n                      className=\"aurora-hero-highlight\"\n                      style={{ animationDelay: `${highlightIndex * 0.15}s` }}\n                    >\n                      <p className=\"aurora-hero-highlight__label\">{highlight.label}</p>\n                      <p className=\"aurora-hero-highlight__value\">{highlight.value}</p>\n                      <p className=\"aurora-hero-highlight__caption\">{highlight.caption}</p>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          </section>\n        );\n      case 'problem':\n        return (\n          <section key={`${sectionId}-${index}`} className=\"aurora-section aurora-why\" data-showcase-section=\"problem\">\n            <div className=\"aurora-section__inner aurora-section__inner--narrow\">\n              <div className=\"aurora-section__header\">\n                <p className=\"aurora-eyebrow\">Le problème</p>\n                <h2 className=\"aurora-section__title\">Pourquoi ce projet doit exister</h2>\n              </div>\n              {problemPainPoints.length > 0 && (\n                <div className=\"aurora-why__points\">\n                  {problemPainPoints.map((point, pointIndex) => (\n                    <div\n                      key={`${point}-${pointIndex}`}\n                      className=\"aurora-why__point\"\n                      style={{ animationDelay: `${pointIndex * 0.12 + 0.1}s` }}\n                    >\n                      <span className=\"aurora-why__beam\" />\n                      <span className=\"aurora-why__text\">{renderTextWithLinks(point)}</span>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          </section>\n        );\n      case 'solution':\n        return (\n          <section key={`${sectionId}-${index}`} className=\"aurora-section aurora-response\" data-showcase-section=\"solution\">\n            <div className=\"aurora-section__inner\">\n              <div className=\"aurora-section__header aurora-section__header--split\">\n                <div>\n                  <p className=\"aurora-eyebrow\">Notre solution</p>\n                  <h2 className=\"aurora-section__title\">Comment nous changeons la donne</h2>\n                </div>\n              </div>\n              <div className=\"aurora-pillars\">\n                {hasText(solutionDescription) && (\n                  <div className=\"aurora-pillar\">\n                    <h3 className=\"aurora-pillar__title\">En clair</h3>\n                    <p className=\"aurora-pillar__text\">{renderTextWithLinks(solutionDescription)}</p>\n                  </div>\n                )}\n                {solutionBenefits.length > 0 && (\n                  <div className=\"aurora-pillar\">\n                    <h3 className=\"aurora-pillar__title\">Bénéfices clefs</h3>\n                    <ul className=\"aurora-pillar__list\">\n                      {solutionBenefits.map((benefit, benefitIndex) => (\n                        <li key={`${benefit}-${benefitIndex}`} className=\"aurora-pillar__item\">\n                          <span className=\"aurora-pillar__bullet\" />\n                          <span>{renderTextWithLinks(benefit)}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n                {hasText(solutionComparison) && (\n                  <div className=\"aurora-pillar\">\n                    <h3 className=\"aurora-pillar__title\">Pourquoi c'est différent</h3>\n                    <p className=\"aurora-pillar__text\">{renderTextWithLinks(solutionComparison)}</p>\n                  </div>\n                )}\n              </div>\n            </div>\n          </section>\n        );\n      case 'innovation':\n        if (!hasText(innovationProcess) && !hasText(visionStatement)) {\n          return null;\n        }\n        return (\n          <section key={`${sectionId}-${index}`} className=\"aurora-section aurora-difference\" data-showcase-section=\"innovation\">\n            <div className=\"aurora-section__inner\">\n              <div className=\"aurora-section__header aurora-section__header--split\">\n                <div>\n                  <p className=\"aurora-eyebrow\">Notre impact</p>\n                  <h2 className=\"aurora-section__title\">Délivrer le maximum de valeur</h2>\n                </div>\n                {hasText(budgetEstimate) && (\n                  <div className=\"aurora-card aurora-card--budget\" data-tour-id=\"showcase-budget\">\n                    <p className=\"aurora-eyebrow\">Budget estimé</p>\n                    <p className=\"aurora-card__metric\">{formattedBudgetEstimate} K€</p>\n                    <p className=\"aurora-card__caption\">Prévision globale sur 12 mois.</p>\n                  </div>\n                )}\n              </div>\n              <div className=\"aurora-difference__layout\">\n                {hasText(innovationProcess) && (\n                  <div className=\"aurora-difference__text\">\n                    <div className=\"aurora-difference__text-section\">\n                      <p className=\"aurora-eyebrow\">Comment on s'y prend</p>\n                      <p className=\"aurora-difference__label\">Processus & expérimentation</p>\n                      <div className=\"aurora-difference__text-content\">\n                        {renderTextWithLinks(innovationProcess)}\n                      </div>\n                    </div>\n                  </div>\n                )}\n                {visionStatementEntries.length > 0 && (\n                  <div className=\"aurora-difference__metrics\">\n                    <p className=\"aurora-eyebrow\">Indicateurs de valeur</p>\n                    <p className=\"aurora-difference__label\">Comment nous mesurons l'impact</p>\n                    <ul className=\"aurora-difference__metrics-list\">\n                      {visionStatementEntries.map((entry, entryIndex) => (\n                        <li key={`${entry}-${entryIndex}`} className=\"aurora-difference__metrics-item\">\n                          <span className=\"aurora-difference__metrics-bullet\" />\n                          <span className=\"aurora-difference__metrics-text\">{renderTextWithLinks(entry)}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n              </div>\n            </div>\n          </section>\n        );\n      case 'team':\n        if (!hasText(teamLead) && !hasText(teamLeadTeam) && teamCoreMembers.length === 0) {\n          return null;\n        }\n        return (\n          <section key={`${sectionId}-${index}`} className=\"aurora-section aurora-team\" data-showcase-section=\"team\">\n            <div className=\"aurora-section__inner\">\n              <div className=\"aurora-section__header aurora-section__header--split\">\n                <div>\n                  <p className=\"aurora-eyebrow\">Équipe & alliances</p>\n                  <h2 className=\"aurora-section__title\">Qui porte et sécurise le projet</h2>\n                </div>\n              </div>\n              <div className=\"aurora-team__layout\">\n                {hasText(teamLead) && (\n                  <div className=\"aurora-team__lead\">\n                    <div className=\"aurora-team__lead-info\">\n                      <p className=\"aurora-team__lead-label\">Pilotage</p>\n                      <h3 className=\"aurora-team__lead-name\">{teamLead}</h3>\n                      {hasText(teamLeadTeam) && (\n                        <p className=\"aurora-team__lead-team\">{teamLeadTeam}</p>\n                      )}\n                    </div>\n                  </div>\n                )}\n                {teamMemberCards.length > 0 && (\n                  <div className=\"aurora-team__members\">\n                    <p className=\"aurora-team__members-label\">Équipe cœur</p>\n                    <div className=\"aurora-team__carousel\">\n                      {teamMemberCards.map((member, memberIndex) => (\n                        <div key={member.id ?? `${member.name}-${memberIndex}`} className=\"aurora-team__card\">\n                          <div className=\"aurora-team__avatar\" aria-hidden=\"true\">\n                            {member.initials}\n                          </div>\n                          <div className=\"aurora-team__card-text\">\n                            <p className=\"aurora-team__card-name\">{member.name}</p>\n                            {member.details && (\n                              <p className=\"aurora-team__card-role\">{member.details}</p>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n          </section>\n        );\n      case 'timeline':\n        if (!hasTimelineSection) {\n          return null;\n        }\n        return (\n          <section\n            key={`${sectionId}-${index}`}\n            className=\"aurora-section aurora-roadmap\"\n            data-showcase-section=\"timeline\"\n            data-tour-id=\"showcase-roadmap\"\n          >\n            <div className=\"aurora-section__inner\">\n              <div className=\"aurora-section__header aurora-section__header--split\">\n                <div>\n                  <p className=\"aurora-eyebrow\">Feuille de route</p>\n                  <h2 className=\"aurora-section__title\">Les étapes clés pour livrer</h2>\n                </div>\n                {hasText(runway?.launchLabel) && (\n                  <div className=\"aurora-chip aurora-chip--tone\">\n                    <span className=\"aurora-chip__dot\" />\n                    {runway.launchLabel}\n                  </div>\n                )}\n              </div>\n              {runway && (\n                <p className=\"aurora-roadmap__intro\">\n                  {runway.isOverdue ? (\n                    <>Le lancement prévu le {runway.launchLabel} a déjà eu lieu.</>\n                  ) : runway.isToday ? (\n                    <>Dernière ligne droite : lancement aujourd'hui ({runway.launchLabel}).</>\n                  ) : (\n                    <>\n                      Compte à rebours : <span>{runway.weeksLabel}</span> ({runway.daysLabel}) avant le lancement prévu le {runway.launchLabel}.\n                    </>\n                  )}\n                </p>\n              )}\n              {hasTimelineSummaries && (\n                timelineSummariesToDisplay.map((summary, summaryIndex) => {\n                  const summaryRuleLabel = summary?.alert?.ruleName || summary?.ruleName;\n                  const alertTitle = summary?.alert?.title;\n\n                  return (\n                    <div\n                      key={summary.id || `timeline-summary-${summaryIndex}`}\n                      className={`${\n                        summary.satisfied\n                          ? 'aurora-roadmap__summary aurora-roadmap__summary--ok'\n                          : 'aurora-roadmap__summary aurora-roadmap__summary--alert'\n                      }`}\n                      style={{ animationDelay: `${summaryIndex * 0.08}s` }}\n                    >\n                      {summaryRuleLabel && (\n                        <p className=\"aurora-roadmap__label\">\n                          {renderTextWithLinks(summaryRuleLabel)}\n                        </p>\n                      )}\n                      {alertTitle && (\n                        <p className=\"aurora-roadmap__summary-title\">\n                          {renderTextWithLinks(alertTitle)}\n                        </p>\n                      )}\n                      {summary.satisfied && (\n                        <>\n                          <p className=\"aurora-roadmap__value\">{summary.weeks} semaines ({summary.days} jours)</p>\n                          <p className=\"aurora-roadmap__caption\">Runway conforme aux exigences identifiées.</p>\n                        </>\n                      )}\n                      {summary.alert?.requirementSummary && (\n                        <p className=\"aurora-roadmap__summary-detail\">\n                          {renderTextWithLinks(summary.alert.requirementSummary)}\n                        </p>\n                      )}\n                      {summary.alert?.statusMessage && (\n                        <p className=\"aurora-roadmap__summary-detail aurora-roadmap__summary-detail--status\">\n                          {renderTextWithLinks(summary.alert.statusMessage)}\n                        </p>\n                      )}\n                      {summary.alert?.teamLabel && (\n                        <p className=\"aurora-roadmap__summary-team\">Équipe référente : {summary.alert.teamLabel}</p>\n                      )}\n                    </div>\n                  );\n                })\n              )}\n              {hasVigilanceAlerts && (\n                <div className=\"aurora-roadmap__watchpoints\">\n                  {unmatchedVigilanceAlerts.map((alert, alertIndex) => (\n                    <div\n                      key={alert.id}\n                      className={`aurora-roadmap__watchpoint aurora-roadmap__watchpoint--${alert.status}`}\n                      style={{ animationDelay: `${alertIndex * 0.08}s` }}\n                    >\n                      <p className=\"aurora-roadmap__watchpoint-eyebrow\">{alert.ruleName}</p>\n                      <p className=\"aurora-roadmap__watchpoint-title\">{renderTextWithLinks(alert.title)}</p>\n                      {alert.requirementSummary && (\n                        <p className=\"aurora-roadmap__watchpoint-text\">{alert.requirementSummary}</p>\n                      )}\n                      {alert.statusMessage && (\n                        <p className=\"aurora-roadmap__watchpoint-caption\">{alert.statusMessage}</p>\n                      )}\n                      {alert.teamLabel && (\n                        <p className=\"aurora-roadmap__watchpoint-team\">Équipe référente : {alert.teamLabel}</p>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              )}\n              {hasTimelineEntries && (\n                <ul className=\"aurora-roadmap__timeline\">\n                  {timelineEntries.map((entry, entryIndex) => (\n                    <li\n                      key={entry.id || `timeline-entry-${entryIndex}`}\n                      className=\"aurora-roadmap__step\"\n                      style={{ animationDelay: `${entryIndex * 0.1}s` }}\n                    >\n                      <span className=\"aurora-roadmap__node\" />\n                      <div>\n                        <p className=\"aurora-roadmap__label\">{entry.label}</p>\n                        {entry.description && (\n                          <p className=\"aurora-roadmap__caption\">{renderTextWithLinks(entry.description)}</p>\n                        )}\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              )}\n            </div>\n          </section>\n        );\n      default:\n        return null;\n    }\n  }, [\n    formattedBudgetEstimate,\n    hasIncompleteAnswers,\n    hasText,\n    hasTimelineEntries,\n    hasTimelineSection,\n    hasTimelineSummaries,\n    heroHighlights,\n    innovationProcess,\n    problemPainPoints,\n    runway,\n    shouldDisplaySection,\n    solutionBenefits,\n    solutionComparison,\n    solutionDescription,\n    teamCoreMembers,\n    teamLead,\n    teamLeadTeam,\n    timelineEntries,\n    timelineSummariesToDisplay,\n    unmatchedVigilanceAlerts,\n    visionStatement,\n    visionStatementEntries,\n    slogan,\n    safeProjectName\n  ]);\n\n  const renderCustomSection = useCallback((section, index) => {\n    if (!section) {\n      return null;\n    }\n\n    const templateConfig = resolveTemplateConfig(section.type);\n    const columnCount = resolveCustomSectionColumnCount(section.columnCount, section.columns);\n    const columns = normalizeCustomSectionColumns(section.columns, columnCount);\n    const activeColumns = columns.filter(column => column.trim().length > 0);\n\n    return (\n      <section\n        key={section.id}\n        className=\"aurora-section aurora-section--custom\"\n        data-showcase-section={section.type || 'custom'}\n      >\n        <div className=\"aurora-section__inner aurora-section__inner--narrow\">\n          <div className=\"aurora-section__header aurora-section__header--split\">\n            <div>\n              {templateConfig.showAccent && (\n                <p className=\"aurora-eyebrow\">{section.accent || 'Section additionnelle'}</p>\n              )}\n              <h2 className=\"aurora-section__title\">{section.title}</h2>\n              {templateConfig.showSubtitle && section.subtitle && (\n                <p className=\"mt-1 text-sm text-gray-600\">{renderTextWithLinks(section.subtitle)}</p>\n              )}\n            </div>\n            <div className=\"aurora-chip aurora-chip--ghost\">Bloc personnalisé #{index + 1}</div>\n          </div>\n          {templateConfig.showDescription && section.description && (\n            <p className=\"aurora-body-text\">{renderTextWithLinks(section.description)}</p>\n          )}\n          {templateConfig.showColumns && activeColumns.length > 0 && (\n            <div\n              className=\"mt-6 grid gap-4\"\n              style={{ gridTemplateColumns: `repeat(${Math.min(columnCount, activeColumns.length)}, minmax(0, 1fr))` }}\n            >\n              {activeColumns.map((column, columnIndex) => (\n                <div\n                  key={`${section.id}-column-${columnIndex}`}\n                  className=\"rounded-2xl border border-gray-100 bg-white/70 p-4 text-sm text-gray-700 shadow-sm\"\n                >\n                  <p className=\"whitespace-pre-line\">{renderTextWithLinks(column)}</p>\n                </div>\n              ))}\n            </div>\n          )}\n          {templateConfig.showDocument && section.documentUrl && (\n            <div className=\"mt-6 space-y-3 rounded-2xl border border-gray-200 bg-white p-4 shadow-sm\">\n              <div className=\"flex flex-wrap items-center justify-between gap-2\">\n                <div>\n                  <p className=\"text-sm font-semibold text-gray-800\">Visionneuse documentaire</p>\n                  <p className=\"text-xs text-gray-500\">Source SharePoint • {section.documentType?.toUpperCase() || 'DOC'}</p>\n                </div>\n                <a\n                  href={section.documentUrl}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"text-sm font-semibold text-blue-600 hover:text-blue-700\"\n                >\n                  Ouvrir dans un nouvel onglet\n                </a>\n              </div>\n              {['jpg', 'png'].includes(section.documentType) ? (\n                <img\n                  src={section.documentUrl}\n                  alt={`Document ${section.title || 'section personnalisée'}`}\n                  className=\"max-h-96 w-full rounded-xl border border-gray-100 object-contain\"\n                  loading=\"lazy\"\n                  decoding=\"async\"\n                />\n              ) : (\n                <iframe\n                  title={`Document ${section.title || 'section personnalisée'}`}\n                  src={resolveDocumentEmbedSrc(section.documentUrl, section.documentType)}\n                  className=\"h-80 w-full rounded-xl border border-gray-100\"\n                  loading=\"lazy\"\n                />\n              )}\n              <p className=\"text-xs text-gray-500\">\n                Pour les présentations PPTX, utilisez un lien SharePoint accessible ou un lien d’intégration Office.\n              </p>\n            </div>\n          )}\n          {templateConfig.showItems && Array.isArray(section.items) && section.items.length > 0 && (\n            <ul className=\"mt-4 space-y-3\">\n              {section.items.map((item, itemIndex) => (\n                <li key={`${section.id}-item-${itemIndex}`} className=\"flex items-start gap-3\">\n                  <span className=\"mt-1 inline-flex h-5 w-5 items-center justify-center rounded-full bg-gradient-to-r from-blue-500 to-teal-400 text-xs font-semibold text-white\">\n                    {itemIndex + 1}\n                  </span>\n                  <span className=\"text-base text-gray-800\">{renderTextWithLinks(item)}</span>\n                </li>\n              ))}\n            </ul>\n          )}\n        </div>\n      </section>\n    );\n  }, []);\n\n  const renderCustomSectionDeezer = useCallback((section, index) => {\n    if (!section) {\n      return null;\n    }\n\n    const templateConfig = resolveTemplateConfig(section.type);\n    const columnCount = resolveCustomSectionColumnCount(section.columnCount, section.columns);\n    const columns = normalizeCustomSectionColumns(section.columns, columnCount);\n    const activeColumns = columns.filter(column => column.trim().length > 0);\n\n    return (\n      <section\n        key={section.id}\n        className=\"deezer-section deezer-section--custom\"\n        data-showcase-section={section.type || 'custom'}\n      >\n        <p className=\"deezer-eyebrow\">{section.accent || 'Section additionnelle'}</p>\n        <h2 className=\"deezer-title\" style={{ fontSize: '2rem' }}>{section.title}</h2>\n        {templateConfig.showSubtitle && section.subtitle && (\n          <p className=\"deezer-subtitle\">{renderTextWithLinks(section.subtitle)}</p>\n        )}\n        {templateConfig.showDescription && section.description && (\n          <p className=\"deezer-subtitle\">{renderTextWithLinks(section.description)}</p>\n        )}\n        {templateConfig.showColumns && activeColumns.length > 0 && (\n          <div\n            className=\"deezer-grid\"\n            style={{ gridTemplateColumns: `repeat(${Math.min(columnCount, activeColumns.length)}, minmax(0, 1fr))` }}\n          >\n            {activeColumns.map((column, columnIndex) => (\n              <div key={`${section.id}-column-${columnIndex}`} className=\"deezer-card\">\n                <p className=\"deezer-subtitle\">{renderTextWithLinks(column)}</p>\n              </div>\n            ))}\n          </div>\n        )}\n        {templateConfig.showDocument && section.documentUrl && (\n          <div className=\"deezer-card\">\n            <div className=\"flex flex-wrap items-center justify-between gap-2\">\n              <div>\n                <p className=\"deezer-subtitle\">Visionneuse documentaire</p>\n                <p className=\"deezer-subtitle\">Source SharePoint • {section.documentType?.toUpperCase() || 'DOC'}</p>\n              </div>\n              <a\n                href={section.documentUrl}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"deezer-subtitle\"\n              >\n                Ouvrir dans un nouvel onglet\n              </a>\n            </div>\n            {['jpg', 'png'].includes(section.documentType) ? (\n              <img\n                src={section.documentUrl}\n                alt={`Document ${section.title || 'section personnalisée'}`}\n                className=\"mt-4 max-h-96 w-full rounded-xl border border-white/10 object-contain\"\n                loading=\"lazy\"\n                decoding=\"async\"\n              />\n            ) : (\n              <iframe\n                title={`Document ${section.title || 'section personnalisée'}`}\n                src={resolveDocumentEmbedSrc(section.documentUrl, section.documentType)}\n                className=\"mt-4 h-80 w-full rounded-xl border border-white/10\"\n                loading=\"lazy\"\n              />\n            )}\n          </div>\n        )}\n        {templateConfig.showItems && Array.isArray(section.items) && section.items.length > 0 && (\n          <ul className=\"deezer-list\">\n            {section.items.map((item, itemIndex) => (\n              <li key={`${section.id}-item-${itemIndex}`}>{renderTextWithLinks(item)}</li>\n            ))}\n          </ul>\n        )}\n      </section>\n    );\n  }, []);\n\n  const orderedSections = useMemo(() => {\n    const sections = [];\n    sectionOrder.forEach((sectionId, index) => {\n      if (!shouldDisplaySection(sectionId)) {\n        return;\n      }\n\n      const activeRenderCustomSection = isDeezerTheme ? renderCustomSectionDeezer : renderCustomSection;\n      if (customSectionMap.has(sectionId)) {\n        const renderedCustom = activeRenderCustomSection(customSectionMap.get(sectionId), index);\n        if (renderedCustom) {\n          sections.push(renderedCustom);\n        }\n        return;\n      }\n\n      const rendered = (isDeezerTheme ? renderDeezerSection : renderBaseSection)(sectionId, index);\n      if (rendered) {\n        sections.push(rendered);\n      }\n    });\n\n    return sections;\n  }, [\n    customSectionMap,\n    isDeezerTheme,\n    renderBaseSection,\n    renderCustomSection,\n    renderCustomSectionDeezer,\n    renderDeezerSection,\n    sectionOrder,\n    shouldDisplaySection\n  ]);\n\n  const sectionDescriptors = useMemo(() => {\n    return sectionOrder.map((sectionId) => {\n      const custom = customSectionMap.get(sectionId);\n      if (custom) {\n        return {\n          id: sectionId,\n          title: custom.title || 'Bloc personnalisé',\n          subtitle: 'Section personnalisée',\n          isCustom: true\n        };\n      }\n\n      const option = SHOWCASE_SECTION_OPTIONS.find(section => section.id === sectionId);\n      return {\n        id: sectionId,\n        title: option?.label || sectionId,\n        subtitle: 'Section standard',\n        isCustom: false\n      };\n    });\n  }, [customSectionMap, sectionOrder]);\n\n  const selectedTemplate = SECTION_TEMPLATES[selectedTemplateIndex] || SECTION_TEMPLATES[0];\n  const selectedTemplateConfig = resolveTemplateConfig(selectedTemplate?.id);\n  const templateAccentClasses = {\n    highlight: 'from-blue-500/80 via-cyan-400/70 to-emerald-300/70',\n    columns: 'from-indigo-500/80 via-purple-400/70 to-fuchsia-300/70',\n    'document-viewer': 'from-emerald-500/80 via-teal-400/70 to-sky-300/70',\n    story: 'from-amber-400/80 via-orange-300/70 to-rose-300/70',\n    checklist: 'from-lime-500/80 via-emerald-400/70 to-teal-300/70'\n  };\n  const selectedTemplateAccent =\n    templateAccentClasses[selectedTemplate?.id] || templateAccentClasses.highlight;\n\n  const renderTemplateThumbnail = (templateId) => {\n    switch (templateId) {\n      case 'columns':\n        return (\n          <div className=\"mt-4 grid grid-cols-3 gap-3 rounded-xl bg-white p-4 shadow-inner\">\n            <div className=\"col-span-3 h-3 rounded-full bg-gradient-to-r from-indigo-500/80 to-fuchsia-400/70\" />\n            {Array.from({ length: 3 }).map((_, index) => (\n              <div key={`columns-preview-${index}`} className=\"rounded-lg bg-gray-50 p-2\">\n                <div className=\"flex h-16 items-end justify-center gap-1\">\n                  <div className=\"h-10 w-2 rounded-full bg-indigo-200\" />\n                  <div className=\"h-14 w-2 rounded-full bg-purple-200\" />\n                  <div className=\"h-12 w-2 rounded-full bg-fuchsia-200\" />\n                </div>\n              </div>\n            ))}\n          </div>\n        );\n      case 'document-viewer':\n        return (\n          <div className=\"mt-4 space-y-3 rounded-xl bg-white p-4 shadow-inner\">\n            <div className=\"flex items-center justify-between gap-3\">\n              <div className=\"h-3 w-28 rounded-full bg-gray-200\" />\n              <div className=\"h-3 w-16 rounded-full bg-emerald-100\" />\n            </div>\n            <div className=\"h-2 w-40 rounded-full bg-gray-100\" />\n            <div className=\"h-28 rounded-xl border border-emerald-100 bg-gradient-to-br from-emerald-50 to-emerald-100\" />\n          </div>\n        );\n      case 'story':\n        return (\n          <div className=\"mt-4 space-y-3 rounded-xl bg-white p-4 shadow-inner\">\n            <div className=\"h-3 w-32 rounded-full bg-amber-300/80\" />\n            <div className=\"space-y-2\">\n              <div className=\"h-2 rounded-full bg-gray-100\" />\n              <div className=\"h-2 w-11/12 rounded-full bg-gray-100\" />\n              <div className=\"h-2 w-10/12 rounded-full bg-gray-100\" />\n              <div className=\"h-2 w-9/12 rounded-full bg-gray-100\" />\n            </div>\n          </div>\n        );\n      case 'checklist':\n        return (\n          <div className=\"mt-4 space-y-3 rounded-xl bg-white p-4 shadow-inner\">\n            <div className=\"h-3 w-28 rounded-full bg-lime-300/80\" />\n            <div className=\"space-y-2\">\n              {Array.from({ length: 4 }).map((_, index) => (\n                <div key={`checklist-preview-${index}`} className=\"flex items-center gap-2\">\n                  <div className=\"h-3 w-3 rounded-full bg-emerald-400/80\" />\n                  <div className=\"h-2 w-full rounded-full bg-gray-100\" />\n                </div>\n              ))}\n            </div>\n          </div>\n        );\n      case 'highlight':\n      default:\n        return (\n          <div className=\"mt-4 space-y-3 rounded-xl bg-white p-4 shadow-inner\">\n            <div className=\"flex items-center justify-between gap-3\">\n              <div className=\"h-3 w-24 rounded-full bg-blue-200\" />\n              <div className=\"h-6 w-12 rounded-full bg-blue-100\" />\n            </div>\n            <div className=\"h-12 rounded-xl bg-gradient-to-r from-blue-500/80 to-cyan-400/70\" />\n            <div className=\"h-2 w-3/4 rounded-full bg-gray-200\" />\n          </div>\n        );\n    }\n  };\n\n  const previewContent = shouldShowPreview ? (\n    <div className={isDeezerTheme ? 'deezer-sections' : 'aurora-sections'} data-tour-id=\"showcase-preview\">\n      {orderedSections}\n    </div>\n  ) : (\n    <div className=\"aurora-preview-placeholder\">\n      <h2 className=\"aurora-preview-placeholder__title\">Mode édition activé</h2>\n      <p className=\"aurora-preview-placeholder__text\">\n        Le rendu est temporairement masqué pendant vos ajustements.\n      </p>\n    </div>\n  );\n\n  const sectionModal = isSectionModalOpen ? (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4\">\n      <div className=\"absolute inset-0\" onClick={handleCloseSectionModal} aria-hidden=\"true\" />\n      <div\n        className=\"relative z-10 w-full max-w-4xl max-h-[calc(100vh-2rem)] overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl\"\n        role=\"dialog\"\n        aria-modal=\"true\"\n      >\n        <div className=\"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between\">\n          <div>\n            <p className=\"aurora-eyebrow aurora-eyebrow--soft\">Nouvelle section</p>\n            <h3 className=\"text-xl font-bold text-gray-900\">Choisissez un modèle puis complétez son contenu</h3>\n            <p className=\"text-sm text-gray-600\">Les miniatures donnent un aperçu rapide du rendu final.</p>\n          </div>\n          <button\n            type=\"button\"\n            onClick={handleCloseSectionModal}\n            className=\"rounded-full border border-gray-200 px-3 py-1 text-sm text-gray-600 transition hover:border-gray-300 hover:text-gray-800\"\n          >\n            Fermer\n          </button>\n        </div>\n\n        {sectionModalStep === 'templates' ? (\n          <div className=\"mt-6 space-y-4\">\n            <div className=\"flex flex-col items-center gap-4 md:flex-row md:items-stretch\">\n              <button\n                type=\"button\"\n                onClick={() => handleTemplateNavigation(-1)}\n                className=\"flex h-12 w-12 items-center justify-center rounded-full border border-gray-200 text-gray-700 transition hover:border-blue-200 hover:text-blue-700\"\n                aria-label=\"Modèle précédent\"\n              >\n                ←\n              </button>\n              <div className=\"flex-1 rounded-2xl border border-gray-200 bg-gradient-to-br from-white to-gray-50 p-5 shadow-sm\">\n                <div className=\"flex items-center justify-between gap-3\">\n                  <div>\n                    <p className=\"text-xs uppercase tracking-wide text-gray-500\">Modèle {selectedTemplateIndex + 1}/{SECTION_TEMPLATES.length}</p>\n                    <h4 className=\"text-lg font-semibold text-gray-900\">{selectedTemplate?.name}</h4>\n                    <p className=\"text-sm text-gray-600\">{selectedTemplate?.description}</p>\n                  </div>\n                  <div className={`h-12 w-24 rounded-lg bg-gradient-to-r ${selectedTemplateAccent} shadow-inner`} />\n                </div>\n                {renderTemplateThumbnail(selectedTemplate?.id)}\n              </div>\n              <button\n                type=\"button\"\n                onClick={() => handleTemplateNavigation(1)}\n                className=\"flex h-12 w-12 items-center justify-center rounded-full border border-gray-200 text-gray-700 transition hover:border-blue-200 hover:text-blue-700\"\n                aria-label=\"Modèle suivant\"\n              >\n                →\n              </button>\n            </div>\n            <div className=\"flex flex-wrap justify-end gap-2\">\n              <button\n                type=\"button\"\n                onClick={handleCloseSectionModal}\n                className=\"rounded-full border border-gray-200 px-4 py-2 text-sm font-medium text-gray-700 transition hover:border-gray-300\"\n              >\n                Annuler\n              </button>\n              <button\n                type=\"button\"\n                onClick={handleConfirmTemplateChoice}\n                className=\"rounded-full border border-blue-200 bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700\"\n              >\n                Valider ce modèle\n              </button>\n            </div>\n          </div>\n        ) : (\n          <form onSubmit={handleSubmitNewSection} className=\"mt-6 space-y-4\">\n            <div className=\"grid gap-4 md:grid-cols-2\">\n              <div className=\"space-y-1\">\n                <label htmlFor=\"section-title\" className=\"text-sm font-medium text-gray-800\">Titre</label>\n                <input\n                  id=\"section-title\"\n                  type=\"text\"\n                  value={sectionDraft.title}\n                  onChange={(event) => handleSectionDraftChange('title', event.target.value)}\n                  className=\"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-100\"\n                  placeholder={selectedTemplate?.placeholder?.title || 'Titre du bloc'}\n                  required\n                />\n              </div>\n              {selectedTemplateConfig.showSubtitle && (\n                <div className=\"space-y-1\">\n                  <label htmlFor=\"section-subtitle\" className=\"text-sm font-medium text-gray-800\">Sous-titre</label>\n                  <input\n                    id=\"section-subtitle\"\n                    type=\"text\"\n                    value={sectionDraft.subtitle}\n                    onChange={(event) => handleSectionDraftChange('subtitle', event.target.value)}\n                    className=\"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-100\"\n                    placeholder={selectedTemplate?.placeholder?.subtitle || 'Complément de contexte'}\n                  />\n                </div>\n              )}\n              {selectedTemplateConfig.showAccent && (\n                <div className=\"space-y-1\">\n                  <label htmlFor=\"section-accent\" className=\"text-sm font-medium text-gray-800\">Sous-titre d'accroche (optionnel)</label>\n                  <input\n                    id=\"section-accent\"\n                    type=\"text\"\n                    value={sectionDraft.accent}\n                    onChange={(event) => handleSectionDraftChange('accent', event.target.value)}\n                    className=\"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-100\"\n                    placeholder=\"Sous-titre court\"\n                  />\n                </div>\n              )}\n            </div>\n            {selectedTemplateConfig.showDescription && (\n              <div className=\"space-y-1\">\n                <label htmlFor=\"section-description\" className=\"text-sm font-medium text-gray-800\">Description</label>\n                <textarea\n                  id=\"section-description\"\n                  value={sectionDraft.description}\n                  onChange={(event) => handleSectionDraftChange('description', event.target.value)}\n                  rows={4}\n                  className=\"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-100\"\n                  placeholder={selectedTemplate?.placeholder?.description || 'Expliquez le contenu principal de cette section'}\n                />\n              </div>\n            )}\n            {selectedTemplateConfig.showColumns && (\n              <>\n                <div className=\"grid gap-4 md:grid-cols-2\">\n                  <div className=\"space-y-1\">\n                    <label htmlFor=\"section-column-count\" className=\"text-sm font-medium text-gray-800\">Nombre de colonnes</label>\n                    <select\n                      id=\"section-column-count\"\n                      value={sectionDraft.columnCount}\n                      onChange={(event) => handleSectionDraftColumnCountChange(event.target.value)}\n                      className=\"w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-100\"\n                    >\n                      {Array.from({ length: MAX_CUSTOM_SECTION_COLUMNS }, (_, index) => (\n                        <option key={`section-column-count-${index + 1}`} value={index + 1}>\n                          {index + 1} colonne{index + 1 > 1 ? 's' : ''}\n                        </option>\n                      ))}\n                    </select>\n                    <p className=\"text-xs text-gray-500\">Les colonnes se réorganisent selon la largeur disponible.</p>\n                  </div>\n                </div>\n                <div className=\"grid gap-4 md:grid-cols-2\">\n                  {sectionDraft.columns.map((column, columnIndex) => (\n                    <div key={`section-draft-column-${columnIndex}`} className=\"space-y-1\">\n                      <label\n                        htmlFor={`section-column-${columnIndex}`}\n                        className=\"text-sm font-medium text-gray-800\"\n                      >\n                        Contenu colonne {columnIndex + 1}\n                      </label>\n                      <textarea\n                        id={`section-column-${columnIndex}`}\n                        value={column}\n                        onChange={(event) => handleSectionDraftColumnChange(columnIndex, event.target.value)}\n                        rows={3}\n                        className=\"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-100\"\n                        placeholder={`Contenu de la colonne ${columnIndex + 1}`}\n                      />\n                    </div>\n                  ))}\n                </div>\n              </>\n            )}\n            {selectedTemplateConfig.showDocument && (\n              <div className=\"grid gap-4 md:grid-cols-2\">\n                <div className=\"space-y-1\">\n                  <label htmlFor=\"section-document-url\" className=\"text-sm font-medium text-gray-800\">\n                    Lien SharePoint du document\n                  </label>\n                  <input\n                    id=\"section-document-url\"\n                    type=\"url\"\n                    value={sectionDraft.documentUrl}\n                    onChange={(event) => {\n                      const nextValue = event.target.value;\n                      handleSectionDraftChange('documentUrl', nextValue);\n                      handleSharePointWarning(nextValue);\n                    }}\n                    className=\"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-100\"\n                    placeholder={selectedTemplate?.placeholder?.documentUrl || 'https://votre-tenant.sharepoint.com/...'}\n                  />\n                  <p className=\"text-xs text-gray-500\">\n                    Utilisez un lien SharePoint accessible ou un lien d’intégration Office pour les PPTX.\n                  </p>\n                </div>\n                <div className=\"space-y-1\">\n                  <label htmlFor=\"section-document-type\" className=\"text-sm font-medium text-gray-800\">\n                    Type de document\n                  </label>\n                  <select\n                    id=\"section-document-type\"\n                    value={sectionDraft.documentType}\n                    onChange={(event) => handleSectionDraftChange('documentType', event.target.value)}\n                    className=\"w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-100\"\n                  >\n                    {DOCUMENT_VIEWER_TYPES.map(type => (\n                      <option key={type.id} value={type.id}>\n                        {type.label}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n              </div>\n            )}\n            {selectedTemplateConfig.showItems && (\n              <div className=\"space-y-1\">\n                <label htmlFor=\"section-items\" className=\"text-sm font-medium text-gray-800\">Liste (une ligne par élément)</label>\n                <textarea\n                  id=\"section-items\"\n                  value={sectionDraftItemsText}\n                  onChange={(event) => handleSectionDraftItemsChange(event.target.value)}\n                  rows={4}\n                  className=\"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-100\"\n                  placeholder={(selectedTemplate?.placeholder?.items || ['Élément #1', 'Élément #2']).join('\\n')}\n                />\n              </div>\n            )}\n            <div className=\"flex flex-wrap justify-between gap-2\">\n              <button\n                type=\"button\"\n                onClick={handleBackToTemplates}\n                className=\"rounded-full border border-gray-200 px-4 py-2 text-sm font-medium text-gray-700 transition hover:border-gray-300\"\n              >\n                Retour aux modèles\n              </button>\n              <div className=\"flex flex-wrap gap-2\">\n                <button\n                  type=\"button\"\n                  onClick={handleCloseSectionModal}\n                  className=\"rounded-full border border-gray-200 px-4 py-2 text-sm font-medium text-gray-700 transition hover:border-gray-300\"\n                >\n                  Annuler\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"rounded-full border border-blue-200 bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700\"\n                >\n                  Ajouter la section\n                </button>\n              </div>\n            </div>\n          </form>\n        )}\n      </div>\n    </div>\n  ) : null;\n  const sharePointWarningModal = isSharePointWarningOpen ? (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4\">\n      <div className=\"absolute inset-0\" onClick={handleCloseSharePointWarning} aria-hidden=\"true\" />\n      <div\n        className=\"relative z-10 w-full max-w-lg rounded-2xl bg-white p-6 shadow-2xl\"\n        role=\"dialog\"\n        aria-modal=\"true\"\n        aria-label=\"Avertissement SharePoint\"\n      >\n        <div className=\"flex items-start justify-between gap-4\">\n          <div>\n            <p className=\"text-sm font-semibold uppercase tracking-wide text-amber-500\">Avertissement</p>\n            <h3 className=\"mt-2 text-xl font-bold text-gray-900\">Fichier SharePoint détecté</h3>\n          </div>\n          <button\n            type=\"button\"\n            onClick={handleCloseSharePointWarning}\n            className=\"rounded-full border border-gray-200 px-3 py-1 text-sm text-gray-600 transition hover:border-gray-300 hover:text-gray-800\"\n          >\n            Fermer\n          </button>\n        </div>\n        <p className=\"mt-4 text-sm text-gray-600\">\n          Vérifiez que le fichier SharePoint est bien partagé aux collaborateurs du LFB avant de valider son ajout.\n        </p>\n        <div className=\"mt-6 flex justify-end\">\n          <button\n            type=\"button\"\n            onClick={handleCloseSharePointWarning}\n            className=\"rounded-full border border-amber-200 bg-amber-500 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-amber-600\"\n          >\n            J'ai vérifié\n          </button>\n        </div>\n      </div>\n    </div>\n  ) : null;\n\n  const modeSelectionPanel = resolvedDisplayModeLock ? null : (\n    <div className=\"mb-6 rounded-2xl border border-gray-200 bg-white/80 shadow-sm backdrop-blur\">\n      <div\n        className=\"flex flex-col gap-3 p-4 sm:flex-row sm:items-center sm:justify-between\"\n        role=\"group\"\n        aria-label=\"Sélection du mode d'utilisation\"\n      >\n        <div className=\"space-y-1\">\n          <p className=\"text-xs font-semibold uppercase tracking-wide text-gray-500\">Sélection du mode d'utilisation</p>\n          <p className=\"text-sm text-gray-600\">\n            Choisissez entre l'affichage complet ou Light pour ajuster la vitrine.\n          </p>\n        </div>\n        <div className=\"flex flex-wrap items-center gap-2\">\n          <button\n            type=\"button\"\n            onClick={() => handleDisplayModeChange('light')}\n            className={`inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm font-medium transition ${\n              isLightMode\n                ? 'border-blue-200 bg-blue-50 text-blue-700 shadow-sm'\n                : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300'\n            }`}\n            aria-pressed={isLightMode}\n          >\n            Mode Light\n            <span className=\"text-xs text-gray-500\">({selectedLightSectionsCount}/{sectionOrder.length})</span>\n          </button>\n          <button\n            type=\"button\"\n            onClick={() => handleDisplayModeChange('full')}\n            className={`inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm font-medium transition ${\n              !isLightMode\n                ? 'border-blue-200 bg-blue-50 text-blue-700 shadow-sm'\n                : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300'\n            }`}\n            aria-pressed={!isLightMode}\n          >\n            Mode complet\n          </button>\n          <button\n            type=\"button\"\n            onClick={handleOpenLightConfig}\n            className=\"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:border-blue-200 hover:text-blue-700\"\n          >\n            Configurer\n          </button>\n        </div>\n      </div>\n\n      {isLightConfigOpen && (\n        <div className=\"border-t border-gray-200 p-4\">\n          <div className=\"flex flex-col gap-4\">\n            <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\n              <div>\n                <p className=\"text-sm font-semibold text-gray-800\">Sections visibles en mode Light</p>\n                <p className=\"text-xs text-gray-600\">Décochez les sections à masquer dans l'affichage allégé.</p>\n              </div>\n              <div className=\"flex flex-wrap gap-2\">\n                <button\n                  type=\"button\"\n                  onClick={handleSelectAllSections}\n                  className=\"rounded-full border border-gray-200 bg-white px-3 py-1 text-xs font-medium text-gray-700 transition hover:border-blue-200 hover:text-blue-700\"\n                >\n                  Tout sélectionner\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={handleCancelLightConfig}\n                  className=\"rounded-full border border-gray-200 bg-white px-3 py-1 text-xs font-medium text-gray-700 transition hover:border-gray-300\"\n                >\n                  Annuler\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={handleValidateLightConfig}\n                  className=\"rounded-full border border-blue-200 bg-blue-600 px-3 py-1 text-xs font-medium text-white shadow-sm transition hover:bg-blue-700\"\n                >\n                  Valider\n                </button>\n              </div>\n            </div>\n\n            <div className=\"grid gap-2 sm:grid-cols-2 lg:grid-cols-3\">\n              {SHOWCASE_SECTION_OPTIONS.map(section => {\n                const checkboxId = `light-section-${section.id}`;\n                const isChecked = pendingLightSections[section.id] !== false;\n                return (\n                  <label\n                    key={section.id}\n                    htmlFor={checkboxId}\n                    className=\"flex cursor-pointer items-start gap-3 rounded-xl border border-gray-200 bg-white px-3 py-2 shadow-sm transition hover:border-blue-200\"\n                  >\n                    <input\n                      id={checkboxId}\n                      name={checkboxId}\n                      type=\"checkbox\"\n                      checked={isChecked}\n                      onChange={() => handleTogglePendingSection(section.id)}\n                      className=\"mt-1 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\n                    />\n                    <span className=\"text-sm text-gray-800\">{section.label}</span>\n                  </label>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n\n  const editPanel = isEditing && canEdit ? (\n    <form\n      id={formId}\n      onSubmit={handleSubmitEdit}\n      className=\"aurora-edit-panel\"\n      data-tour-id=\"showcase-edit-panel\"\n    >\n      <div className=\"aurora-edit-panel__header\">\n        <div>\n          <p className=\"aurora-eyebrow aurora-eyebrow--soft\">Mode édition actif</p>\n          <h3 className=\"aurora-edit-panel__title\">Ajustez les informations présentées dans la vitrine</h3>\n        </div>\n        <p className=\"aurora-edit-panel__intro\">\n          Chaque modification sera appliquée aux réponses du questionnaire correspondant.\n        </p>\n      </div>\n      <div className=\"mb-6 rounded-2xl border border-gray-200 bg-gray-50/60 p-4 shadow-inner\">\n        <div className=\"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between\">\n          <div>\n            <p className=\"aurora-eyebrow aurora-eyebrow--soft\">Organisation des sections</p>\n            <h4 className=\"text-lg font-semibold text-gray-900\">Réorganisez et ajoutez de nouveaux blocs</h4>\n            <p className=\"text-sm text-gray-600\">Glissez-déposez pour changer l'ordre ou utilisez le bouton + pour insérer une nouvelle section.</p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <button\n              type=\"button\"\n              onClick={() => handleOpenSectionModal(0)}\n              className=\"hidden h-10 w-10 items-center justify-center rounded-full border border-dashed border-gray-300 text-gray-600 transition hover:border-blue-300 hover:text-blue-600 sm:inline-flex\"\n              aria-label=\"Ajouter une section au début\"\n            >\n              <Plus className=\"h-5 w-5\" />\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => handleOpenSectionModal(sectionOrder.length)}\n              className=\"inline-flex items-center gap-2 rounded-full border border-blue-200 bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700\"\n            >\n              <Plus className=\"h-4 w-4\" />\n              Nouvelle section\n            </button>\n          </div>\n        </div>\n        <ol className=\"mt-4 space-y-3\">\n          {sectionDescriptors.map((section, index) => {\n            const isTarget = sectionDragState.targetIndex === index;\n            return (\n              <li key={section.id} className=\"space-y-2\">\n                <div\n                  draggable\n                  onDragStart={(event) => handleSectionDragStart(index, event)}\n                  onDragEnter={() => handleSectionDragEnter(index)}\n                  onDragOver={handleSectionDragOver}\n                  onDragLeave={(event) => handleSectionDragLeave(index, event)}\n                  onDrop={(event) => handleSectionDrop(index, event)}\n                  className={`flex items-center justify-between gap-3 rounded-xl border bg-white p-3 shadow-sm transition ${\n                    isTarget ? 'border-blue-400 shadow-md ring-1 ring-blue-100' : 'border-gray-200'\n                  }`}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <span className=\"flex h-10 w-10 items-center justify-center rounded-full border border-dashed border-gray-300 text-gray-500\">\n                      ☰\n                    </span>\n                    <div>\n                      <p className=\"text-sm font-semibold text-gray-900\">{section.title}</p>\n                      <p className=\"text-xs text-gray-500\">{section.subtitle}</p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      type=\"button\"\n                      onClick={() => handleOpenSectionModal(index + 1)}\n                      className=\"flex h-9 w-9 items-center justify-center rounded-full border border-dashed border-gray-300 text-gray-600 transition hover:border-blue-300 hover:text-blue-600\"\n                      aria-label=\"Ajouter une section à cet endroit\"\n                    >\n                      <Plus className=\"h-4 w-4\" />\n                    </button>\n                    {section.isCustom && (\n                      <button\n                        type=\"button\"\n                        onClick={() => handleRemoveCustomSection(section.id)}\n                        className=\"flex h-9 w-9 items-center justify-center rounded-full border border-gray-200 text-gray-600 transition hover:border-red-200 hover:text-red-600\"\n                        aria-label=\"Supprimer cette section personnalisée\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </button>\n                    )}\n                  </div>\n                </div>\n              </li>\n            );\n          })}\n        </ol>\n      </div>\n      <div className=\"aurora-edit-panel__grid\">\n        {editFormBlocks.map((block) => {\n          if (block.type === 'custom') {\n            const section = block.section;\n            const templateConfig = resolveTemplateConfig(section.type);\n            const itemsText = Array.isArray(section.items) ? section.items.join('\\n') : '';\n            const sectionTitle = section.title || 'Section personnalisée';\n            const annotationSectionId = section.type || 'custom';\n\n            return (\n              <div\n                key={`custom-section-${section.id}`}\n                className=\"aurora-field aurora-field--wide\"\n                data-annotation-target-section={annotationSectionId}\n              >\n                <div className=\"flex flex-col gap-1\">\n                  <p className=\"aurora-field__label\">{sectionTitle}</p>\n                  <p className=\"text-xs text-gray-500\">Bloc personnalisé</p>\n                </div>\n                <div className=\"mt-4 grid gap-4 md:grid-cols-2\">\n                  <div className=\"space-y-1\">\n                    <label htmlFor={`custom-section-${section.id}-title`} className=\"text-sm font-medium text-gray-800\">\n                      Titre\n                    </label>\n                    <input\n                      id={`custom-section-${section.id}-title`}\n                      type=\"text\"\n                      value={section.title || ''}\n                      onChange={(event) => handleCustomSectionFieldChange(section.id, 'title', event.target.value)}\n                      className=\"aurora-form-control\"\n                      placeholder=\"Titre du bloc\"\n                    />\n                  </div>\n                </div>\n                {templateConfig.showSubtitle && (\n                  <div className=\"space-y-1\">\n                    <label htmlFor={`custom-section-${section.id}-subtitle`} className=\"text-sm font-medium text-gray-800\">\n                      Sous-titre\n                    </label>\n                    <input\n                      id={`custom-section-${section.id}-subtitle`}\n                      type=\"text\"\n                      value={section.subtitle || ''}\n                      onChange={(event) => handleCustomSectionFieldChange(section.id, 'subtitle', event.target.value)}\n                      className=\"aurora-form-control\"\n                      placeholder=\"Complément de contexte\"\n                    />\n                  </div>\n                )}\n                {templateConfig.showAccent && (\n                  <div className=\"space-y-1\">\n                    <label htmlFor={`custom-section-${section.id}-accent`} className=\"text-sm font-medium text-gray-800\">\n                      Sous-titre d'accroche (optionnel)\n                    </label>\n                    <input\n                      id={`custom-section-${section.id}-accent`}\n                      type=\"text\"\n                      value={section.accent || ''}\n                      onChange={(event) => handleCustomSectionFieldChange(section.id, 'accent', event.target.value)}\n                      className=\"aurora-form-control\"\n                      placeholder=\"Sous-titre court\"\n                    />\n                  </div>\n                )}\n                {templateConfig.showColumns && (\n                  <div className=\"space-y-1\">\n                    <label htmlFor={`custom-section-${section.id}-column-count`} className=\"text-sm font-medium text-gray-800\">\n                      Nombre de colonnes\n                    </label>\n                    <select\n                      id={`custom-section-${section.id}-column-count`}\n                      value={resolveCustomSectionColumnCount(section.columnCount, section.columns)}\n                      onChange={(event) => handleCustomSectionColumnCountChange(section.id, event.target.value)}\n                      className=\"aurora-form-control\"\n                    >\n                      {Array.from({ length: MAX_CUSTOM_SECTION_COLUMNS }, (_, index) => (\n                        <option key={`custom-section-${section.id}-column-${index + 1}`} value={index + 1}>\n                          {index + 1} colonne{index + 1 > 1 ? 's' : ''}\n                        </option>\n                      ))}\n                    </select>\n                  </div>\n                )}\n                {templateConfig.showDocument && (\n                  <>\n                    <div className=\"space-y-1\">\n                      <label htmlFor={`custom-section-${section.id}-document-url`} className=\"text-sm font-medium text-gray-800\">\n                        Lien SharePoint du document\n                      </label>\n                      <input\n                        id={`custom-section-${section.id}-document-url`}\n                        type=\"url\"\n                        value={section.documentUrl || ''}\n                        onChange={(event) => {\n                          const nextValue = event.target.value;\n                          handleCustomSectionFieldChange(section.id, 'documentUrl', nextValue);\n                          handleSharePointWarning(nextValue);\n                        }}\n                        className=\"aurora-form-control\"\n                        placeholder=\"https://votre-tenant.sharepoint.com/...\"\n                      />\n                    </div>\n                    <div className=\"space-y-1\">\n                      <label htmlFor={`custom-section-${section.id}-document-type`} className=\"text-sm font-medium text-gray-800\">\n                        Type de document\n                      </label>\n                      <select\n                        id={`custom-section-${section.id}-document-type`}\n                        value={section.documentType || 'pdf'}\n                        onChange={(event) => handleCustomSectionFieldChange(section.id, 'documentType', event.target.value)}\n                        className=\"aurora-form-control\"\n                      >\n                        {DOCUMENT_VIEWER_TYPES.map(type => (\n                          <option key={type.id} value={type.id}>\n                            {type.label}\n                          </option>\n                        ))}\n                      </select>\n                    </div>\n                  </>\n                )}\n                {templateConfig.showDescription && (\n                  <div className=\"mt-4 space-y-1\">\n                    <label htmlFor={`custom-section-${section.id}-description`} className=\"text-sm font-medium text-gray-800\">\n                      Description\n                    </label>\n                    <textarea\n                      id={`custom-section-${section.id}-description`}\n                      value={section.description || ''}\n                      onChange={(event) => handleCustomSectionFieldChange(section.id, 'description', event.target.value)}\n                      rows={4}\n                      className=\"aurora-form-control aurora-form-control--textarea\"\n                      placeholder=\"Expliquez le contenu principal de cette section\"\n                    />\n                  </div>\n                )}\n                {templateConfig.showColumns && (\n                  <div className=\"mt-4 grid gap-4 md:grid-cols-2\">\n                    {normalizeCustomSectionColumns(section.columns, resolveCustomSectionColumnCount(section.columnCount, section.columns))\n                      .map((column, columnIndex) => (\n                        <div key={`${section.id}-column-${columnIndex}`} className=\"space-y-1\">\n                          <label\n                            htmlFor={`custom-section-${section.id}-column-${columnIndex}`}\n                            className=\"text-sm font-medium text-gray-800\"\n                          >\n                            Contenu colonne {columnIndex + 1}\n                          </label>\n                          <textarea\n                            id={`custom-section-${section.id}-column-${columnIndex}`}\n                            value={column}\n                            onChange={(event) => handleCustomSectionColumnChange(section.id, columnIndex, event.target.value)}\n                            rows={3}\n                            className=\"aurora-form-control aurora-form-control--textarea\"\n                            placeholder={`Contenu de la colonne ${columnIndex + 1}`}\n                          />\n                        </div>\n                      ))}\n                  </div>\n                )}\n                {templateConfig.showItems && (\n                  <div className=\"mt-4 space-y-1\">\n                    <label htmlFor={`custom-section-${section.id}-items`} className=\"text-sm font-medium text-gray-800\">\n                      Liste (une ligne par élément)\n                    </label>\n                    <textarea\n                      id={`custom-section-${section.id}-items`}\n                      value={itemsText}\n                      onChange={(event) => handleCustomSectionItemsChange(section.id, event.target.value)}\n                      rows={4}\n                      className=\"aurora-form-control aurora-form-control--textarea\"\n                      placeholder=\"Élément #1&#10;Élément #2\"\n                    />\n                  </div>\n                )}\n              </div>\n            );\n          }\n\n          const field = block.field;\n          const fieldId = field.id;\n          const question = field.question;\n          const type = question?.type || field.fallbackType || 'text';\n          const label = question?.question || field.fallbackLabel || fieldId;\n          const fieldValue = draftValues[fieldId];\n          const options = Array.isArray(question?.options) ? question.options : [];\n          const isLong = type === 'long_text';\n          const isRichText = type === 'text' || type === 'long_text';\n          const isMulti = type === 'multi_choice';\n          const isChoice = type === 'choice';\n          const isDate = type === 'date';\n          const isMilestoneList = type === 'milestone_list';\n          const isMultiWithOptions = isMulti && options.length > 0;\n          const isMultiFreeform = isMulti && !isMultiWithOptions;\n          const isChoiceWithOptions = isChoice && options.length > 0;\n          const selectedValues = Array.isArray(fieldValue) ? fieldValue : [];\n          const textValue = typeof fieldValue === 'string' ? fieldValue : '';\n          const placeholder =\n            typeof question?.placeholder === 'string' && question.placeholder.trim() !== ''\n              ? question.placeholder.trim()\n              : isLong\n                ? 'Ajoutez ici un texte riche pour la vitrine'\n                : 'Saisissez un texte riche ou un lien';\n          const helperText = isMilestoneList\n            ? 'Ajoutez une date (optionnelle) et un descriptif pour chaque jalon.'\n            : isMultiWithOptions\n              ? 'Sélectionnez une ou plusieurs options.'\n              : isMultiFreeform\n                ? 'Indiquez une valeur par ligne.'\n                : ['problemPainPoints', 'solutionBenefits', 'teamCoreMembers', 'visionStatement'].includes(fieldId)\n                  ? 'Utilisez une ligne par élément pour une meilleure mise en forme.'\n                  : null;\n\n          const milestoneDraftEntries = isMilestoneList && Array.isArray(fieldValue) ? fieldValue : [];\n\n          const updateMilestoneDraft = (updater) => {\n            handleFieldChange(fieldId, previousValue => {\n              const previousEntries = Array.isArray(previousValue)\n                ? previousValue.map(entry => ({\n                    date: typeof entry?.date === 'string' ? entry.date : '',\n                    description: typeof entry?.description === 'string' ? entry.description : ''\n                  }))\n                : [];\n              const nextEntries = typeof updater === 'function' ? updater(previousEntries) : updater;\n              return Array.isArray(nextEntries) ? nextEntries : [];\n            });\n          };\n\n          const handleMilestoneDraftChange = (index, fieldName, value) => {\n            updateMilestoneDraft(entries => {\n              const nextEntries = entries.map((entry, entryIndex) => (\n                entryIndex === index ? { ...entry, [fieldName]: value } : entry\n              ));\n              return nextEntries;\n            });\n          };\n\n          const handleMilestoneDraftRemoval = (index) => {\n            updateMilestoneDraft(entries => entries.filter((_, entryIndex) => entryIndex !== index));\n          };\n\n          const handleMilestoneDraftAddition = () => {\n            updateMilestoneDraft(entries => [...entries, { date: '', description: '' }]);\n          };\n\n          const handleMilestoneDragStart = (index, event) => {\n            if (event?.dataTransfer) {\n              event.dataTransfer.effectAllowed = 'move';\n              try {\n                event.dataTransfer.setData('text/plain', String(index));\n              } catch (_error) {\n                // Certains navigateurs peuvent empêcher l'écriture : on ignore l'erreur.\n              }\n            }\n\n            setMilestoneDragState({\n              fieldId,\n              sourceIndex: index,\n              targetIndex: index\n            });\n          };\n\n          const handleMilestoneDragEnter = (index) => {\n            setMilestoneDragState(previous => {\n              if (previous.fieldId !== fieldId || previous.targetIndex === index) {\n                return previous;\n              }\n\n              return {\n                ...previous,\n                targetIndex: index\n              };\n            });\n          };\n\n          const handleMilestoneDragLeave = (index, event) => {\n            if (event?.currentTarget?.contains(event?.relatedTarget)) {\n              return;\n            }\n\n            setMilestoneDragState(previous => {\n              if (previous.fieldId !== fieldId || previous.targetIndex !== index) {\n                return previous;\n              }\n\n              return {\n                ...previous,\n                targetIndex: previous.sourceIndex\n              };\n            });\n          };\n\n          const handleMilestoneDragOver = (event) => {\n            if (milestoneDragState.fieldId === fieldId) {\n              event.preventDefault();\n              if (event?.dataTransfer) {\n                event.dataTransfer.dropEffect = 'move';\n              }\n            }\n          };\n\n          const handleMilestoneDrop = (index, event) => {\n            if (milestoneDragState.fieldId !== fieldId) {\n              return;\n            }\n\n            event.preventDefault();\n            event.stopPropagation();\n\n            setMilestoneDragState(previous => {\n              if (previous.fieldId !== fieldId || typeof previous.sourceIndex !== 'number') {\n                return createEmptyMilestoneDragState();\n              }\n\n              const rawTargetIndex = typeof index === 'number' ? index : previous.targetIndex;\n\n              if (typeof rawTargetIndex !== 'number') {\n                return createEmptyMilestoneDragState();\n              }\n\n              updateMilestoneDraft(entries => {\n                if (!Array.isArray(entries) || entries.length <= 1) {\n                  return Array.isArray(entries) ? entries : [];\n                }\n\n                const boundedSourceIndex = Math.max(0, Math.min(entries.length - 1, previous.sourceIndex));\n                const maxTargetIndex = entries.length;\n                const normalizedTargetIndex = Math.max(0, Math.min(maxTargetIndex, rawTargetIndex));\n\n                let insertionIndex = normalizedTargetIndex;\n                if (boundedSourceIndex < normalizedTargetIndex) {\n                  insertionIndex = normalizedTargetIndex - 1;\n                }\n\n                const workingEntries = entries.slice();\n                const [movedEntry] = workingEntries.splice(boundedSourceIndex, 1);\n\n                if (!movedEntry) {\n                  return entries;\n                }\n\n                const safeInsertionIndex = Math.max(0, Math.min(workingEntries.length, insertionIndex));\n                workingEntries.splice(safeInsertionIndex, 0, movedEntry);\n\n                return workingEntries;\n              });\n\n              return createEmptyMilestoneDragState();\n            });\n          };\n\n          const handleMilestoneDragEnd = () => {\n            resetMilestoneDragState();\n          };\n\n          const isDropTargetAtEnd =\n            milestoneDragState.fieldId === fieldId && milestoneDragState.targetIndex === milestoneDraftEntries.length;\n\n          const annotationSectionId = FIELD_SECTION_MAP[fieldId];\n\n          return (\n            <div\n              key={fieldId}\n              className={`aurora-field${isLong || isMulti || isMilestoneList ? ' aurora-field--wide' : ''}`}\n              data-annotation-target-section={annotationSectionId || undefined}\n            >\n              <label htmlFor={`showcase-edit-${fieldId}`} className=\"aurora-field__label\">\n                {label}\n              </label>\n              {isMilestoneList ? (\n                <div className=\"aurora-milestone-list\">\n                  {milestoneDraftEntries.length === 0 && (\n                    <p className=\"aurora-field__helper\">Aucun jalon n'a encore été ajouté.</p>\n                  )}\n                  {milestoneDraftEntries.map((entry, index) => {\n                    const dateInputId = `showcase-edit-${fieldId}-date-${index}`;\n                    const descriptionInputId = `showcase-edit-${fieldId}-description-${index}`;\n                    const isCurrentDragging =\n                      milestoneDragState.fieldId === fieldId && milestoneDragState.sourceIndex === index;\n                    const isCurrentDropTarget =\n                      milestoneDragState.fieldId === fieldId &&\n                      milestoneDragState.targetIndex === index &&\n                      milestoneDragState.sourceIndex !== index;\n                    const milestoneRowClasses = [\n                      'aurora-milestone-row',\n                      isCurrentDragging ? 'aurora-milestone-row--dragging' : '',\n                      isCurrentDropTarget ? 'aurora-milestone-row--drop-target' : ''\n                    ]\n                      .filter(Boolean)\n                      .join(' ');\n\n                    return (\n                      <div\n                        key={dateInputId}\n                        className={milestoneRowClasses}\n                        draggable={milestoneDraftEntries.length > 1}\n                        onDragStart={event => handleMilestoneDragStart(index, event)}\n                        onDragEnter={() => handleMilestoneDragEnter(index)}\n                        onDragLeave={event => handleMilestoneDragLeave(index, event)}\n                        onDragOver={handleMilestoneDragOver}\n                        onDrop={event => handleMilestoneDrop(index, event)}\n                        onDragEnd={handleMilestoneDragEnd}\n                        aria-grabbed={isCurrentDragging ? 'true' : 'false'}\n                      >\n                        <div className=\"aurora-milestone-row__date\">\n                          <label htmlFor={dateInputId} className=\"aurora-milestone-label\">\n                            Date\n                          </label>\n                          <input\n                            id={dateInputId}\n                            type=\"date\"\n                            value={typeof entry?.date === 'string' ? entry.date : ''}\n                            onChange={event => handleMilestoneDraftChange(index, 'date', event.target.value)}\n                            className=\"aurora-form-control\"\n                          />\n                        </div>\n                        <div className=\"aurora-milestone-row__description\">\n                          <label htmlFor={descriptionInputId} className=\"aurora-milestone-label\">\n                            Description\n                          </label>\n                          <input\n                            id={descriptionInputId}\n                            type=\"text\"\n                            value={typeof entry?.description === 'string' ? entry.description : ''}\n                            onChange={event => handleMilestoneDraftChange(index, 'description', event.target.value)}\n                            className=\"aurora-form-control\"\n                          />\n                        </div>\n                        <button\n                          type=\"button\"\n                          onClick={() => handleMilestoneDraftRemoval(index)}\n                          className=\"aurora-milestone-remove\"\n                        >\n                          <Trash2 className=\"aurora-milestone-remove__icon\" />\n                          Supprimer\n                        </button>\n                      </div>\n                    );\n                  })}\n                  <button\n                    type=\"button\"\n                    onClick={handleMilestoneDraftAddition}\n                    className={`aurora-milestone-add${isDropTargetAtEnd ? ' aurora-milestone-add--drop-target' : ''}`}\n                    onDragEnter={() => handleMilestoneDragEnter(milestoneDraftEntries.length)}\n                    onDragLeave={event => handleMilestoneDragLeave(milestoneDraftEntries.length, event)}\n                    onDragOver={handleMilestoneDragOver}\n                    onDrop={event => handleMilestoneDrop(milestoneDraftEntries.length, event)}\n                  >\n                    <Plus className=\"aurora-milestone-add__icon\" />\n                    Ajouter un jalon\n                  </button>\n                </div>\n              ) : isDate ? (\n                <input\n                  id={`showcase-edit-${fieldId}`}\n                  type=\"date\"\n                  value={typeof fieldValue === 'string' ? fieldValue : ''}\n                  onChange={event => handleFieldChange(fieldId, event.target.value)}\n                  className=\"aurora-form-control\"\n                />\n              ) : isMultiWithOptions ? (\n                <div className=\"aurora-option-grid\">\n                  {options.map((option, optionIndex) => {\n                    const optionId = `showcase-edit-${fieldId}-option-${optionIndex}`;\n                    const isChecked = selectedValues.includes(option);\n\n                    return (\n                      <label\n                        key={optionId}\n                        htmlFor={optionId}\n                        className={`aurora-option${isChecked ? ' aurora-option--active' : ''}`}\n                      >\n                        <input\n                          id={optionId}\n                          type=\"checkbox\"\n                          value={option}\n                          checked={isChecked}\n                          onChange={event => {\n                            const { checked } = event.target;\n                            handleFieldChange(fieldId, previousValue => {\n                              const previousSelections = Array.isArray(previousValue) ? previousValue : [];\n                              const selectionSet = new Set(previousSelections);\n\n                              if (checked) {\n                                selectionSet.add(option);\n                              } else {\n                                selectionSet.delete(option);\n                              }\n\n                              if (options.length > 0) {\n                                return options.filter(choice => selectionSet.has(choice));\n                              }\n\n                              return Array.from(selectionSet);\n                            });\n                          }}\n                          className=\"aurora-option__checkbox\"\n                        />\n                        <span className=\"aurora-option__text\">{option}</span>\n                      </label>\n                    );\n                  })}\n                </div>\n              ) : isChoiceWithOptions ? (\n                <select\n                  id={`showcase-edit-${fieldId}`}\n                  value={textValue}\n                  onChange={event => handleFieldChange(fieldId, event.target.value)}\n                  className=\"aurora-form-control\"\n                >\n                  <option value=\"\">Sélectionnez une option</option>\n                  {options.map(option => (\n                    <option key={option} value={option}>\n                      {option}\n                    </option>\n                  ))}\n                </select>\n              ) : isRichText ? (\n                <RichTextEditor\n                  id={`showcase-edit-${fieldId}`}\n                  value={textValue}\n                  onChange={(nextValue) => handleFieldChange(fieldId, nextValue)}\n                  placeholder={placeholder}\n                  compact={!isLong}\n                  ariaLabel={`${label} (édition riche)`}\n                />\n              ) : isMultiFreeform ? (\n                <textarea\n                  id={`showcase-edit-${fieldId}`}\n                  value={textValue}\n                  onChange={event => handleFieldChange(fieldId, event.target.value)}\n                  rows={isMultiFreeform ? 4 : 5}\n                  className=\"aurora-form-control aurora-form-control--textarea\"\n                />\n              ) : (\n                <input\n                  id={`showcase-edit-${fieldId}`}\n                  type=\"text\"\n                  value={textValue}\n                  onChange={event => handleFieldChange(fieldId, event.target.value)}\n                  className=\"aurora-form-control\"\n                />\n              )}\n              {helperText && <p className=\"aurora-field__helper\">{helperText}</p>}\n            </div>\n          );\n        })}\n      </div>\n      <div className=\"aurora-edit-panel__actions\">\n        <button type=\"button\" onClick={handleCancelEditing} className=\"aurora-button aurora-button--ghost\">\n          Annuler\n        </button>\n        <button\n          type=\"submit\"\n          className=\"aurora-button aurora-button--primary\"\n          data-tour-id=\"showcase-save-edits\"\n        >\n          <CheckCircle className=\"aurora-button__icon\" />\n          Enregistrer les modifications\n        </button>\n      </div>\n    </form>\n  ) : null;\n\n  const editBar =\n    canEdit && !isEditing ? (\n      <div className=\"aurora-edit-bar\">\n        <button\n          type=\"button\"\n          onClick={handleStartEditing}\n          className=\"aurora-button aurora-button--outline aurora-edit-bar__trigger\"\n          data-tour-id=\"showcase-edit-trigger\"\n        >\n          <Edit className=\"aurora-button__icon\" />\n          Modifier\n        </button>\n      </div>\n    ) : null;\n\n  const content = (\n    <>\n      {modeSelectionPanel}\n      {editBar}\n      {editPanel}\n      {sectionModal}\n      {sharePointWarningModal}\n      {previewContent}\n    </>\n  );\n\n  if (renderInStandalone) {\n    return (\n      <div\n        data-showcase-scope\n        data-showcase-theme={showcaseThemeId}\n        className={`${isDeezerTheme ? 'deezer-shell' : 'aurora-shell'} ${isDeezerTheme ? 'deezer-shell--standalone' : 'aurora-shell--standalone'}`}\n        style={showcaseThemeVariables}\n      >\n        {content}\n      </div>\n    );\n  }\n\n  return (\n    <section\n      data-showcase-scope\n      data-showcase-theme={showcaseThemeId}\n      className={isDeezerTheme ? 'deezer-shell' : 'aurora-shell'}\n      style={showcaseThemeVariables}\n      aria-label=\"Vitrine marketing du projet\"\n    >\n      {content}\n    </section>\n  );\n};\n",
  "src/data/questions.js": "export const initialQuestions = [\n  {\n    \"id\": \"projectName\",\n    \"type\": \"text\",\n    \"question\": \"Quel est le nom du projet ?\",\n    \"options\": [],\n    \"required\": true,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Nommer clairement l'initiative pour qu'elle soit mémorisée dès les premières secondes.\",\n      \"details\": \"Le nom affiché dans la vitrine du projet sert de repère pour toutes les équipes qui contribuent au pitch.\",\n      \"tips\": [\n        \"Renseignez le nom officiel ou celui que vous souhaitez tester auprès des parties prenantes.\",\n        \"Si un nom de code interne existe, ajoutez-le entre parenthèses pour faciliter le suivi.\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"hero\"\n      ],\n      \"usage\": \"Titre principal affiché dans la vitrine du projet.\"\n    }\n  },\n  {\n    \"id\": \"teamLead\",\n    \"type\": \"text\",\n    \"question\": \"Qui lead ce projet ?\",\n    \"options\": [],\n    \"required\": true,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Identifier l'interlocuteur principal pour les échanges compliance\",\n      \"details\": \"Cette information permet aux équipes expertes de contacter la bonne personne pour clarifier les éléments du dossier.\",\n      \"tips\": [\n        \"Renseignez le prénom et le nom\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"team\"\n      ],\n      \"usage\": \"Bloc « Lead du projet » dans la section équipe.\"\n    },\n    \"placeholder\": \"\",\n    \"conditionGroups\": []\n  },\n  {\n    \"id\": \"teamLeadTeam\",\n    \"type\": \"choice\",\n    \"question\": \"Équipe à laquelle cette personne appartient\",\n    \"options\": [\n      \"Marketing\",\n      \"Médical\",\n      \"Accès\",\n      \"Vente\",\n      \"Digital\",\n      \"Autre\"\n    ],\n    \"required\": true,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Préciser le rattachement du lead pour fluidifier les validations.\",\n      \"details\": \"Cette information s’affiche en complément du lead pour aider les interlocuteurs à identifier le bon canal.\",\n      \"tips\": [\n        \"Sélectionnez l’équipe principale du lead.\",\n        \"Précisez une double appartenance dans vos notes internes si nécessaire.\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"team\"\n      ],\n      \"usage\": \"Mention du rattachement du lead dans la section équipe.\"\n    },\n    \"placeholder\": \"\",\n    \"conditionGroups\": []\n  },\n  {\n    \"id\": \"ProjectType\",\n    \"type\": \"multi_choice\",\n    \"question\": \"De quel type de projet s'agit-il ?\",\n    \"options\": [\n      \"Parrainage / Partenariat\",\n      \"Support d'information / sensibilisation\",\n      \"Outil d'aide à la décision\",\n      \"Outil d'optimisation de la prise en charge des patients\",\n      \"Autre\"\n    ],\n    \"required\": true,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"conditionGroups\": [],\n    \"placeholder\": \"\",\n    \"guidance\": {\n      \"objective\": \"Identifier le type de projet pour connaitre les procédures applicables\",\n      \"details\": \"En fonction de la catégorie du projet sélectionné, nous vous poserons des questions supplémentaires pour affiner le projet et ainsi vous guider au mieux\",\n      \"tips\": [\n        \"En cas de doute, sélectionner les différentes catégories applicables\"\n      ]\n    }\n  },\n  {\n    \"id\": \"targetAudience\",\n    \"type\": \"multi_choice\",\n    \"question\": \"À qui s'adresse votre projet ?\",\n    \"options\": [\n      \"Grand public\",\n      \"Patients\",\n      \"Professionnels de santé\",\n      \"Acheteurs\",\n      \"Collaborateurs du LFB\"\n    ],\n    \"required\": true,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Identifier les destinataires du projet\",\n      \"details\": \"En fonction de la cible, les règles de validation ne seront pas les mêmes\",\n      \"tips\": [\n        \"Choisissez l'ensemble des personnes auxquelles votre projet s'adresse\",\n        \"Ne sélectionnez \\\"Interne à LFB\\\" que si le projet s'adresse aux collaborateurs du LFB (ex : un site intranet)\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"hero\"\n      ],\n      \"usage\": \"Badge « Audience principale » dans le bandeau de la vitrine.\"\n    },\n    \"placeholder\": \"\",\n    \"conditionGroups\": []\n  },\n  {\n    \"id\": \"showcaseTheme\",\n    \"type\": \"choice\",\n    \"question\": \"Quel thème souhaitez-vous pour la vitrine ?\",\n    \"options\": [\n      \"Universel\",\n      \"Produit\",\n      \"Cupertino\",\n      \"Lumen\",\n      \"Voyage\",\n      \"Arena\",\n      \"Prism\"\n    ],\n    \"required\": true,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Sélectionner la palette de couleurs qui servira de base à la vitrine du projet.\",\n      \"details\": \"Chaque thème peut être ajusté dans le back-office grâce aux color-pickers (fond, dégradés, accents). Choisissez celui qui correspond le mieux à votre projet.\",\n      \"tips\": [\n        \"Universel : reprend l'identité visuelle actuelle de la vitrine.\",\n        \"Produit : palette solaire et contrastée pour valoriser une offre produit.\",\n        \"Cupertino : minimalisme lumineux inspiré d’Apple.\",\n        \"Lumen : dégradés néon et profondeur façon Stripe.\",\n        \"Voyage : chaleur AirBnB, accent corail et accueil doux.\",\n        \"Arena : contrastes sportifs et énergie Nike.\",\n        \"Prism : gradients vibrants inspirés d’Instagram.\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"hero\"\n      ],\n      \"usage\": \"Pilote les couleurs et dégradés utilisés dans l'ensemble de la vitrine.\"\n    },\n    \"placeholder\": \"\",\n    \"conditionGroups\": []\n  },\n  {\n    \"id\": \"projectSlogan\",\n    \"type\": \"text\",\n    \"question\": \"Quel slogan pour votre projet ?\",\n    \"options\": [],\n    \"required\": false,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Résumer l'accroche en moins de 10 mots pour capter l'attention immédiatement.\",\n      \"details\": \"Le slogan apparaît dans la hero section et doit être simple, mémorable et orienté bénéfice.\",\n      \"tips\": [\n        \"Utilisez un verbe d’action qui évoque le résultat attendu.\",\n        \"Préférez un ton conversationnel : adressez-vous directement à votre audience.\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"hero\"\n      ],\n      \"usage\": \"Promesse courte située sous le nom du projet.\"\n    }\n  },\n  {\n    \"id\": \"problemPainPoints\",\n    \"type\": \"long_text\",\n    \"question\": \"Listez 2 à 3 besoins concrets vécus par vos utilisateurs et que votre projet vient solutionner.\",\n    \"options\": [],\n    \"required\": true,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Montrer que vous comprenez les besoins prioritaires de votre audience.\",\n      \"details\": \"Chaque besoin s’affichera comme un bullet point pour renforcer l’empathie.\",\n      \"tips\": [\n        \"Utilisez une ligne par besoin pour faciliter la lecture.\",\n        \"Décrivez la situation vécue plutôt que la solution souhaitée.\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"problem\"\n      ],\n      \"usage\": \"Liste des irritants principaux affichée dans la colonne de gauche.\"\n    }\n  },\n  {\n    \"id\": \"solutionDescription\",\n    \"type\": \"long_text\",\n    \"question\": \"Décrivez en quoi consiste votre solution.\",\n    \"options\": [],\n    \"required\": true,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Clarifier l’expérience proposée avant de détailler les bénéfices.\",\n      \"details\": \"Cette description introduit la section “Solution” et doit rester simple à comprendre.\",\n      \"tips\": [\n        \"Structurez en 2-3 phrases : quoi, pour qui, comment.\",\n        \"Évitez le vocabulaire interne : imaginez que vous présentez le concept à un prospect.\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"solution\"\n      ],\n      \"usage\": \"Bloc « Expérience proposée » dans la partie solution.\"\n    }\n  },\n  {\n    \"id\": \"q11\",\n    \"type\": \"multi_choice\",\n    \"question\": \"Quels sont les livrables associés au projet ?\",\n    \"options\": [\n      \"Site internet\",\n      \"Communication sur les réseaux sociaux\",\n      \"Application mobile / web app\",\n      \"Matériel promotionnel\",\n      \"Matériel environnement\",\n      \"Publication scientifique\"\n    ],\n    \"required\": true,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"conditionGroups\": [],\n    \"placeholder\": \"\",\n    \"guidance\": {\n      \"objective\": \"\",\n      \"details\": \"\",\n      \"tips\": []\n    }\n  },\n  {\n    \"id\": \"q3\",\n    \"type\": \"multi_choice\",\n    \"question\": \"Collectez-vous des données dans le cadre de votre projet / solution ?\",\n    \"options\": [\n      \"Oui - Données de santé\",\n      \"Oui - Autre données sensibles\",\n      \"Oui - Données personnelles standard\",\n      \"Non\"\n    ],\n    \"required\": true,\n    \"conditions\": [\n      {\n        \"question\": \"q11\",\n        \"operator\": \"contains\",\n        \"value\": \"Site internet\"\n      },\n      {\n        \"question\": \"q11\",\n        \"operator\": \"contains\",\n        \"value\": \"Application mobile / web app\"\n      }\n    ],\n    \"guidance\": {\n      \"objective\": \"Qualifier la nature des données personnelles manipulées.\",\n      \"details\": \"Les données de santé impliquent une analyse d'impact renforcée (DPIA), un hébergement certifié HDS et des clauses contractuelles spécifiques.\",\n      \"tips\": [\n        \"Si la collecte est incertaine, retenez l'hypothèse la plus protectrice pour planifier les validations.\"\n      ]\n    },\n    \"placeholder\": \"\",\n    \"conditionGroups\": [\n      {\n        \"logic\": \"any\",\n        \"conditions\": [\n          {\n            \"question\": \"q11\",\n            \"operator\": \"contains\",\n            \"value\": \"Site internet\"\n          },\n          {\n            \"question\": \"q11\",\n            \"operator\": \"contains\",\n            \"value\": \"Application mobile / web app\"\n          }\n        ]\n      }\n    ],\n    \"conditionLogic\": \"any\"\n  },\n  {\n    \"id\": \"q13\",\n    \"type\": \"choice\",\n    \"question\": \"Votre solution contiendra-t-elle des champs libres ?\",\n    \"options\": [\n      \"Oui\",\n      \"Non\"\n    ],\n    \"required\": true,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"conditionGroups\": [\n      {\n        \"logic\": \"any\",\n        \"conditions\": [\n          {\n            \"question\": \"targetAudience\",\n            \"operator\": \"equals\",\n            \"value\": \"Grand public\"\n          },\n          {\n            \"question\": \"targetAudience\",\n            \"operator\": \"equals\",\n            \"value\": \"Patients\"\n          },\n          {\n            \"question\": \"targetAudience\",\n            \"operator\": \"equals\",\n            \"value\": \"Professionnels de santé\"\n          },\n          {\n            \"question\": \"targetAudience\",\n            \"operator\": \"equals\",\n            \"value\": \"Acheteurs\"\n          }\n        ]\n      },\n      {\n        \"logic\": \"any\",\n        \"conditions\": [\n          {\n            \"question\": \"q11\",\n            \"operator\": \"equals\",\n            \"value\": \"Site internet\"\n          },\n          {\n            \"question\": \"q11\",\n            \"operator\": \"equals\",\n            \"value\": \"Application mobile / web app\"\n          },\n          {\n            \"question\": \"q11\",\n            \"operator\": \"equals\",\n            \"value\": \"Matériel promotionnel\"\n          },\n          {\n            \"question\": \"q11\",\n            \"operator\": \"equals\",\n            \"value\": \"Matériel environnement\"\n          }\n        ]\n      }\n    ],\n    \"placeholder\": \"\",\n    \"guidance\": {\n      \"objective\": \"Les champs libres peuvent créer des obligations de PV\",\n      \"details\": \"Dès lors qu'un champs libre est présent, il convient de mettre en place un système de monitoring\",\n      \"tips\": [\n        \"Les champs libres ne sont pas problématiques en soi ! Il convient juste de mettre les bons contrôles en place\"\n      ]\n    }\n  },\n  {\n    \"id\": \"solutionBenefits\",\n    \"type\": \"long_text\",\n    \"question\": \"Quels bénéfices tangibles votre solution apporte-t-elle ?\",\n    \"options\": [],\n    \"required\": true,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Mettre en avant les résultats obtenus plutôt que les fonctionnalités.\",\n      \"details\": \"Chaque ligne sera transformée en bénéfice clé dans la vitrine.\",\n      \"tips\": [\n        \"Rédigez une phrase par bénéfice, orientée résultat (“Gain de 2h par semaine”).\",\n        \"Priorisez les bénéfices les plus différenciants pour votre audience.\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"solution\"\n      ],\n      \"usage\": \"Liste des bénéfices clés dans la section solution.\"\n    }\n  },\n  {\n    \"id\": \"solutionComparison\",\n    \"type\": \"long_text\",\n    \"question\": \"En quoi cette solution se distingue-t-elle des alternatives actuelles ?\",\n    \"options\": [],\n    \"required\": false,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Souligner la différenciation sans dénigrer la concurrence.\",\n      \"details\": \"Cette réponse apparaît dans la section “Solution” comme une comparaison subtile.\",\n      \"tips\": [\n        \"Comparez-vous à un comportement ou à une solution existante plutôt qu’à un concurrent direct.\",\n        \"Appuyez-vous sur un bénéfice mesurable ou une expérience utilisateur plus fluide.\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"solution\"\n      ],\n      \"usage\": \"Bloc « Pourquoi c’est différent » dans la section solution.\"\n    }\n  },\n  {\n    \"id\": \"q10\",\n    \"type\": \"multi_choice\",\n    \"question\": \"Allez-vous impliquer un ou plusieurs partenaires ?\",\n    \"options\": [\n      \"Prestataire de service\",\n      \"Etablissement de santé\",\n      \"Professionnel de santé (via contrat à mettre en place)\",\n      \"Société savante / association de PDS\",\n      \"Association de patients\"\n    ],\n    \"required\": false,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"conditionGroups\": [],\n    \"placeholder\": \"\",\n    \"guidance\": {\n      \"objective\": \"Anticiper l'implication de prestataires externes et les contrôles associés\",\n      \"details\": \"Les partenariats imposent une revue juridique des contrats, et parfois des délais supplémentaires liés à des obligations de déclaration / demande d'autorisation aux autorités\",\n      \"tips\": []\n    }\n  },\n  {\n    \"id\": \"BUDGET\",\n    \"type\": \"number\",\n    \"question\": \"Quel est le coût estimé du projet ? (en K€)\",\n    \"options\": [],\n    \"required\": true,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"conditionGroups\": [],\n    \"placeholder\": \"\",\n    \"numberUnit\": \"K€\",\n    \"guidance\": {\n      \"objective\": \"\",\n      \"details\": \"\",\n      \"tips\": []\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"impact\"\n      ],\n      \"usage\": \"Carte « Budget estimé » dans la section impact.\"\n    }\n  },\n  {\n    \"id\": \"innovationProcess\",\n    \"type\": \"long_text\",\n    \"question\": \"Quels sont vos objectifs derrières ce projet ?\",\n    \"options\": [],\n    \"required\": false,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Identifier l'intérêt business du projet\",\n      \"details\": \"Cette réponse vous permet de mettre en avant la valeur générée du projet pour le LFB\",\n      \"tips\": [\n        \"Soyez précis dans la description de votre objectif\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"innovation\"\n      ],\n      \"usage\": \"Encart explicatif sur le fonctionnement de l’innovation.\"\n    },\n    \"placeholder\": \"\",\n    \"conditionGroups\": []\n  },\n  {\n    \"id\": \"visionStatement\",\n    \"type\": \"long_text\",\n    \"question\": \"Quels indicateurs allez-vous suivre pour mesurer l'impact du projet ?\",\n    \"options\": [],\n    \"required\": false,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Montrer comment vous suivrez concrètement la création de valeur.\",\n      \"details\": \"Chaque indicateur s’affichera comme un point clé dans la section impact pour rassurer les parties prenantes.\",\n      \"tips\": [\n        \"Listez une métrique par ligne (quantitative ou qualitative).\",\n        \"Précisez la cible ou la fréquence de suivi lorsque c’est pertinent.\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"impact\"\n      ],\n      \"usage\": \"Citation de conclusion dans la section impact.\"\n    }\n  },\n  {\n    \"id\": \"campaignKickoffDate\",\n    \"type\": \"date\",\n    \"question\": \"À quelle date allez-vous soumettre ce projet à la compliance ?\",\n    \"options\": [],\n    \"required\": false,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Poser le jalon officiel de passage en revue compliance.\",\n      \"details\": \"Cette date permet d’anticiper les échanges de validation et le temps de traitement.\",\n      \"tips\": [\n        \"Indiquez la date d’envoi du dossier complet à la compliance.\",\n        \"Mettez à jour la date dès qu’un nouveau créneau est confirmé.\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"timeline\"\n      ],\n      \"usage\": \"Point de départ utilisé pour calculer le runway et les prochaines étapes.\"\n    }\n  },\n  {\n    \"id\": \"launchDate\",\n    \"type\": \"date\",\n    \"question\": \"Quelle est la date de lancement souhaitée ?\",\n    \"options\": [],\n    \"required\": false,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Aligner toutes les parties prenantes sur la cible de lancement.\",\n      \"details\": \"Associée à la date de soumission compliance, cette information permet de vérifier la faisabilité du planning.\",\n      \"tips\": [\n        \"Renseignez la première date de mise en avant (événement, publication, annonce).\",\n        \"Si la date n’est pas figée, indiquez l’hypothèse la plus réaliste pour planifier les ressources.\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"timeline\"\n      ],\n      \"usage\": \"Date cible utilisée pour le calcul du runway et du calendrier.\"\n    }\n  },\n  {\n    \"id\": \"roadmapMilestones\",\n    \"type\": \"milestone_list\",\n    \"question\": \"Quels jalons clés souhaitez-vous mettre en avant ?\",\n    \"options\": [],\n    \"required\": false,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Projeter les étapes majeures à venir pour synchroniser les parties prenantes.\",\n      \"details\": \"Chaque jalon affichera une date et un descriptif dans la section feuille de route de la vitrine.\",\n      \"tips\": [\n        \"Utilisez un format AAAA-MM-JJ pour les dates afin de faciliter la lecture.\",\n        \"Formulez des descriptions actionnables : validation, lancement partiel, publication clé, etc.\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"timeline\"\n      ],\n      \"usage\": \"Liste de jalons personnalisés dans la section « Les prochains jalons ».\"\n    }\n  },\n  {\n    \"id\": \"teamCoreMembers\",\n    \"type\": \"long_text\",\n    \"question\": \"Quels sont les membres de l'équipe projet ?\",\n    \"options\": [],\n    \"required\": false,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Mettre en avant la complémentarité de l’équipe.\",\n      \"details\": \"Chaque ligne sera affichée comme un membre du “collectif moteur”.\",\n      \"tips\": [\n        \"Mentionnez pour chaque personne le rôle ou l’expertise apportée.\",\n        \"Incluez éventuellement les partenaires ou experts externes essentiels.\"\n      ]\n    },\n    \"showcase\": {\n      \"sections\": [\n        \"team\"\n      ],\n      \"usage\": \"Liste « Collectif moteur » dans la section équipe.\"\n    },\n    \"placeholder\": \"Prénom Nom - Poste de la personne\\nPrénom Nom - Poste de la personne\",\n    \"conditionGroups\": []\n  },\n  {\n    \"id\": \"agencyRanking\",\n    \"type\": \"ranking\",\n    \"question\": \"Classez vos critères pour sélectionner une agence médicale partenaire\",\n    \"options\": [],\n    \"required\": false,\n    \"conditions\": [],\n    \"conditionLogic\": \"all\",\n    \"guidance\": {\n      \"objective\": \"Identifier rapidement l'agence qui correspond le mieux à vos attentes.\",\n      \"details\": \"Ordonnez les critères par importance et mettez de côté ceux qui n'ont aucune incidence pour vous.\",\n      \"tips\": [\n        \"Pensez aux compétences clés attendues (scientifique, créativité, international...).\",\n        \"Marquez les critères non pertinents comme \\\"sans importance\\\" pour affiner la recommandation.\"\n      ]\n    },\n    \"rankingConfig\": {\n      \"title\": \"Prestataires pré-identifiés\",\n      \"criteria\": [\n        { \"id\": \"international\", \"label\": \"International\" },\n        { \"id\": \"scientific\", \"label\": \"Contenu scientifique\" },\n        { \"id\": \"creativity\", \"label\": \"Créativité\" },\n        { \"id\": \"price\", \"label\": \"Prix\" },\n        { \"id\": \"opinion\", \"label\": \"Avis global\" }\n      ],\n      \"entries\": [\n        {\n          \"id\": \"a-a\",\n          \"name\": \"A+A\",\n          \"scores\": { \"international\": 3, \"scientific\": 3, \"creativity\": 3, \"price\": 3, \"opinion\": 2 },\n          \"contact\": \"antoine.ada@aa.com\",\n          \"website\": \"https://www.adhealth.com\",\n          \"previousProject\": \"\",\n          \"opinionText\": \"+++\",\n          \"notes\": \"Positionnement premium et solide réseau international.\"\n        },\n        {\n          \"id\": \"adahealth\",\n          \"name\": \"ADAHealth\",\n          \"scores\": { \"international\": 1, \"scientific\": 2, \"creativity\": 3, \"price\": 3, \"opinion\": 2 },\n          \"contact\": \"robin.benard@adhealth.com\",\n          \"website\": \"https://www.adhealth.com\",\n          \"previousProject\": \"\",\n          \"opinionText\": \"++\",\n          \"notes\": \"Agence créative avec appétence digitale.\"\n        },\n        {\n          \"id\": \"anna-purna\",\n          \"name\": \"Anna Purna\",\n          \"scores\": { \"international\": 2, \"scientific\": 2, \"creativity\": 3, \"price\": 3, \"opinion\": 2 },\n          \"contact\": \"l.esperanza@annapurna8000.com\",\n          \"website\": \"https://www.agence-annapurna.com\",\n          \"previousProject\": \"\",\n          \"opinionText\": \"++\",\n          \"notes\": \"Approche équilibrée entre rigueur médicale et créativité.\"\n        },\n        {\n          \"id\": \"arsenal-cdm\",\n          \"name\": \"Arsenal CDM\",\n          \"scores\": { \"international\": 1, \"scientific\": 1, \"creativity\": 1, \"price\": 1, \"opinion\": 1 },\n          \"contact\": \"cherry@cdmparis.com\",\n          \"website\": \"https://www.cdmparis.com\",\n          \"previousProject\": \"FitCLOT / CLOTTAFACT\",\n          \"opinionText\": \"++\",\n          \"notes\": \"Historique sur des projets clotting, bonne connaissance du secteur.\"\n        }\n      ]\n    },\n    \"placeholder\": \"\",\n    \"conditionGroups\": []\n  }\n];\n",
  "src/data/showcaseThemes.js": "export const initialShowcaseThemes = [\n  {\n    id: 'universel',\n    label: 'Universel',\n    description: 'Palette actuelle de la vitrine, équilibrée entre bleu profond et reflets cyan.',\n    aliases: ['Universel'],\n    palette: {\n      backgroundStart: '#020309',\n      backgroundMid: '#050b18',\n      backgroundEnd: '#020309',\n      glowPrimary: '#3b82f6',\n      glowSecondary: '#0ea5e9',\n      accentPrimary: '#2563eb',\n      accentSecondary: '#06b6d4',\n      surface: '#0b1223',\n      surfaceLight: '#f8fafc',\n      surfaceLightAlt: '#e2e8f0',\n      border: '#94a3b8',\n      inkStrong: '#0f172a',\n      inkSoft: '#1e293b',\n      inkMuted: '#475569',\n      inkSubtle: '#94a3b8',\n      textPrimary: '#f8fafc',\n      textSecondary: '#e2e8f0',\n      highlight: '#93c5fd',\n      titleGradientStart: '#93c5fd',\n      titleGradientMid: '#c084fc',\n      titleGradientEnd: '#0ea5e9',\n      ctaStart: '#1e3a8a',\n      ctaEnd: '#0f766e',\n      ctaText: '#ecfeff',\n      heroBackgroundStart: '#000000',\n      heroBackgroundMid: '#090d15',\n      heroBackgroundEnd: '#0b1f2c',\n      panelSoftStart: '#101728',\n      panelSoftEnd: '#1b2230',\n      panelStrongStart: '#0b2f41',\n      panelStrongEnd: '#0e5560',\n      statusOkStart: '#d1fae5',\n      statusOkEnd: '#a7f3d0',\n      statusWarnStart: '#ecfdf5',\n      statusWarnEnd: '#d1fae5',\n      statusAlertStart: '#fee2e2',\n      statusAlertEnd: '#fecaca',\n      statusAlertStrongStart: '#f05959',\n      statusAlertStrongEnd: '#be1717',\n      statusOkText: '#064e3b',\n      statusWarnText: '#064e3b',\n      statusAlertText: '#7f1d1d'\n    }\n  },\n  {\n    id: 'deezer',\n    label: 'Deezer',\n    description: 'Univers sombre et vibrant inspiré des plateformes musicales, avec néons et pulsations.',\n    aliases: ['Deezer', 'Music'],\n    palette: {\n      backgroundStart: '#06060a',\n      backgroundMid: '#0d0d16',\n      backgroundEnd: '#141425',\n      glowPrimary: '#ff5500',\n      glowSecondary: '#ff1f6b',\n      accentPrimary: '#ff5500',\n      accentSecondary: '#ff1f6b',\n      surface: '#111122',\n      surfaceLight: '#f8fafc',\n      surfaceLightAlt: '#dbe2ff',\n      border: '#ff1f6b',\n      inkStrong: '#0b0b10',\n      inkSoft: '#10101a',\n      inkMuted: '#4c4c6f',\n      inkSubtle: '#6b6b8c',\n      textPrimary: '#f8fafc',\n      textSecondary: '#dbe2ff',\n      highlight: '#ff8a34',\n      titleGradientStart: '#ff5500',\n      titleGradientMid: '#ff1f6b',\n      titleGradientEnd: '#7c3aed',\n      ctaStart: '#ff5500',\n      ctaEnd: '#ff1f6b',\n      ctaText: '#0b0b10',\n      heroBackgroundStart: '#06060a',\n      heroBackgroundMid: '#0d0d16',\n      heroBackgroundEnd: '#141425',\n      panelSoftStart: '#0f0f1c',\n      panelSoftEnd: '#151529',\n      panelStrongStart: '#1f1f35',\n      panelStrongEnd: '#2b2b4b',\n      statusOkStart: '#dcfce7',\n      statusOkEnd: '#bbf7d0',\n      statusWarnStart: '#fef3c7',\n      statusWarnEnd: '#fde68a',\n      statusAlertStart: '#fee2e2',\n      statusAlertEnd: '#fecaca',\n      statusAlertStrongStart: '#ff1f6b',\n      statusAlertStrongEnd: '#ff5500',\n      statusOkText: '#166534',\n      statusWarnText: '#92400e',\n      statusAlertText: '#991b1b'\n    }\n  }\n];\n",
